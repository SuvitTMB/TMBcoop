<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Canvas Confetti for Fireworks -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Google Font (Sarabun) -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .hidden { display: none !important; }
        
        /* Custom Animations */
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes bounce-slow { 0%, 100% { transform: translateY(-5%); } 50% { transform: translateY(0); } }
        .animate-bounce-slow { animation: bounce-slow 2s infinite; }
        
        /* Remove number arrows */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        
        .input-focus:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        /* Modal Backdrop Fade */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen pb-10">

    <!-- Header Section -->
    <div class="bg-gradient-to-r from-blue-800 to-indigo-900 text-white p-6 rounded-b-[2.5rem] shadow-xl mb-8 relative overflow-hidden">
        <div class="absolute top-0 right-0 opacity-10 transform translate-x-10 -translate-y-10">
            <i data-lucide="shield-check" width="150" height="150"></i>
        </div>
        
        <div class="relative z-10 flex flex-col items-center">
            <div class="bg-white/20 p-3 rounded-full mb-3 backdrop-blur-sm">
                <i data-lucide="calendar" width="32" height="32" class="text-white"></i>
            </div>
            <h1 class="text-xl font-bold text-center">ประชุมใหญ่สามัญประจำปี 2568</h1>
            <p class="text-blue-100 text-sm mt-1 text-center">สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด</p>
        </div>
    </div>

    <!-- Main Content Container -->
    <main class="px-4 max-w-lg mx-auto -mt-10">
        
        <!-- Registration Form Screen -->
        <div id="screen-form" class="bg-white rounded-2xl shadow-2xl p-6 border border-slate-200 relative z-20">
            <form id="registration-form" class="space-y-6 pt-2">
                <div class="text-center">
                    <div>
                        <label for="idCard" class="block text-sm font-semibold text-gray-700 mb-2 text-center">
                            เลขบัตรประจำตัวประชาชน
                        </label>
                        <div class="relative">
                            <input
                                type="text"
                                id="idCard"
                                placeholder="x-xxxx-xxxxx-xx-x"
                                class="w-full text-xl font-mono tracking-widest p-4 rounded-xl border-2 border-gray-300 bg-white outline-none transition-all text-center input-focus"
                                inputmode="numeric"
                                maxlength="17"
                            />
                            <i id="icon-check-valid" data-lucide="check-circle" class="hidden absolute right-4 top-1/2 transform -translate-y-1/2 text-green-500 w-6 h-6 animate-fade-in"></i>
                        </div>
                        <p class="text-xm text-gray-500 mt-2">กรุณากรอกตัวเลข 13 หลักให้ครบถ้วน</p>
                    </div>

                    <!-- Info Box -->
                    <div class="p-4 bg-amber-50 border border-amber-200 text-amber-900 rounded-xl text-xs flex gap-3 items-start mt-6 text-left">
                        <i data-lucide="info" class="w-5 h-5 shrink-0 text-amber-600"></i>
                        <span class="leading-relaxed">ผู้ที่เข้าร่วมประชุมสหกรณ์ออมทรัพย์ฯ ประจำปี 2568 จนครบวาระการประชุม จะได้รับรางวัลค่าตอบแทนการประชุม 200 บาท</span>
                    </div>
                </div>

                <button
                    type="submit"
                    id="btn-submit"
                    disabled
                    class="w-full py-4 rounded-xl font-bold text-lg shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2 bg-gray-200 text-gray-400 cursor-not-allowed"
                >
                    <span id="btn-text">ตรวจสอบ / ลงทะเบียน</span>
                    <i id="btn-loader" data-lucide="loader-2" class="hidden animate-spin"></i>
                </button>
            </form>
        </div>

        <!-- Success Screen -->
        <div id="screen-success" class="hidden bg-white rounded-2xl shadow-2xl p-8 w-full text-center animate-fade-in relative z-20 border border-blue-100">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i data-lucide="user-check" class="text-green-600 w-10 h-10"></i>
            </div>
            
            <!-- User Info Section -->
            <div class="mb-4">
                <h3 id="success-user-name" class="text-2xl font-bold text-blue-800 mb-1"></h3>
                <h2 id="success-title" class="text-lg font-medium text-gray-600">ลงทะเบียนสำเร็จ</h2>
                <p id="success-checkin-datetime" class="text-blue-500 font-semibold text-xs mt-1">--/--/---- --:--</p>
            </div>
            
            <!-- Dynamic Content Area -->
            <div id="status-content-area" class="mb-8">
                <!-- First Time Flow: Voting Card -->
                <div id="flow-first-time" class="hidden space-y-4">
                    <div id="voting-status-box" class="bg-indigo-700 text-white p-6 rounded-2xl shadow-inner" style="margin-top:20px;">
                        <div id="voting-box-content">
                            <p class="text-lg font-bold">ขอให้สมาชิกติดต่อเจ้าหน้าที่</p>
                            <p class="text-sm mt-2 leading-relaxed">เพื่อขอบัตรเลือกตั้งกรรมการ <br>สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด</p>
                        </div>
                    </div>
                    
                    <!-- Warning Message below the box -->
                    <p id="voting-warning" class="text-red-600 text-xm">คำเตือน<br>ห้ามออกจากหน้านี้หากยังไม่ได้รับบัตรเลือกตั้ง<br>เมื่อออกไปแล้วจะไม่สามารถรับบัตรเลือกตั้งได้</p>
                    
                    <div class="pt-4 space-y-3">
                        <button id="btn-confirm-voting" onclick="window.app.confirmVotingCard()" class="w-full bg-emerald-600 text-white py-3 rounded-xl font-semibold hover:bg-emerald-700 shadow-lg transition-all active:scale-95">
                            คลิกเพื่อ ยืนยันการรับบัตรเลือกตั้ง
                        </button>
                        <p id="staff-hint" class="text-xs text-red-500 tracking-wider">
                            *** คลิกยืนยันเมื่อท่านได้รับบัตรเลือกตั้งแล้วท่านั้น ***
                        </p>
                    </div>
                </div>

                <!-- Returning Flow: Visit Counter -->
                <div id="flow-returning" class="hidden">
                    <div class="bg-blue-50 border-2 border-blue-200 p-8 rounded-2xl">
                        <p class="text-gray-500 text-sm">คุณเข้ามาทำรายการเป็น</p>
                        <div class="flex items-baseline justify-center gap-2 mt-1">
                            <span id="login-count-text" class="text-5xl font-black text-blue-700">0</span>
                            <span class="text-xl font-bold text-blue-700">ครั้ง</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Navigation Button -->
            <button id="btn-back-main" onclick="window.app.resetForm()" class="hidden w-full bg-slate-800 text-white py-4 rounded-xl font-bold text-lg hover:bg-slate-900 transition shadow-xl">
                กลับสู่หน้าหลัก
            </button>
        </div>

        <!-- Lightbox / Modal for Confirmation -->
        <div id="modal-confirm" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 modal-backdrop animate-fade-in">
            <div class="bg-white rounded-3xl shadow-2xl max-w-sm w-full p-8 text-center animate-fade-in">
                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="help-circle" class="text-blue-600 w-8 h-8"></i>
                </div>
                <div id="modal-content" class="mb-8">
                    <p id="modal-user-name" class="text-xl font-bold text-gray-800 mb-1"></p>
                    <p class="text-gray-600 leading-relaxed">ขอยืนยันการรับบัตรเลือกตั้ง เรียบร้อยแล้ว</p>
                </div>
                <div class="flex flex-col gap-3">
                    <button id="btn-modal-submit" onclick="window.app.finalConfirmVoting()" class="w-full bg-blue-500 text-white py-3 rounded-xl font-bold hover:bg-blue-800 transition active:scale-95">
                        ยืนยันการรับบัตรเลือกตั้ง
                    </button>
                    <button onclick="window.app.closeModal()" class="w-full bg-red-500 text-white py-3 rounded-xl font-semibold hover:bg-red-800 transition">
                        ยกเลิกรายการ
                    </button>
                </div>
            </div>
        </div>

        <!-- Error Screen -->
        <div id="screen-error-device" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20 border-2 border-red-50">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="alert-circle" class="text-red-600 w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold text-red-700 mb-2">ไม่สามารถดำเนินการได้</h2>
            <p id="error-msg-text" class="text-gray-600 mb-6 text-sm">
                เกิดข้อผิดพลาดในการประมวลผล กรุณาลองใหม่อีกครั้ง
            </p>
            <button onclick="window.location.reload()" class="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition">
                ตกลง
            </button>
        </div>

        <!-- Footer -->
        <p class="text-center text-gray-400 text-xs mt-8">
            ระบบลงทะเบียนสมาชิกสหกรณ์ <br/>
            © 2026 สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด
        </p>
    </main>

    <!-- Firebase and Application Logic -->
    <script type="module">
const _0x114949=_0x511e;(function(_0x3332ea,_0x316ce8){const _0x57fcf7=_0x511e,_0x40c3b4=_0x3332ea();while(!![]){try{const _0x4e2fc3=parseInt(_0x57fcf7(0x213))/0x1*(-parseInt(_0x57fcf7(0x22b))/0x2)+parseInt(_0x57fcf7(0x206))/0x3*(parseInt(_0x57fcf7(0x253))/0x4)+-parseInt(_0x57fcf7(0x21b))/0x5+parseInt(_0x57fcf7(0x241))/0x6*(-parseInt(_0x57fcf7(0x240))/0x7)+-parseInt(_0x57fcf7(0x248))/0x8+parseInt(_0x57fcf7(0x238))/0x9+-parseInt(_0x57fcf7(0x1ef))/0xa*(-parseInt(_0x57fcf7(0x244))/0xb);if(_0x4e2fc3===_0x316ce8)break;else _0x40c3b4['push'](_0x40c3b4['shift']());}catch(_0x5b63ef){_0x40c3b4['push'](_0x40c3b4['shift']());}}}(_0x2640,0xa655b));function _0x2640(){const _0x3acd56=['disabled','add','lucide','/public/data/coop_registrations','7RSvlcK','6788748SOEaoH','TimeLogin','Auth\x20Error','91190FiAbHo','idCard','focus','undefined','8779304YWJBkt','closeModal','addEventListener','shadow-blue-200','G-9DJLWJ5LQ1','bg-blue-700','tmb_coop','getElementById','btn-back-main','ttb-register.firebasestorage.app','screen-success','4NOVGQc','DEV-','padStart','https://ttb-register-default-rtdb.asia-southeast1.firebasedate.app','input','hidden','remove','text-white','bg-gray-200','error','empty','screen-error-device','modal-confirm','forEach','ตรวจสอบ\x20/\x20ลงทะเบียน','2070SpLzRh','toLocaleTimeString','registration-form','slice','currentDocId','random','citizenId','data','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','voting-status-box','getItem','target','empName','map','app','classList','เกิดข้อผิดพลาด:\x20','ttb-register','th-TH','user','modal-user-name','btn-confirm-voting','1:1070273157855:web:5c8120e1df27e233d8676a','2656329MbpCKm','docs','encode','checked-in','icon-check-valid','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xl\x20font-bold\x22>','bg-blue-50/30','error-msg-text','staff-hint','parse','coop_device_identifier','load','voting-box-content','19833FuGnRi','btn-text','flow-returning','Submit\x20Error:','length','setItem','status','success-checkin-datetime','3855aVOaWm','border-gray-300','AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','replace','toLocaleDateString','border-blue-500','สมาชิกสหกรณ์','screen-form','text-gray-400','animate-pulse','submit','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-lg\x20font-bold\x22>ขอให้สมาชิกติดต่อเจ้าหน้าที่</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-sm\x20mt-2\x20leading-relaxed\x22>เพื่อขอบัตรเลือกตั้งกรรมการ\x20<br>สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย\x20จำกัด</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','createIcons','รับบัตรเลือกตั้ง','1070273157855','bg-white','8QUriFL','value','now','innerHTML','subtle','digest','success-user-name','artifacts/','join','CheckIN','voting-warning','innerText','SHA-256','3499272DRLwoL','toString','btn-submit','ttb-register.firebaseapp.com'];_0x2640=function(){return _0x3acd56;};return _0x2640();}import{initializeApp}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js';import{getAuth,signInAnonymously,onAuthStateChanged,signInWithCustomToken}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js';import{getFirestore,collection,addDoc,updateDoc,doc,serverTimestamp,query,where,getDocs,increment}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js';const TARGET_COLLECTION_NAME=_0x114949(0x24e),isSandboxEnv=typeof __firebase_config!==_0x114949(0x247);let firebaseConfig,finalCollectionPath;if(isSandboxEnv){firebaseConfig=JSON[_0x114949(0x20f)](__firebase_config);const appId=typeof __app_id!=='undefined'?__app_id:'default-app-id';finalCollectionPath=_0x114949(0x232)+appId+_0x114949(0x23f);}else firebaseConfig={'apiKey':_0x114949(0x21d),'authDomain':_0x114949(0x23b),'databaseURL':_0x114949(0x256),'projectId':_0x114949(0x200),'storageBucket':_0x114949(0x251),'messagingSenderId':_0x114949(0x229),'appId':_0x114949(0x205),'measurementId':_0x114949(0x24c)},finalCollectionPath=TARGET_COLLECTION_NAME;const state={'user':null,'idCard':'','currentDocId':null,'empName':''},app=initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app);function _0x511e(_0x1fba40,_0x495500){_0x1fba40=_0x1fba40-0x1eb;const _0x2640d9=_0x2640();let _0x511ed0=_0x2640d9[_0x1fba40];return _0x511ed0;}async function sha256(_0x6d07ea){const _0x39fa59=_0x114949,_0x4efe9f=new TextEncoder()[_0x39fa59(0x208)](_0x6d07ea),_0x2f4548=await crypto[_0x39fa59(0x22f)][_0x39fa59(0x230)](_0x39fa59(0x237),_0x4efe9f),_0x5ea755=Array['from'](new Uint8Array(_0x2f4548)),_0x587967=_0x5ea755[_0x39fa59(0x1fc)](_0x4c7536=>_0x4c7536[_0x39fa59(0x239)](0x10)[_0x39fa59(0x255)](0x2,'0'))[_0x39fa59(0x233)]('');return _0x587967;}function getDeviceId(){const _0x3fcc66=_0x114949,_0x301766=_0x3fcc66(0x210);let _0x1d7e10=localStorage[_0x3fcc66(0x1f9)](_0x301766);return!_0x1d7e10&&(_0x1d7e10=_0x3fcc66(0x254)+Date[_0x3fcc66(0x22d)]()[_0x3fcc66(0x239)](0x24)+Math[_0x3fcc66(0x1f4)]()['toString'](0x24)['substr'](0x2,0x9),localStorage[_0x3fcc66(0x218)](_0x301766,_0x1d7e10)),_0x1d7e10;}window[_0x114949(0x1fd)]={'resetForm':()=>{const _0x1d3562=_0x114949,_0x3bddc7=['screen-success',_0x1d3562(0x1eb),_0x1d3562(0x1ec)];_0x3bddc7[_0x1d3562(0x1ed)](_0x1f43d1=>document[_0x1d3562(0x24f)](_0x1f43d1)[_0x1d3562(0x1fe)][_0x1d3562(0x23d)](_0x1d3562(0x258))),document[_0x1d3562(0x24f)]('screen-form')[_0x1d3562(0x1fe)]['remove']('hidden');const _0x4287ca=document[_0x1d3562(0x24f)](_0x1d3562(0x245));_0x4287ca[_0x1d3562(0x22c)]='',state[_0x1d3562(0x245)]='',state[_0x1d3562(0x1f3)]=null,state[_0x1d3562(0x1fb)]='';const _0x782baa=document[_0x1d3562(0x24f)](_0x1d3562(0x23a));_0x782baa[_0x1d3562(0x23c)]=!![],_0x782baa['classList'][_0x1d3562(0x23d)]('bg-gray-200',_0x1d3562(0x223)),_0x782baa[_0x1d3562(0x1fe)][_0x1d3562(0x259)]('bg-blue-700',_0x1d3562(0x25a)),document[_0x1d3562(0x24f)](_0x1d3562(0x1f8))[_0x1d3562(0x1fe)]['remove'](_0x1d3562(0x224)),document[_0x1d3562(0x24f)]('voting-box-content')[_0x1d3562(0x22e)]=_0x1d3562(0x226),document[_0x1d3562(0x24f)](_0x1d3562(0x204))[_0x1d3562(0x1fe)][_0x1d3562(0x259)](_0x1d3562(0x258)),document[_0x1d3562(0x24f)]('btn-confirm-voting')['disabled']=![],document[_0x1d3562(0x24f)](_0x1d3562(0x20e))[_0x1d3562(0x1fe)][_0x1d3562(0x259)]('hidden'),document[_0x1d3562(0x24f)](_0x1d3562(0x235))[_0x1d3562(0x1fe)]['remove']('hidden'),document['getElementById'](_0x1d3562(0x20a))['classList']['add']('hidden'),_0x4287ca[_0x1d3562(0x1fe)][_0x1d3562(0x259)](_0x1d3562(0x220),_0x1d3562(0x20c)),_0x4287ca[_0x1d3562(0x1fe)][_0x1d3562(0x23d)](_0x1d3562(0x21c),_0x1d3562(0x22a)),_0x4287ca[_0x1d3562(0x246)]();},'closeModal':()=>{const _0x55a044=_0x114949;document['getElementById'](_0x55a044(0x1ec))['classList'][_0x55a044(0x23d)](_0x55a044(0x258));},'confirmVotingCard':()=>{const _0x432e6f=_0x114949;document['getElementById'](_0x432e6f(0x203))[_0x432e6f(0x236)]=state[_0x432e6f(0x1fb)],document[_0x432e6f(0x24f)](_0x432e6f(0x1ec))['classList']['remove']('hidden');},'finalConfirmVoting':async()=>{const _0x119c0b=_0x114949;if(!state['currentDocId'])return;const _0x25a2eb=document[_0x119c0b(0x24f)]('btn-modal-submit');_0x25a2eb[_0x119c0b(0x23c)]=!![],_0x25a2eb['innerText']='ได้รับบัตรเลือกตั้งแล้ว';try{const _0x2b99fd=new Date();await updateDoc(doc(db,finalCollectionPath,state[_0x119c0b(0x1f3)]),{'ConfirmVotingCard':serverTimestamp(),'CardPoll':_0x119c0b(0x228)}),window[_0x119c0b(0x1fd)][_0x119c0b(0x249)](),document['getElementById'](_0x119c0b(0x1f8))[_0x119c0b(0x1fe)]['remove'](_0x119c0b(0x224)),document[_0x119c0b(0x24f)](_0x119c0b(0x212))['innerHTML']=_0x119c0b(0x20b)+state['empName']+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-lg\x20mt-1\x20font-semibold\x22>ขอยืนยันการรับบัตรเลือกตั้งแล้ว</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-sm\x20mt-2\x20opacity-90\x22>เมื่อ\x20'+_0x2b99fd[_0x119c0b(0x21f)]('th-TH')+'\x20'+_0x2b99fd[_0x119c0b(0x1f0)](_0x119c0b(0x201))+_0x119c0b(0x1f7),document[_0x119c0b(0x24f)](_0x119c0b(0x20e))[_0x119c0b(0x1fe)][_0x119c0b(0x23d)](_0x119c0b(0x258)),document['getElementById']('btn-confirm-voting')[_0x119c0b(0x1fe)][_0x119c0b(0x23d)]('hidden'),document['getElementById'](_0x119c0b(0x235))['classList']['add'](_0x119c0b(0x258)),document[_0x119c0b(0x24f)](_0x119c0b(0x250))[_0x119c0b(0x1fe)][_0x119c0b(0x259)](_0x119c0b(0x258)),confetti({'particleCount':0xc8,'spread':0x50,'origin':{'y':0.6}});}catch(_0x1face5){console['error']('Confirm\x20voting\x20error:',_0x1face5),_0x25a2eb[_0x119c0b(0x23c)]=![],_0x25a2eb[_0x119c0b(0x236)]='ยืนยัน\x20(ลองใหม่อีกครั้ง)';}}};function showSuccess(_0x5eec82,_0x2895b6){const _0x308057=_0x114949;state[_0x308057(0x1fb)]=_0x5eec82['EmpName']||_0x308057(0x221);const _0x37d343=document[_0x308057(0x24f)](_0x308057(0x231));_0x37d343[_0x308057(0x236)]=state['empName'];const _0x7b8593=document[_0x308057(0x24f)](_0x308057(0x21a)),_0x5c1381=new Date();_0x7b8593[_0x308057(0x236)]='ลงทะเบียนเมื่อ:\x20'+_0x5c1381[_0x308057(0x21f)](_0x308057(0x201))+'\x20'+_0x5c1381[_0x308057(0x1f0)](_0x308057(0x201));const _0x1945a2=document[_0x308057(0x24f)]('flow-first-time'),_0x21d96a=document[_0x308057(0x24f)](_0x308057(0x215)),_0x449094=document[_0x308057(0x24f)](_0x308057(0x250));_0x2895b6?(_0x1945a2[_0x308057(0x1fe)][_0x308057(0x259)]('hidden'),_0x21d96a[_0x308057(0x1fe)][_0x308057(0x23d)](_0x308057(0x258)),_0x449094[_0x308057(0x1fe)][_0x308057(0x23d)]('hidden')):(_0x1945a2[_0x308057(0x1fe)][_0x308057(0x23d)](_0x308057(0x258)),_0x21d96a[_0x308057(0x1fe)][_0x308057(0x259)](_0x308057(0x258)),document['getElementById']('login-count-text')['innerText']=_0x5eec82[_0x308057(0x242)],_0x449094[_0x308057(0x1fe)]['remove']('hidden'));document['getElementById'](_0x308057(0x222))[_0x308057(0x1fe)]['add'](_0x308057(0x258)),document[_0x308057(0x24f)](_0x308057(0x252))[_0x308057(0x1fe)][_0x308057(0x259)](_0x308057(0x258));if(window[_0x308057(0x23e)])lucide[_0x308057(0x227)]();}async function submitForm(_0x7cae8a){const _0x46e9e6=_0x114949;_0x7cae8a['preventDefault']();if(!state[_0x46e9e6(0x202)])return;const _0x3ae2c4=document['getElementById'](_0x46e9e6(0x23a)),_0xecbb85=document[_0x46e9e6(0x24f)](_0x46e9e6(0x214)),_0x12625a=document['getElementById']('btn-loader');_0x3ae2c4[_0x46e9e6(0x23c)]=!![],_0xecbb85['innerText']='กำลังประมวลผล...',_0x12625a['classList'][_0x46e9e6(0x259)](_0x46e9e6(0x258));try{const _0x3195b9=getDeviceId(),_0x2bfa0f=state['idCard']['replace'](/-/g,''),_0x3b4051=await sha256(_0x2bfa0f),_0x2d5ad1=query(collection(db,finalCollectionPath),where(_0x46e9e6(0x1f5),'==',_0x3b4051)),_0x389e6a=await getDocs(_0x2d5ad1);if(!_0x389e6a[_0x46e9e6(0x25d)]){const _0x137ea2=_0x389e6a[_0x46e9e6(0x207)][0x0],_0x3ec09f=_0x137ea2[_0x46e9e6(0x1f6)]();state[_0x46e9e6(0x1f3)]=_0x137ea2['id'];const _0x56986a=(_0x3ec09f[_0x46e9e6(0x242)]||0x0)+0x1,_0x4f7cdb={'TimeLogin':increment(0x1),'deviceId':_0x3195b9};!_0x3ec09f[_0x46e9e6(0x234)]&&(_0x4f7cdb['CheckIN']=serverTimestamp(),_0x4f7cdb[_0x46e9e6(0x219)]='checked-in');await updateDoc(doc(db,finalCollectionPath,_0x137ea2['id']),_0x4f7cdb);const _0x234717={..._0x3ec09f,'TimeLogin':_0x56986a};showSuccess(_0x234717,_0x56986a===0x1);}else{const _0x422384=await addDoc(collection(db,finalCollectionPath),{'citizenId':_0x3b4051,'deviceId':_0x3195b9,'CheckIN':serverTimestamp(),'TimeLogin':0x1,'status':_0x46e9e6(0x209)});state[_0x46e9e6(0x1f3)]=_0x422384['id'],showSuccess({'TimeLogin':0x1},!![]);}}catch(_0xcaeec5){console[_0x46e9e6(0x25c)](_0x46e9e6(0x216),_0xcaeec5),document[_0x46e9e6(0x24f)](_0x46e9e6(0x20d))[_0x46e9e6(0x236)]=_0x46e9e6(0x1ff)+_0xcaeec5['message'],document[_0x46e9e6(0x24f)](_0x46e9e6(0x222))[_0x46e9e6(0x1fe)][_0x46e9e6(0x23d)](_0x46e9e6(0x258)),document['getElementById'](_0x46e9e6(0x1eb))[_0x46e9e6(0x1fe)]['remove'](_0x46e9e6(0x258));}finally{_0x3ae2c4['disabled']=![],_0xecbb85[_0x46e9e6(0x236)]=_0x46e9e6(0x1ee),_0x12625a['classList'][_0x46e9e6(0x23d)]('hidden');}}function handleIdInput(_0x550a20){const _0x35a2e9=_0x114949;let _0x6aa1f9=_0x550a20[_0x35a2e9(0x1fa)]['value'][_0x35a2e9(0x21e)](/[^0-9]/g,'');if(_0x6aa1f9[_0x35a2e9(0x217)]>0xd)_0x6aa1f9=_0x6aa1f9['slice'](0x0,0xd);let _0x189136=_0x6aa1f9;if(_0x6aa1f9[_0x35a2e9(0x217)]>0x1)_0x189136=_0x6aa1f9[_0x35a2e9(0x1f2)](0x0,0x1)+'-'+_0x6aa1f9['slice'](0x1);if(_0x6aa1f9[_0x35a2e9(0x217)]>0x5)_0x189136=_0x189136['slice'](0x0,0x6)+'-'+_0x189136[_0x35a2e9(0x1f2)](0x6);if(_0x6aa1f9[_0x35a2e9(0x217)]>0xa)_0x189136=_0x189136['slice'](0x0,0xc)+'-'+_0x189136[_0x35a2e9(0x1f2)](0xc);if(_0x6aa1f9[_0x35a2e9(0x217)]>0xc)_0x189136=_0x189136[_0x35a2e9(0x1f2)](0x0,0xf)+'-'+_0x189136[_0x35a2e9(0x1f2)](0xf);state[_0x35a2e9(0x245)]=_0x189136,_0x550a20[_0x35a2e9(0x1fa)][_0x35a2e9(0x22c)]=_0x189136;const _0x320b22=document[_0x35a2e9(0x24f)](_0x35a2e9(0x23a)),_0x3ef1a6=document['getElementById'](_0x35a2e9(0x20a));_0x6aa1f9[_0x35a2e9(0x217)]===0xd?(_0x320b22[_0x35a2e9(0x23c)]=![],_0x320b22[_0x35a2e9(0x1fe)][_0x35a2e9(0x23d)](_0x35a2e9(0x24d),_0x35a2e9(0x25a),_0x35a2e9(0x24b)),_0x320b22[_0x35a2e9(0x1fe)]['remove'](_0x35a2e9(0x25b),_0x35a2e9(0x223)),_0x3ef1a6[_0x35a2e9(0x1fe)][_0x35a2e9(0x259)](_0x35a2e9(0x258)),_0x550a20[_0x35a2e9(0x1fa)][_0x35a2e9(0x1fe)]['add']('border-blue-500',_0x35a2e9(0x20c))):(_0x320b22['disabled']=!![],_0x320b22['classList'][_0x35a2e9(0x259)](_0x35a2e9(0x24d),_0x35a2e9(0x25a),_0x35a2e9(0x24b)),_0x320b22['classList'][_0x35a2e9(0x23d)]('bg-gray-200',_0x35a2e9(0x223)),_0x3ef1a6['classList'][_0x35a2e9(0x23d)](_0x35a2e9(0x258)),_0x550a20[_0x35a2e9(0x1fa)]['classList'][_0x35a2e9(0x259)](_0x35a2e9(0x220),_0x35a2e9(0x20c)));}async function initAuth(){const _0x4d84e6=_0x114949;try{typeof __initial_auth_token!==_0x4d84e6(0x247)&&__initial_auth_token?await signInWithCustomToken(auth,__initial_auth_token):await signInAnonymously(auth);}catch(_0x2aa872){console[_0x4d84e6(0x25c)](_0x4d84e6(0x243),_0x2aa872);}}onAuthStateChanged(auth,_0xc56533=>{const _0x56e573=_0x114949;state[_0x56e573(0x202)]=_0xc56533;}),document[_0x114949(0x24f)](_0x114949(0x1f1))[_0x114949(0x24a)](_0x114949(0x225),submitForm),document['getElementById'](_0x114949(0x245))[_0x114949(0x24a)](_0x114949(0x257),handleIdInput),window[_0x114949(0x24a)](_0x114949(0x211),()=>{const _0x50c768=_0x114949;document['getElementById']('idCard')[_0x50c768(0x246)]();if(window[_0x50c768(0x23e)])lucide['createIcons']();}),initAuth();
    </script>
</body>
</html>
