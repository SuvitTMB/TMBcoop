<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ลงทะเบียนออกและลุ้นรางวัล - สหกรณ์ออมทรัพย์ฯ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Font (Sarabun) -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Confetti for Lucky Draw -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .hidden { display: none !important; }
        /* Custom Animations */
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes bounce-slow {
            0%, 100% { transform: translateY(-5%); }
            50% { transform: translateY(5%); }
        }
        .animate-bounce-slow { animation: bounce-slow 2s infinite; }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-10">

    <!-- Header Section -->
    <div class="bg-gradient-to-r from-purple-600 to-indigo-700 text-white p-6 rounded-b-[2.5rem] shadow-lg mb-8 relative overflow-hidden">
        <div class="absolute top-0 right-0 opacity-10 transform translate-x-10 -translate-y-10">
            <i data-lucide="gift" width="150" height="150"></i>
        </div>
        
        <div class="relative z-10 flex flex-col items-center">
            <div class="bg-white/20 p-3 rounded-full mb-3 backdrop-blur-sm">
                <i data-lucide="party-popper" width="32" height="32" class="text-white"></i>
            </div>
            <h1 class="text-xl font-bold text-center">กิจกรรมลุ้นรางวัล</h1>
            <p class="text-purple-100 text-sm mt-1">สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด</p>
        </div>
    </div>

    <!-- Main Content Container -->
    <main class="px-2 sm:px-4 max-w-lg mx-auto -mt-10">
        
        <!-- Form Screen (Check-out first) -->
        <div id="screen-form" class="bg-white rounded-2xl shadow-xl p-6 border border-slate-100 relative z-20">
            <form id="registration-form" class="space-y-6 pt-2">
                <center>
                    <h2 class="text-lg font-bold text-gray-700 mb-4">ลงทะเบียนออกเพื่อลุ้นรางวัล</h2>
                    <div>
                        <label for="idCard" class="block text-sm font-semibold text-gray-700 mb-2">
                            เลขบัตรประจำตัวประชาชน
                        </label>
                        <div class="relative">
                            <input
                                type="text"
                                id="idCard"
                                placeholder="x-xxxx-xxxxx-xx-x"
                                class="w-full text-xl font-mono tracking-wide p-4 rounded-xl border-2 border-gray-200 bg-white focus:border-purple-400 focus:ring-4 focus:ring-purple-100 outline-none transition-all text-center"
                                inputmode="numeric"
                                maxlength="17"
                            />
                            <i id="icon-check-valid" data-lucide="check-circle" class="hidden absolute right-4 top-1/2 transform -translate-y-1/2 text-green-500 w-6 h-6 animate-fade-in"></i>
                        </div>
                        <p class="text-xs text-gray-400 mt-2 ml-1">กรุณากรอกตัวเลข 13 หลักให้ครบถ้วน</p>
                    </div>

                    <div class="p-3 bg-purple-50 text-purple-800 rounded-lg text-xs flex gap-2 items-start" style="margin-top:25px;">
                        <i data-lucide="shield-alert" class="w-4 h-4 shrink-0 mt-0.5"></i>
                        <span>ระบบจำกัดสิทธิ์ 1 เครื่อง / 1 ท่าน หากลงทะเบียนแล้วจะไม่สามารถเปลี่ยนเครื่องได้</span>
                    </div>
                </center>

                <button
                    type="submit"
                    id="btn-submit"
                    disabled
                    class="w-full py-3 rounded-lg font-semibold text-base shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2 bg-gray-200 text-gray-400 cursor-not-allowed shadow-none"
                >
                    <span id="btn-text">ลงทะเบียนออก</span>
                    <i id="btn-loader" data-lucide="loader-2" class="hidden animate-spin"></i>
                </button>
            </form>
        </div>

        <!-- Success Screen (Check-out Done & Reward Summary) -->
        <div id="screen-success" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i data-lucide="check-circle" class="text-green-600 w-10 h-10"></i>
            </div>
            
            <h2 id="success-title" class="text-xl font-bold text-gray-800 mb-4">ลงทะเบียนออกสำเร็จ</h2>
            
            <!-- Time Grid -->
            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="bg-blue-50 p-3 rounded-xl border border-blue-100 flex flex-col items-center justify-center">
                    <p class="text-xs font-bold text-blue-800 uppercase mb-1">ลงทะเบียนเข้า</p>
                    <p id="success-checkin-time" class="text-blue-600 font-mono text-sm font-semibold">--:--</p>
                </div>
                <div class="bg-orange-50 p-3 rounded-xl border border-orange-100 flex flex-col items-center justify-center">
                    <p class="text-xs font-bold text-orange-800 uppercase mb-1">ลงทะเบียนออก</p>
                    <p id="success-checkout-time" class="text-orange-600 font-mono text-sm font-semibold">--:--</p>
                </div>
            </div>
            
            <!-- Message Box (Will be hidden when reward exists) -->
            <div id="msg-box-recorded" class="bg-green-50 border border-green-100 rounded-xl p-5 mb-6 text-left shadow-sm">
                <h3 id="success-msg-header" class="font-bold text-green-900 mb-2 text-lg flex items-center gap-2">
                    <i data-lucide="calendar-check" width="20"></i> บันทึกเวลาเรียบร้อย
                </h3>
                <p id="success-msg-body" class="text-sm text-gray-700">
                    ท่านได้ลงทะเบียนออกและมีสิทธิ์ลุ้นรับรางวัลพิเศษจำนวน 50 รางวัล และขอให้ท่านเดินทางกลับโดยสวัสดิภาพ
                </p>
            </div>
            
            <!-- Lucky Draw Action Area -->
            <div id="lucky-draw-action-container">
                <!-- Case 1: Button for new draw -->
                <button id="btn-start-draw" onclick="window.app.goToLuckyDraw()" class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-white py-4 rounded-xl font-bold shadow-lg shadow-orange-200 hover:shadow-orange-300 transform hover:-translate-y-1 transition-all flex items-center justify-center gap-2 text-lg animate-bounce-slow">
                    <i data-lucide="gift" width="24"></i> กดเพื่อสุ่มของรางวัล
                </button>

                <!-- Case 2: Display Reward (Already drawn) -->
                <div id="reward-display-badge" class="hidden w-full bg-gradient-to-r from-purple-100 to-pink-100 border-2 border-purple-300 rounded-xl p-4 text-center shadow-inner mb-4">
                    <p class="text-sm text-purple-600 font-semibold mb-1">ของรางวัลของคุณคือ</p>
                    <p id="reward-name-text" class="text-xl font-bold text-purple-800">...</p>
                </div>

                <!-- Case 3: Claim Button (Added for Summary Page) -->
                <div id="claim-section-summary" class="hidden">
                    <button id="btn-claim-reward-summary" onclick="window.app.claimReward('summary')" class="w-full bg-green-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:bg-green-700 transition transform hover:scale-105 mb-2">
                        <i data-lucide="check-square" class="inline-block w-5 h-5 mr-1 mb-1"></i> ยืนยันการรับรางวัลแล้ว
                    </button>
                    <p id="text-claim-time-summary" class="text-xs text-gray-600 font-sm bg-green-50 p-3 rounded-lg border border-green-200 hidden">
                        <i data-lucide="clock" class="inline-block w-4 h-4 mr-1"></i> รับรางวัลเมื่อ: <span id="claim-time-val-summary"></span>
                    </p>
                </div>
            </div>

            <!-- Back to Registration Button -->
            <button onclick="window.app.resetForm()" class="mt-6 w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition flex items-center justify-center gap-2">
                <i data-lucide="log-out" width="18"></i> กลับสู่หน้าลงทะเบียน
            </button>
        </div>

        <!-- Lucky Draw Screen (Spinning & Result) -->
        <div id="screen-luckydraw" class="hidden bg-white rounded-2xl shadow-xl p-6 w-full text-center animate-fade-in relative z-20 min-h-[400px] flex flex-col items-center justify-center">
            
            <!-- State 1: Validating -->
            <div id="draw-state-validating" class="w-full">
                <div class="w-24 h-24 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse">
                    <i data-lucide="scan-face" class="text-blue-500 w-12 h-12"></i>
                </div>
                <h2 class="text-xl font-bold text-gray-800 mb-2">กำลังตรวจสอบข้อมูลพนักงาน...</h2>
                <p class="text-gray-500 text-sm">กรุณารอสักครู่ ระบบกำลังยืนยันสิทธิ์ของท่าน</p>
                <div class="mt-6 w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-200 overflow-hidden">
                    <div class="bg-blue-600 h-2.5 rounded-full" style="width: 0%; transition: width 2s ease-in-out;" id="validate-progress"></div>
                </div>
            </div>

            <!-- State 2: Spinning -->
            <div id="draw-state-spinning" class="hidden w-full">
                <div class="relative w-32 h-32 mx-auto mb-6">
                    <div class="absolute inset-0 border-4 border-t-purple-500 border-gray-200 rounded-full animate-spin"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i data-lucide="gift" class="text-purple-500 w-12 h-12"></i>
                    </div>
                </div>
                <h2 class="text-2xl font-bold text-purple-700 mb-2" id="spin-text">กำลังสุ่มรางวัล...</h2>
                <div class="h-8 overflow-hidden relative mt-2">
                    <div id="prize-ticker" class="text-gray-400 text-lg transition-all duration-100">...</div>
                </div>
            </div>

            <!-- State 3: Result -->
            <div id="draw-state-result" class="hidden w-full">
                <div class="mb-2 text-yellow-500">
                    <i data-lucide="crown" width="60" height="60" class="mx-auto"></i>
                </div>
                <h2 class="text-lg font-bold text-gray-500 mb-1">ยินดีด้วย! ท่านได้รับ</h2>
                <div class="bg-gradient-to-r from-yellow-100 to-orange-100 border-2 border-yellow-300 p-6 rounded-2xl mb-6 shadow-inner relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-2 opacity-20"><i data-lucide="sparkles" width="40"></i></div>
                    <h1 id="prize-result-name" class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-600 to-red-600 drop-shadow-sm mb-4">
                        รอสักครู่...
                    </h1>
                </div>
                
                <!-- Claim Reward Section -->
                <div id="claim-section" class="mb-6">
                    <button id="btn-claim-reward" onclick="window.app.claimReward('result')" class="bg-green-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:bg-green-700 transition transform hover:scale-105 hidden">
                        <i data-lucide="check-square" class="inline-block w-5 h-5 mr-1 mb-1"></i> ยืนยันการรับรางวัลแล้ว
                    </button>
                    <p id="text-claim-time" class="text-green-700 font-medium bg-green-50 p-3 rounded-lg border border-green-200 hidden">
                        <i data-lucide="clock" class="inline-block w-4 h-4 mr-1"></i> รับรางวัลเมื่อ: <span id="claim-time-val" class="font-bold"></span>
                    </p>
                </div>

                <p class="text-xs text-gray-400 mb-6">กรุณาให้เจ้าน้าที่ทำการกดปุ่มยืนยันการรับรางวัล</p>

                <button onclick="window.app.backToSummary()" class="w-full bg-gray-800 text-white py-3 rounded-xl font-semibold hover:bg-gray-900 transition">
                    กลับสู่หน้าหลัก (Check-out)
                </button>
            </div>

        </div>

        <!-- Error Screen -->
        <div id="screen-error-device" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="alert-triangle" class="text-red-600 w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold text-red-700 mb-2">เกิดข้อผิดพลาด</h2>
            <p id="error-msg-text" class="text-gray-600 mb-6 text-sm">ไม่สามารถดำเนินการได้</p>
            <button onclick="window.location.reload()" class="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition">ปิด</button>
        </div>

        <!-- Not Found Screen -->
        <div id="screen-not-found" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="user-x" class="text-amber-600 w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold text-amber-700 mb-2">ไม่พบข้อมูล</h2>
            <p class="text-gray-600 mb-6 text-sm">กรุณาลงทะเบียนเข้าก่อนทำการลงทะเบียนออก</p>
            <button onclick="window.app.resetForm()" class="w-full bg-amber-500 text-white py-3 rounded-xl font-semibold hover:bg-amber-600 transition">ปิด</button>
        </div>

        <p class="text-center text-gray-400 text-xs mt-8">
            ระบบสุ่มรางวัลสมาชิกสหกรณ์ <br/>
            © 2024 สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด
        </p>
    </main>

    <script type="module">
const _0x33f166=_0x36bc;(function(_0x55e4f9,_0x120ba7){const _0x535dda=_0x36bc,_0xdf9ee4=_0x55e4f9();while(!![]){try{const _0x23a75e=parseInt(_0x535dda(0x116))/0x1+-parseInt(_0x535dda(0x10a))/0x2+parseInt(_0x535dda(0x13b))/0x3*(parseInt(_0x535dda(0x101))/0x4)+parseInt(_0x535dda(0x109))/0x5+-parseInt(_0x535dda(0xcd))/0x6+parseInt(_0x535dda(0x136))/0x7+parseInt(_0x535dda(0x138))/0x8*(-parseInt(_0x535dda(0x10d))/0x9);if(_0x23a75e===_0x120ba7)break;else _0xdf9ee4['push'](_0xdf9ee4['shift']());}catch(_0x4f4dcf){_0xdf9ee4['push'](_0xdf9ee4['shift']());}}}(_0x3f53,0xa8fe4));import{initializeApp}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js';import{getAuth,signInAnonymously,onAuthStateChanged,signInWithCustomToken}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js';import{getFirestore,collection,updateDoc,doc,serverTimestamp,query,where,getDocs,getDoc,addDoc,onSnapshot}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js';const TARGET_COLLECTION_NAME='tmb_coop',PRIZES_COLLECTION_NAME='coop_gift',isSandboxEnv=typeof __firebase_config!==_0x33f166(0xb0);let firebaseConfig,finalCollectionPath,prizesCollectionPath;if(isSandboxEnv){firebaseConfig=JSON[_0x33f166(0xdf)](__firebase_config);const appId=typeof __app_id!==_0x33f166(0xb0)?__app_id:_0x33f166(0xda);finalCollectionPath=_0x33f166(0xd2)+appId+_0x33f166(0x10b),prizesCollectionPath=_0x33f166(0xd2)+appId+'/public/data/'+PRIZES_COLLECTION_NAME;}else firebaseConfig={'apiKey':'AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','authDomain':_0x33f166(0xfc),'databaseURL':'https://ttb-register-default-rtdb.asia-southeast1.firebasedate.app','projectId':_0x33f166(0x10e),'storageBucket':'ttb-register.firebasestorage.app','messagingSenderId':_0x33f166(0xae),'appId':_0x33f166(0x111),'measurementId':_0x33f166(0xe1)},finalCollectionPath=TARGET_COLLECTION_NAME,prizesCollectionPath=PRIZES_COLLECTION_NAME;const app=initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app),state={'user':null,'idCard':'','currentDocId':null,'userHash':null,'currentReward':null,'prizesList':[]};async function sha256(_0x185472){const _0x13d6fc=_0x33f166,_0x42abf2=new TextEncoder()[_0x13d6fc(0xd8)](_0x185472),_0x39679e=await crypto[_0x13d6fc(0xdd)][_0x13d6fc(0x119)](_0x13d6fc(0xb8),_0x42abf2),_0xe226d8=Array[_0x13d6fc(0xe9)](new Uint8Array(_0x39679e));return _0xe226d8[_0x13d6fc(0x134)](_0x20b60d=>_0x20b60d[_0x13d6fc(0x11b)](0x10)[_0x13d6fc(0x131)](0x2,'0'))[_0x13d6fc(0x110)]('');}function getDeviceId(){const _0x4fd36a=_0x33f166,_0x27da1e=_0x4fd36a(0xdc);let _0x1e4623=localStorage[_0x4fd36a(0xf6)](_0x27da1e);if(!_0x1e4623){const _0xe29c2b=document[_0x4fd36a(0xfe)][_0x4fd36a(0x12c)](new RegExp(_0x4fd36a(0x115)+_0x27da1e+_0x4fd36a(0x117)));_0xe29c2b&&(_0x1e4623=_0xe29c2b[0x2],localStorage[_0x4fd36a(0x120)](_0x27da1e,_0x1e4623));}return!_0x1e4623?(_0x1e4623=_0x4fd36a(0xb2)+Date[_0x4fd36a(0xcb)]()['toString'](0x24)+Math[_0x4fd36a(0xc9)]()['toString'](0x24)[_0x4fd36a(0x11e)](0x2,0x9),localStorage[_0x4fd36a(0x120)](_0x27da1e,_0x1e4623),document[_0x4fd36a(0xfe)]=_0x27da1e+'='+_0x1e4623+_0x4fd36a(0xb7)):document[_0x4fd36a(0xfe)]=_0x27da1e+'='+_0x1e4623+_0x4fd36a(0xb7),_0x1e4623;}function setLocalRegistration(_0x16d45b){const _0x54f3c8=_0x33f166;localStorage[_0x54f3c8(0x120)]('coop_registered_citizen_id',_0x16d45b);}function getLocalRegistration(){const _0x287e2f=_0x33f166;return localStorage[_0x287e2f(0xf6)](_0x287e2f(0x11c));}window[_0x33f166(0x113)]={'resetForm':()=>{const _0x58f01d=_0x33f166;[_0x58f01d(0xff),_0x58f01d(0x12b),'screen-not-found',_0x58f01d(0xd0)][_0x58f01d(0x13c)](_0x6324bd=>document[_0x58f01d(0xc6)](_0x6324bd)[_0x58f01d(0x112)][_0x58f01d(0x104)](_0x58f01d(0xe7))),document[_0x58f01d(0xc6)](_0x58f01d(0x126))[_0x58f01d(0x112)][_0x58f01d(0xb6)](_0x58f01d(0xe7)),document[_0x58f01d(0xc6)](_0x58f01d(0xf8))['value']='',document['getElementById'](_0x58f01d(0xc0))[_0x58f01d(0x112)]['add'](_0x58f01d(0xe7)),document[_0x58f01d(0xc6)](_0x58f01d(0xfb))['classList'][_0x58f01d(0x104)](_0x58f01d(0xe7)),document['getElementById'](_0x58f01d(0xf1))[_0x58f01d(0x112)][_0x58f01d(0xb6)]('hidden');const _0x407455=document['getElementById']('btn-submit');_0x407455['disabled']=!![],_0x407455[_0x58f01d(0x112)]['add'](_0x58f01d(0x11d),_0x58f01d(0xf2)),_0x407455['classList'][_0x58f01d(0xb6)](_0x58f01d(0x139),_0x58f01d(0xe5)),document[_0x58f01d(0xc6)]('btn-text')['innerText']=_0x58f01d(0x127),document[_0x58f01d(0xc6)](_0x58f01d(0xf5))[_0x58f01d(0x112)][_0x58f01d(0x104)](_0x58f01d(0xe7)),state[_0x58f01d(0xf8)]='',state[_0x58f01d(0xea)]=null,state[_0x58f01d(0x123)]=null,document['getElementById'](_0x58f01d(0xf8))['focus']();},'goToLuckyDraw':async()=>{const _0x58d35e=_0x33f166;document[_0x58d35e(0xc6)]('screen-success')[_0x58d35e(0x112)]['add']('hidden'),document[_0x58d35e(0xc6)](_0x58d35e(0xd0))[_0x58d35e(0x112)][_0x58d35e(0xb6)](_0x58d35e(0xe7)),document[_0x58d35e(0xc6)](_0x58d35e(0x13e))['classList']['remove']('hidden'),document[_0x58d35e(0xc6)](_0x58d35e(0xc8))[_0x58d35e(0x112)]['add']('hidden'),document[_0x58d35e(0xc6)](_0x58d35e(0xde))[_0x58d35e(0x112)][_0x58d35e(0x104)]('hidden'),setTimeout(()=>{const _0x5034e0=_0x58d35e;document[_0x5034e0(0xc6)](_0x5034e0(0x122))['style'][_0x5034e0(0x133)]=_0x5034e0(0x118);},0x64),setTimeout(()=>{const _0x483f71=_0x58d35e;document[_0x483f71(0xc6)](_0x483f71(0x122))[_0x483f71(0xd5)][_0x483f71(0x133)]=_0x483f71(0xaf);},0x5dc),setTimeout(async()=>{const _0x4e3152=_0x58d35e;if(state['currentDocId'])try{const _0x2af13a=doc(db,finalCollectionPath,state[_0x4e3152(0xea)]),_0x3f5f93=await getDoc(_0x2af13a),_0x1eb517=_0x3f5f93['data']();_0x3f5f93[_0x4e3152(0xbc)]()&&_0x1eb517[_0x4e3152(0x10f)]?showResult(_0x1eb517[_0x4e3152(0x10f)],!![],_0x1eb517[_0x4e3152(0xd4)]):startSpinning();}catch(_0x1f5b1d){console[_0x4e3152(0xc3)](_0x1f5b1d),alert(_0x4e3152(0xf9)),window[_0x4e3152(0x113)][_0x4e3152(0x106)]();}else alert(_0x4e3152(0xcf)),window['app'][_0x4e3152(0x106)]();},0x7d0);},'backToSummary':()=>{const _0x39ad62=_0x33f166;document[_0x39ad62(0xc6)]('screen-luckydraw')[_0x39ad62(0x112)][_0x39ad62(0x104)](_0x39ad62(0xe7)),document[_0x39ad62(0xc6)]('screen-success')['classList'][_0x39ad62(0xb6)](_0x39ad62(0xe7)),state[_0x39ad62(0x123)]&&(state['currentDocId']&&getDoc(doc(db,finalCollectionPath,state[_0x39ad62(0xea)]))[_0x39ad62(0xd7)](_0x4ec4ec=>{const _0x3a527d=_0x39ad62;_0x4ec4ec[_0x3a527d(0xbc)]()&&updateSuccessScreen(_0x4ec4ec['data']()[_0x3a527d(0x10f)],_0x4ec4ec[_0x3a527d(0xe2)]()[_0x3a527d(0xd4)]);}));},'claimReward':async _0x5c89bc=>{const _0x150394=_0x33f166;if(!state['currentDocId'])return;const _0x48438a=_0x5c89bc==='summary',_0x54ace0=_0x48438a?_0x150394(0xe3):_0x150394(0x135),_0x26d50b=_0x48438a?_0x150394(0x12f):'text-claim-time',_0x197141=_0x48438a?_0x150394(0x129):_0x150394(0x10c),_0x59b779=document[_0x150394(0xc6)](_0x54ace0),_0x4f20a8=_0x59b779[_0x150394(0xb1)];_0x59b779['disabled']=!![],_0x59b779[_0x150394(0x128)]=_0x150394(0xc1);try{await updateDoc(doc(db,finalCollectionPath,state[_0x150394(0xea)]),{'rewardClaimTime':serverTimestamp()});const _0xdd5552=new Date(),_0x54d2f1=_0xdd5552[_0x150394(0xfa)](_0x150394(0x124));_0x59b779[_0x150394(0x112)]['add'](_0x150394(0xe7)),document[_0x150394(0xc6)](_0x26d50b)[_0x150394(0x112)][_0x150394(0xb6)](_0x150394(0xe7)),document[_0x150394(0xc6)](_0x197141)[_0x150394(0x128)]=_0x54d2f1,confetti({'particleCount':0x64,'spread':0x3c,'origin':{'y':0.7}});}catch(_0x4f35be){console[_0x150394(0xc3)](_0x4f35be),alert('บันทึกการรับรางวัลไม่สำเร็จ\x20กรุณาลองใหม่'),_0x59b779[_0x150394(0xed)]=![],_0x59b779[_0x150394(0xb1)]=_0x4f20a8;}}};function updateSuccessScreen(_0x2794a5,_0x428cb9){const _0x56cf59=_0x33f166;document[_0x56cf59(0xc6)](_0x56cf59(0xce))[_0x56cf59(0x112)][_0x56cf59(0x104)](_0x56cf59(0xe7));const _0x32a5ee=document[_0x56cf59(0xc6)]('reward-display-badge');_0x32a5ee[_0x56cf59(0x112)]['remove'](_0x56cf59(0xe7)),document[_0x56cf59(0xc6)](_0x56cf59(0x132))[_0x56cf59(0x128)]=_0x2794a5,document[_0x56cf59(0xc6)]('msg-box-recorded')[_0x56cf59(0x112)][_0x56cf59(0x104)](_0x56cf59(0xe7));const _0x2543f4=document[_0x56cf59(0xc6)](_0x56cf59(0xfb)),_0x3f9f4d=document[_0x56cf59(0xc6)](_0x56cf59(0xe3)),_0x48ca8b=document['getElementById'](_0x56cf59(0x12f)),_0x4716e4=document[_0x56cf59(0xc6)](_0x56cf59(0x129));_0x2543f4[_0x56cf59(0x112)]['remove'](_0x56cf59(0xe7));if(_0x428cb9){_0x3f9f4d[_0x56cf59(0x112)]['add'](_0x56cf59(0xe7)),_0x48ca8b['classList'][_0x56cf59(0xb6)](_0x56cf59(0xe7));const _0x55e8e3=_0x428cb9['toDate']?_0x428cb9[_0x56cf59(0xc2)]():new Date(_0x428cb9);_0x4716e4[_0x56cf59(0x128)]=_0x55e8e3[_0x56cf59(0xfa)](_0x56cf59(0x124));}else _0x3f9f4d['classList'][_0x56cf59(0xb6)](_0x56cf59(0xe7)),_0x48ca8b[_0x56cf59(0x112)][_0x56cf59(0x104)](_0x56cf59(0xe7));}async function fetchPrizes(){const _0x114188=_0x33f166,_0x3b227c=query(collection(db,prizesCollectionPath));try{onSnapshot(_0x3b227c,_0x411c0d=>{const _0x3326f3=_0x36bc,_0x298878=[];_0x411c0d[_0x3326f3(0x13c)](_0xc77872=>_0x298878[_0x3326f3(0xf4)](_0xc77872[_0x3326f3(0xe2)]())),state['prizesList']=_0x298878;});}catch(_0x4ef874){console[_0x114188(0xc3)]('Fetch\x20Prizes\x20Error',_0x4ef874),state[_0x114188(0xca)]=[{'name':_0x114188(0xe8)}];}}function startSpinning(){const _0x149df7=_0x33f166;document[_0x149df7(0xc6)](_0x149df7(0x13e))[_0x149df7(0x112)][_0x149df7(0x104)](_0x149df7(0xe7)),document[_0x149df7(0xc6)](_0x149df7(0xc8))[_0x149df7(0x112)]['remove'](_0x149df7(0xe7));const _0x5453b3=[_0x149df7(0xe8),_0x149df7(0xb3),_0x149df7(0x108)],_0x5b7933=state[_0x149df7(0xca)]&&state[_0x149df7(0xca)][_0x149df7(0xd3)]>0x0?state[_0x149df7(0xca)][_0x149df7(0x134)](_0x2a0d53=>_0x2a0d53[_0x149df7(0xf0)]):_0x5453b3,_0x436cb7=document[_0x149df7(0xc6)](_0x149df7(0xef));let _0xd2a9a6=0x0;const _0x30acb8=setInterval(()=>{const _0x1feada=_0x149df7;_0x436cb7['innerText']=_0x5b7933[Math[_0x1feada(0xe4)](Math['random']()*_0x5b7933[_0x1feada(0xd3)])],_0xd2a9a6++,_0xd2a9a6>0x14&&(clearInterval(_0x30acb8),finalizePrize());},0x64);}async function finalizePrize(){const _0x33a737=_0x33f166,_0x530ef1=state[_0x33a737(0xca)]&&state[_0x33a737(0xca)]['length']>0x0?state['prizesList'][_0x33a737(0x134)](_0x28f09f=>_0x28f09f[_0x33a737(0xf0)]):[_0x33a737(0xe8)],_0x185839=_0x530ef1[Math[_0x33a737(0xe4)](Math[_0x33a737(0xc9)]()*_0x530ef1[_0x33a737(0xd3)])];try{state[_0x33a737(0xea)]&&(await updateDoc(doc(db,finalCollectionPath,state[_0x33a737(0xea)]),{'reward':_0x185839,'rewardTime':serverTimestamp()}),showResult(_0x185839,![],null));}catch(_0x119080){console[_0x33a737(0xc3)]('Save\x20Prize\x20Error:',_0x119080),alert(_0x33a737(0x11a));}}function showResult(_0x450500,_0x48bb80,_0x8caede){const _0x202b16=_0x33f166;state[_0x202b16(0x123)]=_0x450500,document[_0x202b16(0xc6)](_0x202b16(0xc8))[_0x202b16(0x112)][_0x202b16(0x104)](_0x202b16(0xe7)),document[_0x202b16(0xc6)](_0x202b16(0x13e))[_0x202b16(0x112)][_0x202b16(0x104)]('hidden'),document[_0x202b16(0xc6)]('draw-state-result')[_0x202b16(0x112)][_0x202b16(0xb6)](_0x202b16(0xe7));const _0x4bccd6=_0x48bb80?_0x202b16(0xd9):_0x202b16(0xdb);document[_0x202b16(0xf7)](_0x202b16(0x12d))[_0x202b16(0x128)]=_0x4bccd6,document[_0x202b16(0xc6)]('prize-result-name')[_0x202b16(0x128)]=_0x450500;const _0x1296f2=document[_0x202b16(0xc6)](_0x202b16(0x135)),_0xd0ed78=document[_0x202b16(0xc6)]('text-claim-time'),_0x370eba=document[_0x202b16(0xc6)](_0x202b16(0x10c));if(_0x8caede){_0x1296f2[_0x202b16(0x112)][_0x202b16(0x104)]('hidden'),_0xd0ed78[_0x202b16(0x112)][_0x202b16(0xb6)]('hidden');const _0x32ef5e=_0x8caede[_0x202b16(0xc2)]?_0x8caede[_0x202b16(0xc2)]():new Date(_0x8caede);_0x370eba[_0x202b16(0x128)]=_0x32ef5e[_0x202b16(0xfa)](_0x202b16(0x124));}else _0x1296f2[_0x202b16(0x112)]['remove']('hidden'),_0x1296f2[_0x202b16(0xed)]=![],_0xd0ed78[_0x202b16(0x112)][_0x202b16(0x104)](_0x202b16(0xe7));!_0x48bb80&&confetti({'particleCount':0x96,'spread':0x46,'origin':{'y':0.6}});}async function submitForm(_0x49a623){const _0x3fdf61=_0x33f166;_0x49a623[_0x3fdf61(0xe0)]();if(!state[_0x3fdf61(0xee)])return;const _0x87813e=document['getElementById'](_0x3fdf61(0x121)),_0x2642fa=document[_0x3fdf61(0xc6)](_0x3fdf61(0xbd)),_0x59c78c=document[_0x3fdf61(0xc6)](_0x3fdf61(0xf5));_0x87813e[_0x3fdf61(0xed)]=!![],_0x2642fa['innerText']='กำลังตรวจสอบ...',_0x59c78c[_0x3fdf61(0x112)]['remove'](_0x3fdf61(0xe7));try{const _0x2a1267=getDeviceId(),_0x26f1c1=state[_0x3fdf61(0xf8)][_0x3fdf61(0x107)](/-/g,''),_0xc98312=await sha256(_0x26f1c1);state[_0x3fdf61(0xeb)]=_0xc98312;const _0x577222=getLocalRegistration();if(_0x577222&&_0x577222!==_0xc98312){document[_0x3fdf61(0xc6)](_0x3fdf61(0x13f))[_0x3fdf61(0x128)]=_0x3fdf61(0xbf),document['getElementById'](_0x3fdf61(0x126))[_0x3fdf61(0x112)]['add'](_0x3fdf61(0xe7)),document['getElementById'](_0x3fdf61(0x12b))[_0x3fdf61(0x112)][_0x3fdf61(0xb6)](_0x3fdf61(0xe7));return;}const _0x1fabba=query(collection(db,finalCollectionPath),where(_0x3fdf61(0xbe),'==',_0xc98312)),_0x113a7a=await getDocs(_0x1fabba);if(!_0x113a7a[_0x3fdf61(0xec)]){const _0x10aa24=_0x113a7a['docs'][0x0],_0x263d6f=_0x10aa24[_0x3fdf61(0xe2)]();if(_0x263d6f['deviceId']&&_0x263d6f[_0x3fdf61(0xfd)]!==_0x2a1267){document[_0x3fdf61(0xc6)](_0x3fdf61(0x13f))[_0x3fdf61(0xb1)]=_0x3fdf61(0x125),document[_0x3fdf61(0xc6)](_0x3fdf61(0x126))[_0x3fdf61(0x112)][_0x3fdf61(0x104)](_0x3fdf61(0xe7)),document[_0x3fdf61(0xc6)](_0x3fdf61(0x12b))[_0x3fdf61(0x112)][_0x3fdf61(0xb6)](_0x3fdf61(0xe7));return;}state['currentDocId']=_0x10aa24['id'];let _0x3478f7='-';if(_0x263d6f[_0x3fdf61(0xcc)]){const _0x32900b=_0x263d6f[_0x3fdf61(0xcc)][_0x3fdf61(0xc2)]?_0x263d6f['CheckIN'][_0x3fdf61(0xc2)]():new Date(_0x263d6f['CheckIN']);_0x3478f7=_0x32900b[_0x3fdf61(0xfa)](_0x3fdf61(0x124));}let _0x280c48='';const _0x1ec562=new Date();_0x280c48=_0x1ec562['toLocaleString'](_0x3fdf61(0x124));const _0x5a4bfa={};let _0x447bd2=![];!_0x263d6f['deviceId']&&(_0x5a4bfa[_0x3fdf61(0xfd)]=_0x2a1267,_0x447bd2=!![]);if(!_0x263d6f[_0x3fdf61(0xb9)])_0x5a4bfa[_0x3fdf61(0xb9)]=serverTimestamp(),_0x263d6f[_0x3fdf61(0xcc)]?_0x5a4bfa[_0x3fdf61(0x12e)]=_0x3fdf61(0xd6):_0x5a4bfa['status']=_0x3fdf61(0xb5),_0x447bd2=!![];else{const _0x90bff5=_0x263d6f['CheckOUT'][_0x3fdf61(0xc2)]?_0x263d6f['CheckOUT']['toDate']():new Date(_0x263d6f[_0x3fdf61(0xb9)]);_0x280c48=_0x90bff5[_0x3fdf61(0xfa)](_0x3fdf61(0x124));}_0x447bd2&&await updateDoc(doc(db,finalCollectionPath,_0x10aa24['id']),_0x5a4bfa),setLocalRegistration(_0xc98312),document['getElementById'](_0x3fdf61(0xc7))[_0x3fdf61(0x128)]=_0x3478f7,document[_0x3fdf61(0xc6)]('success-checkout-time')[_0x3fdf61(0x128)]=_0x280c48,document[_0x3fdf61(0xc6)](_0x3fdf61(0x126))[_0x3fdf61(0x112)][_0x3fdf61(0x104)](_0x3fdf61(0xe7)),document[_0x3fdf61(0xc6)](_0x3fdf61(0xff))[_0x3fdf61(0x112)][_0x3fdf61(0xb6)]('hidden'),_0x263d6f[_0x3fdf61(0x10f)]?(state['currentReward']=_0x263d6f[_0x3fdf61(0x10f)],updateSuccessScreen(_0x263d6f['reward'],_0x263d6f[_0x3fdf61(0xd4)])):(state[_0x3fdf61(0x123)]=null,document[_0x3fdf61(0xc6)](_0x3fdf61(0xce))[_0x3fdf61(0x112)]['remove'](_0x3fdf61(0xe7)),document['getElementById'](_0x3fdf61(0x13d))[_0x3fdf61(0x112)][_0x3fdf61(0x104)]('hidden'),document[_0x3fdf61(0xc6)](_0x3fdf61(0xfb))[_0x3fdf61(0x112)][_0x3fdf61(0x104)](_0x3fdf61(0xe7)));}else{const _0x31ec08=query(collection(db,finalCollectionPath),where(_0x3fdf61(0xfd),'==',_0x2a1267)),_0x366a02=await getDocs(_0x31ec08);if(!_0x366a02[_0x3fdf61(0xec)])document['getElementById'](_0x3fdf61(0x13f))[_0x3fdf61(0x128)]='เครื่องนี้ถูกผูกบัญชีอื่นแล้ว\x20(ไม่สามารถลงทะเบียนใหม่ได้)',document[_0x3fdf61(0xc6)](_0x3fdf61(0x126))[_0x3fdf61(0x112)][_0x3fdf61(0x104)](_0x3fdf61(0xe7)),document['getElementById']('screen-error-device')['classList'][_0x3fdf61(0xb6)](_0x3fdf61(0xe7));else{const _0x4b7e7c=await addDoc(collection(db,finalCollectionPath),{'citizenId':_0xc98312,'deviceId':_0x2a1267,'CheckIN':serverTimestamp(),'CheckOUT':serverTimestamp(),'status':'ลงทะเบียนสำเร็จ'});state['currentDocId']=_0x4b7e7c['id'],setLocalRegistration(_0xc98312);const _0x4be08d=new Date(),_0x182cb3=_0x4be08d['toLocaleString'](_0x3fdf61(0x124));updateSuccessUI(_0x182cb3,_0x182cb3,null,null,!![]);}}}catch(_0x52da07){console['error'](_0x52da07),alert(_0x3fdf61(0x13a)+_0x52da07[_0x3fdf61(0xbb)]);}finally{_0x87813e['disabled']=![],_0x2642fa['innerText']=_0x3fdf61(0x127),_0x59c78c['classList'][_0x3fdf61(0x104)]('hidden'),validateForm();}}function handleIdInput(_0x1cfe50){const _0xba28ca=_0x33f166;let _0x3feeeb=_0x1cfe50[_0xba28ca(0x114)][_0xba28ca(0xad)][_0xba28ca(0x107)](/[^0-9]/g,'');if(_0x3feeeb[_0xba28ca(0xd3)]>0xd)_0x3feeeb=_0x3feeeb[_0xba28ca(0xc5)](0x0,0xd);let _0x2cab25=_0x3feeeb;if(_0x3feeeb[_0xba28ca(0xd3)]>0x1)_0x2cab25=_0x3feeeb[_0xba28ca(0xc5)](0x0,0x1)+'-'+_0x3feeeb['slice'](0x1);if(_0x3feeeb[_0xba28ca(0xd3)]>0x5)_0x2cab25=_0x2cab25[_0xba28ca(0xc5)](0x0,0x6)+'-'+_0x2cab25['slice'](0x6);if(_0x3feeeb[_0xba28ca(0xd3)]>0xa)_0x2cab25=_0x2cab25[_0xba28ca(0xc5)](0x0,0xc)+'-'+_0x2cab25[_0xba28ca(0xc5)](0xc);if(_0x3feeeb[_0xba28ca(0xd3)]>0xc)_0x2cab25=_0x2cab25[_0xba28ca(0xc5)](0x0,0xf)+'-'+_0x2cab25[_0xba28ca(0xc5)](0xf);document[_0xba28ca(0xc6)](_0xba28ca(0xf8))[_0xba28ca(0xad)]=_0x2cab25,state[_0xba28ca(0xf8)]=_0x2cab25;const _0x45f33f=document[_0xba28ca(0xc6)]('icon-check-valid'),_0x54e51e=document[_0xba28ca(0xc6)](_0xba28ca(0xf8));_0x3feeeb[_0xba28ca(0xd3)]===0xd?(_0x54e51e[_0xba28ca(0x112)]['add'](_0xba28ca(0x130),_0xba28ca(0x11f)),_0x54e51e[_0xba28ca(0x112)][_0xba28ca(0xb6)]('border-gray-200'),_0x45f33f[_0xba28ca(0x112)][_0xba28ca(0xb6)](_0xba28ca(0xe7))):(_0x54e51e[_0xba28ca(0x112)][_0xba28ca(0xb6)]('border-purple-500','bg-purple-50/30'),_0x54e51e[_0xba28ca(0x112)][_0xba28ca(0x104)](_0xba28ca(0xb4)),_0x45f33f[_0xba28ca(0x112)][_0xba28ca(0x104)]('hidden')),validateForm();}function validateForm(){const _0x534455=_0x33f166,_0x30283a=state[_0x534455(0xf8)][_0x534455(0x107)](/[^0-9]/g,'')['length']===0xd,_0x4a4327=document[_0x534455(0xc6)](_0x534455(0x121));_0x30283a?(_0x4a4327[_0x534455(0xed)]=![],_0x4a4327[_0x534455(0x112)][_0x534455(0x104)](_0x534455(0x139),_0x534455(0xe5),'hover:bg-purple-700',_0x534455(0x100)),_0x4a4327[_0x534455(0x112)][_0x534455(0xb6)]('bg-gray-200','text-gray-400',_0x534455(0xd1),_0x534455(0xba))):(_0x4a4327[_0x534455(0xed)]=!![],_0x4a4327[_0x534455(0x112)][_0x534455(0xb6)](_0x534455(0x139),'text-white',_0x534455(0x137),'shadow-purple-200'),_0x4a4327[_0x534455(0x112)][_0x534455(0x104)](_0x534455(0x11d),_0x534455(0xf2),_0x534455(0xd1),'shadow-none'));}document[_0x33f166(0xc6)](_0x33f166(0x12a))[_0x33f166(0x102)](_0x33f166(0x103),submitForm),document[_0x33f166(0xc6)](_0x33f166(0xf8))['addEventListener'](_0x33f166(0xc4),handleIdInput),window[_0x33f166(0x102)]('load',()=>document[_0x33f166(0xc6)]('idCard')[_0x33f166(0xf3)]());async function initAuth(){const _0x5a25d6=_0x33f166;typeof __initial_auth_token!==_0x5a25d6(0xb0)&&__initial_auth_token?await signInWithCustomToken(auth,__initial_auth_token):await signInAnonymously(auth),fetchPrizes();}onAuthStateChanged(auth,_0xa1bf5c=>state[_0x33f166(0xee)]=_0xa1bf5c),initAuth();function _0x36bc(_0x3d1ed9,_0xdf5f64){_0x3d1ed9=_0x3d1ed9-0xad;const _0x3f530f=_0x3f53();let _0x36bc66=_0x3f530f[_0x3d1ed9];return _0x36bc66;}function _0x3f53(){const _0x13c12a=['artifacts/','length','rewardClaimTime','style','ลงทะเบียนสำเร็จ','then','encode','ท่านเคยได้รับรางวัลแล้ว','default-app-id','ยินดีด้วย!\x20ท่านได้รับ','coop_device_identifier','subtle','draw-state-result','parse','preventDefault','G-9DJLWJ5LQ1','data','btn-claim-reward-summary','floor','text-white','lucide','hidden','รางวัลพิเศษ','from','currentDocId','userHash','empty','disabled','user','prize-ticker','name','msg-box-recorded','text-gray-400','focus','push','btn-loader','getItem','querySelector','idCard','เกิดข้อผิดพลาดในการตรวจสอบข้อมูล','toLocaleString','claim-section-summary','ttb-register.firebaseapp.com','deviceId','cookie','screen-success','shadow-purple-200','343260tYDMgO','addEventListener','submit','add','createIcons','resetForm','replace','เครื่องใช้ไฟฟ้า','4348040MTgEwp','808346KtoWRJ','/public/data/coop_registrations','claim-time-val','4635333vrkGAW','ttb-register','reward','join','1:1070273157855:web:5c8120e1df27e233d8676a','classList','app','target','(^|\x20)','629844iVUIEU','=([^;]+)','50%','digest','ไม่สามารถบันทึกของรางวัลได้','toString','coop_registered_citizen_id','bg-gray-200','substr','bg-purple-50/30','setItem','btn-submit','validate-progress','currentReward','th-TH','รหัสบัตรประชาชนนี้\x20ผูกกับโทรศัพท์เครื่องอื่นแล้ว<br>(ไม่สามารถเปลี่ยนเครื่องได้)','screen-form','ลงทะเบียนออก','innerText','claim-time-val-summary','registration-form','screen-error-device','match','#draw-state-result\x20h2','status','text-claim-time-summary','border-purple-500','padStart','reward-name-text','width','map','btn-claim-reward','2643529duihdg','hover:bg-purple-700','24eUqicS','bg-purple-600','เกิดข้อผิดพลาด:\x20','39sZXqnP','forEach','reward-display-badge','draw-state-validating','error-msg-text','value','1070273157855','100%','undefined','innerHTML','DEV-','ทองคำ','border-gray-200','checked-out','remove',';\x20path=/;\x20max-age=31536000','SHA-256','CheckOUT','shadow-none','message','exists','btn-text','citizenId','อุปกรณ์นี้ได้ทำการลงทะเบียนให้กับหมายเลขบัตรประชาชนอื่นไปแล้ว\x20ไม่สามารถลงทะเบียนซ้ำได้\x20(Local\x20Lock)','icon-check-valid','กำลังบันทึก...','toDate','error','input','slice','getElementById','success-checkin-time','draw-state-spinning','random','prizesList','now','CheckIN','2107284RXwFYx','btn-start-draw','ไม่พบข้อมูลผู้ใช้\x20กรุณาลงทะเบียนใหม่','screen-luckydraw','cursor-not-allowed'];_0x3f53=function(){return _0x13c12a;};return _0x3f53();}if(window[_0x33f166(0xe6)])lucide[_0x33f166(0x105)]();

    </script>
</body>
</html>