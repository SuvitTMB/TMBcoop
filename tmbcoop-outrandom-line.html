<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ลงทะเบียนออกและลุ้นรางวัล - สหกรณ์ออมทรัพย์ฯ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Font (Sarabun) -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Confetti for Lucky Draw -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .hidden { display: none !important; }
        /* Custom Animations */
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes bounce-slow {
            0%, 100% { transform: translateY(-5%); }
            50% { transform: translateY(5%); }
        }
        .animate-bounce-slow { animation: bounce-slow 2s infinite; }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-10">

    <!-- Header Section -->
    <div class="bg-gradient-to-r from-purple-600 to-indigo-700 text-white p-6 rounded-b-[2.5rem] shadow-lg mb-8 relative overflow-hidden">
        <div class="absolute top-0 right-0 opacity-10 transform translate-x-10 -translate-y-10">
            <i data-lucide="gift" width="150" height="150"></i>
        </div>
        
        <div class="relative z-10 flex flex-col items-center">
            <div class="bg-white/20 p-3 rounded-full mb-3 backdrop-blur-sm">
                <i data-lucide="party-popper" width="32" height="32" class="text-white"></i>
            </div>
            <h1 class="text-xl font-bold text-center">กิจกรรมลุ้นรางวัล</h1>
            <p class="text-purple-100 text-sm mt-1">สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด</p>
        </div>
    </div>

    <!-- Main Content Container -->
    <main class="px-2 sm:px-4 max-w-lg mx-auto -mt-10">
        
        <!-- Form Screen (Check-out first) -->
        <div id="screen-form" class="bg-white rounded-2xl shadow-xl p-6 border border-slate-100 relative z-20">
            <form id="registration-form" class="space-y-6 pt-2">
                <center>
                    <h2 class="text-lg font-bold text-gray-700 mb-4">ลงทะเบียนออกเพื่อลุ้นรางวัล</h2>
                    <div>
                        <label for="idCard" class="block text-sm font-semibold text-gray-700 mb-2">
                            เลขบัตรประจำตัวประชาชน
                        </label>
                        <div class="relative">
                            <input
                                type="text"
                                id="idCard"
                                placeholder="x-xxxx-xxxxx-xx-x"
                                class="w-full text-xl font-mono tracking-wide p-4 rounded-xl border-2 border-gray-200 bg-white focus:border-purple-400 focus:ring-4 focus:ring-purple-100 outline-none transition-all text-center"
                                inputmode="numeric"
                                maxlength="17"
                            />
                            <i id="icon-check-valid" data-lucide="check-circle" class="hidden absolute right-4 top-1/2 transform -translate-y-1/2 text-green-500 w-6 h-6 animate-fade-in"></i>
                        </div>
                        <p class="text-xs text-gray-400 mt-2 ml-1">กรุณากรอกตัวเลข 13 หลักให้ครบถ้วน</p>
                    </div>

                    <div class="p-3 bg-purple-50 text-purple-800 rounded-lg text-xs flex gap-2 items-start" style="margin-top:25px;">
                        <i data-lucide="info" class="w-4 h-4 shrink-0 mt-0.5"></i>
                        <span>เงื่อนไข: ต้องทำการลงทะเบียนเข้าประชุมแล้วเท่านั้น จึงจะมีสิทธิ์ลุ้นรับรางวัล</span>
                    </div>
                </center>

                <button
                    type="submit"
                    id="btn-submit"
                    disabled
                    class="w-full py-3 rounded-lg font-semibold text-base shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2 bg-gray-200 text-gray-400 cursor-not-allowed shadow-none"
                >
                    <span id="btn-text">ลงทะเบียนออก</span>
                    <i id="btn-loader" data-lucide="loader-2" class="hidden animate-spin"></i>
                </button>
            </form>
        </div>

        <!-- Success Screen (Check-out Done & Reward Summary) -->
        <div id="screen-success" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i data-lucide="check-circle" class="text-green-600 w-10 h-10"></i>
            </div>
            
            <h2 id="success-title" class="text-xl font-bold text-gray-800 mb-4">ลงทะเบียนออกสำเร็จ</h2>
            
            <!-- Time Grid -->
            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="bg-blue-50 p-3 rounded-xl border border-blue-100 flex flex-col items-center justify-center">
                    <p class="text-xs font-bold text-blue-800 uppercase mb-1">ลงทะเบียนเข้า</p>
                    <p id="success-checkin-time" class="text-blue-600 font-mono text-sm font-semibold">--:--</p>
                </div>
                <div class="bg-orange-50 p-3 rounded-xl border border-orange-100 flex flex-col items-center justify-center">
                    <p class="text-xs font-bold text-orange-800 uppercase mb-1">ลงทะเบียนออก</p>
                    <p id="success-checkout-time" class="text-orange-600 font-mono text-sm font-semibold">--:--</p>
                </div>
            </div>
            
            <!-- Message Box (Will be hidden when reward exists) -->
            <div id="msg-box-recorded" class="bg-green-50 border border-green-100 rounded-xl p-5 mb-6 text-left shadow-sm">
                <h3 id="success-msg-header" class="font-bold text-green-900 mb-2 text-lg flex items-center gap-2">
                    <i data-lucide="calendar-check" width="20"></i> บันทึกเวลาเรียบร้อย
                </h3>
                <p id="success-msg-body" class="text-sm text-gray-700">
                    ท่านได้ลงทะเบียนออกและมีสิทธิ์ลุ้นรับรางวัลพิเศษจำนวน 50 รางวัล และขอให้ท่านเดินทางกลับโดยสวัสดิภาพ
                </p>
            </div>
            
            <!-- Lucky Draw Action Area -->
            <div id="lucky-draw-action-container">
                <!-- Case 1: Button for new draw -->
                <button id="btn-start-draw" onclick="window.app.goToLuckyDraw()" class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-white py-4 rounded-xl font-bold shadow-lg shadow-orange-200 hover:shadow-orange-300 transform hover:-translate-y-1 transition-all flex items-center justify-center gap-2 text-lg animate-bounce-slow">
                    <i data-lucide="gift" width="24"></i> กดเพื่อสุ่มของรางวัล
                </button>

                <!-- Case 2: Display Reward (Already drawn) -->
                <div id="reward-display-badge" class="hidden w-full bg-gradient-to-r from-purple-100 to-pink-100 border-2 border-purple-300 rounded-xl p-4 text-center shadow-inner mb-4">
                    <p class="text-sm text-purple-600 font-semibold mb-1">ของรางวัลของคุณคือ</p>
                    <p id="reward-name-text" class="text-xl font-bold text-purple-800">...</p>
                </div>

                <!-- Case 3: Claim Button (Added for Summary Page) -->
                <div id="claim-section-summary" class="hidden">
                    <button id="btn-claim-reward-summary" onclick="window.app.claimReward('summary')" class="w-full bg-green-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:bg-green-700 transition transform hover:scale-105 mb-2">
                        <i data-lucide="check-square" class="inline-block w-5 h-5 mr-1 mb-1"></i> ยืนยันการรับรางวัลแล้ว
                    </button>
                    <p id="text-claim-time-summary" class="text-xs text-gray-600 font-sm bg-green-50 p-3 rounded-lg border border-green-200 hidden">
                        <i data-lucide="clock" class="inline-block w-4 h-4 mr-1"></i> รับรางวัลเมื่อ: <span id="claim-time-val-summary"></span>
                    </p>
                </div>
            </div>

            <!-- Back to Registration Button -->
            <button onclick="window.app.resetForm()" class="mt-6 w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition flex items-center justify-center gap-2">
                <i data-lucide="log-out" width="18"></i> กลับสู่หน้าลงทะเบียน
            </button>
        </div>

        <!-- Lucky Draw Screen (Spinning & Result) -->
        <div id="screen-luckydraw" class="hidden bg-white rounded-2xl shadow-xl p-6 w-full text-center animate-fade-in relative z-20 min-h-[400px] flex flex-col items-center justify-center">
            
            <!-- State 1: Validating -->
            <div id="draw-state-validating" class="w-full">
                <div class="w-24 h-24 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse">
                    <i data-lucide="scan-face" class="text-blue-500 w-12 h-12"></i>
                </div>
                <h2 class="text-xl font-bold text-gray-800 mb-2">กำลังตรวจสอบข้อมูลพนักงาน...</h2>
                <p class="text-gray-500 text-sm">กรุณารอสักครู่ ระบบกำลังยืนยันสิทธิ์ของท่าน</p>
                <div class="mt-6 w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-200 overflow-hidden">
                    <div class="bg-blue-600 h-2.5 rounded-full" style="width: 0%; transition: width 2s ease-in-out;" id="validate-progress"></div>
                </div>
            </div>

            <!-- State 2: Spinning -->
            <div id="draw-state-spinning" class="hidden w-full">
                <div class="relative w-32 h-32 mx-auto mb-6">
                    <div class="absolute inset-0 border-4 border-t-purple-500 border-gray-200 rounded-full animate-spin"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i data-lucide="gift" class="text-purple-500 w-12 h-12"></i>
                    </div>
                </div>
                <h2 class="text-2xl font-bold text-purple-700 mb-2" id="spin-text">กำลังสุ่มรางวัล...</h2>
                <div class="h-8 overflow-hidden relative mt-2">
                    <div id="prize-ticker" class="text-gray-400 text-lg transition-all duration-100">...</div>
                </div>
            </div>

            <!-- State 3: Result -->
            <div id="draw-state-result" class="hidden w-full">
                <div class="mb-2 text-yellow-500">
                    <i data-lucide="crown" width="60" height="60" class="mx-auto"></i>
                </div>
                <h2 class="text-lg font-bold text-gray-500 mb-1">ยินดีด้วย! ท่านได้รับ</h2>
                <div class="bg-gradient-to-r from-yellow-100 to-orange-100 border-2 border-yellow-300 p-6 rounded-2xl mb-6 shadow-inner relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-2 opacity-20"><i data-lucide="sparkles" width="40"></i></div>
                    <h1 id="prize-result-name" class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-600 to-red-600 drop-shadow-sm mb-4">
                        รอสักครู่...
                    </h1>
                </div>
                
                <!-- Claim Reward Section -->
                <div id="claim-section" class="mb-6">
                    <button id="btn-claim-reward" onclick="window.app.claimReward('result')" class="bg-green-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:bg-green-700 transition transform hover:scale-105 hidden">
                        <i data-lucide="check-square" class="inline-block w-5 h-5 mr-1 mb-1"></i> ยืนยันการรับรางวัลแล้ว
                    </button>
                    <p id="text-claim-time" class="text-green-700 font-medium bg-green-50 p-3 rounded-lg border border-green-200 hidden">
                        <i data-lucide="clock" class="inline-block w-4 h-4 mr-1"></i> รับรางวัลเมื่อ: <span id="claim-time-val" class="font-bold"></span>
                    </p>
                </div>

                <p class="text-xs text-gray-400 mb-6">กรุณาให้เจ้าน้าที่ทำการกดปุ่มยืนยันการรับรางวัล</p>

                <button onclick="window.app.backToSummary()" class="w-full bg-gray-800 text-white py-3 rounded-xl font-semibold hover:bg-gray-900 transition">
                    กลับสู่หน้าหลัก (Check-out)
                </button>
            </div>

        </div>

        <!-- Error Screen -->
        <div id="screen-error-device" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="alert-triangle" class="text-red-600 w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold text-red-700 mb-2">เกิดข้อผิดพลาด</h2>
            <p id="error-msg-text" class="text-gray-600 mb-6 text-sm">ไม่สามารถดำเนินการได้</p>
            <button onclick="window.location.reload()" class="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition">ปิด</button>
        </div>

        <!-- Not Found Screen -->
        <div id="screen-not-found" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="user-x" class="text-amber-600 w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold text-amber-700 mb-2">ไม่พบข้อมูล</h2>
            <p class="text-gray-600 mb-6 text-sm">กรุณาลงทะเบียนเข้าก่อนทำการลงทะเบียนออก</p>
            <button onclick="window.app.resetForm()" class="w-full bg-amber-500 text-white py-3 rounded-xl font-semibold hover:bg-amber-600 transition">ปิด</button>
        </div>

        <p class="text-center text-gray-400 text-xs mt-8">
            ระบบสุ่มรางวัลสมาชิกสหกรณ์ <br/>
            © 2024 สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด
        </p>
    </main>

    <script type="module">
const _0x5277db=_0x4081;(function(_0x336568,_0x12e49a){const _0x6e0475=_0x4081,_0x24114f=_0x336568();while(!![]){try{const _0x330a41=parseInt(_0x6e0475(0xf9))/0x1*(parseInt(_0x6e0475(0x130))/0x2)+-parseInt(_0x6e0475(0x153))/0x3*(parseInt(_0x6e0475(0x11a))/0x4)+parseInt(_0x6e0475(0xd8))/0x5+parseInt(_0x6e0475(0xd9))/0x6+-parseInt(_0x6e0475(0xdb))/0x7*(-parseInt(_0x6e0475(0x13d))/0x8)+-parseInt(_0x6e0475(0x100))/0x9*(parseInt(_0x6e0475(0xf6))/0xa)+-parseInt(_0x6e0475(0x11d))/0xb;if(_0x330a41===_0x12e49a)break;else _0x24114f['push'](_0x24114f['shift']());}catch(_0x4e914a){_0x24114f['push'](_0x24114f['shift']());}}}(_0x5bcf,0xd9ce5));import{initializeApp}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js';import{getAuth,signInAnonymously,onAuthStateChanged,signInWithCustomToken}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js';import{getFirestore,collection,updateDoc,doc,serverTimestamp,query,where,getDocs,getDoc,addDoc}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js';const TARGET_COLLECTION_NAME=_0x5277db(0x121),PRIZES_COLLECTION_NAME='coop_gift',isSandboxEnv=typeof __firebase_config!==_0x5277db(0x143);let firebaseConfig,finalCollectionPath,prizesCollectionPath;if(isSandboxEnv){firebaseConfig=JSON['parse'](__firebase_config);const appId=typeof __app_id!==_0x5277db(0x143)?__app_id:_0x5277db(0x12a);finalCollectionPath=_0x5277db(0xd2)+appId+_0x5277db(0x10e),prizesCollectionPath=_0x5277db(0xd2)+appId+'/public/data/'+PRIZES_COLLECTION_NAME;}else firebaseConfig={'apiKey':'AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','authDomain':_0x5277db(0xec),'databaseURL':_0x5277db(0x156),'projectId':_0x5277db(0x11c),'storageBucket':_0x5277db(0x142),'messagingSenderId':_0x5277db(0x120),'appId':'1:1070273157855:web:5c8120e1df27e233d8676a','measurementId':_0x5277db(0x147)},finalCollectionPath=TARGET_COLLECTION_NAME,prizesCollectionPath=PRIZES_COLLECTION_NAME;const state={'user':null,'idCard':'','currentDocId':null,'userHash':null,'currentReward':null,'prizesList':[]},app=initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app);async function sha256(_0x5db8eb){const _0x249ef6=_0x5277db,_0x425a6d=new TextEncoder()[_0x249ef6(0x127)](_0x5db8eb),_0x4c8aab=await crypto[_0x249ef6(0xf5)][_0x249ef6(0xd4)]('SHA-256',_0x425a6d),_0x153d8a=Array[_0x249ef6(0xe3)](new Uint8Array(_0x4c8aab));return _0x153d8a[_0x249ef6(0xe0)](_0x2720a6=>_0x2720a6[_0x249ef6(0x13c)](0x10)[_0x249ef6(0x145)](0x2,'0'))[_0x249ef6(0x14c)]('');}function getDeviceId(){const _0x2b85dc=_0x5277db,_0x267d12=_0x2b85dc(0xe1);let _0x4987b1=localStorage[_0x2b85dc(0xda)](_0x267d12);return!_0x4987b1&&(_0x4987b1=_0x2b85dc(0xf8)+Date[_0x2b85dc(0xf0)]()[_0x2b85dc(0x13c)](0x24)+Math[_0x2b85dc(0x137)]()['toString'](0x24)[_0x2b85dc(0x124)](0x2,0x9),localStorage[_0x2b85dc(0x123)](_0x267d12,_0x4987b1)),_0x4987b1;}window[_0x5277db(0x13e)]={'resetForm':()=>{const _0x32a99b=_0x5277db;[_0x32a99b(0x105),'screen-error-device',_0x32a99b(0xdc),_0x32a99b(0xd3)][_0x32a99b(0x12b)](_0xd8b22f=>document['getElementById'](_0xd8b22f)[_0x32a99b(0xef)][_0x32a99b(0xff)](_0x32a99b(0x12f))),document[_0x32a99b(0xcd)](_0x32a99b(0x112))[_0x32a99b(0xef)][_0x32a99b(0x14a)](_0x32a99b(0x12f)),document[_0x32a99b(0xcd)]('idCard')[_0x32a99b(0x103)]='',document[_0x32a99b(0xcd)](_0x32a99b(0xd6))[_0x32a99b(0xef)][_0x32a99b(0xff)](_0x32a99b(0x12f)),document[_0x32a99b(0xcd)](_0x32a99b(0xd5))[_0x32a99b(0xef)][_0x32a99b(0xff)]('hidden'),document[_0x32a99b(0xcd)](_0x32a99b(0x118))[_0x32a99b(0xef)][_0x32a99b(0x14a)](_0x32a99b(0x12f));const _0x2d9f80=document['getElementById'](_0x32a99b(0xde));_0x2d9f80[_0x32a99b(0xe8)]=!![],_0x2d9f80[_0x32a99b(0xef)][_0x32a99b(0xff)](_0x32a99b(0xf1),_0x32a99b(0xe4)),_0x2d9f80[_0x32a99b(0xef)][_0x32a99b(0x14a)](_0x32a99b(0x106),_0x32a99b(0xdf)),document[_0x32a99b(0xcd)](_0x32a99b(0x107))[_0x32a99b(0x101)]=_0x32a99b(0x138),document[_0x32a99b(0xcd)]('btn-loader')[_0x32a99b(0xef)][_0x32a99b(0xff)](_0x32a99b(0x12f)),state[_0x32a99b(0x13b)]='',state[_0x32a99b(0x132)]=null,state[_0x32a99b(0x104)]=null,document[_0x32a99b(0xcd)](_0x32a99b(0x13b))['focus']();},'goToLuckyDraw':async()=>{const _0x21c008=_0x5277db;document[_0x21c008(0xcd)](_0x21c008(0x105))[_0x21c008(0xef)][_0x21c008(0xff)]('hidden'),document[_0x21c008(0xcd)]('screen-luckydraw')[_0x21c008(0xef)]['remove'](_0x21c008(0x12f)),document[_0x21c008(0xcd)](_0x21c008(0x102))[_0x21c008(0xef)][_0x21c008(0x14a)](_0x21c008(0x12f)),document[_0x21c008(0xcd)](_0x21c008(0x111))[_0x21c008(0xef)][_0x21c008(0xff)](_0x21c008(0x12f)),document[_0x21c008(0xcd)](_0x21c008(0x128))[_0x21c008(0xef)]['add'](_0x21c008(0x12f)),setTimeout(()=>{const _0x38f25d=_0x21c008;document[_0x38f25d(0xcd)]('validate-progress')[_0x38f25d(0x148)][_0x38f25d(0xeb)]=_0x38f25d(0x14d);},0x64),setTimeout(()=>{const _0x4376e6=_0x21c008;document['getElementById'](_0x4376e6(0x113))['style'][_0x4376e6(0xeb)]=_0x4376e6(0x155);},0x5dc),setTimeout(async()=>{const _0x11efe3=_0x21c008;if(state[_0x11efe3(0x132)])try{const _0x331b87=doc(db,finalCollectionPath,state[_0x11efe3(0x132)]),_0x4e2457=await getDoc(_0x331b87),_0xf909b9=_0x4e2457[_0x11efe3(0x117)]();_0x4e2457['exists']()&&_0xf909b9[_0x11efe3(0xd0)]?showResult(_0xf909b9[_0x11efe3(0xd0)],!![],_0xf909b9[_0x11efe3(0xe2)]):startSpinning();}catch(_0x36d647){console[_0x11efe3(0x12e)](_0x36d647),alert('เกิดข้อผิดพลาดในการตรวจสอบข้อมูล'),window['app'][_0x11efe3(0x115)]();}else alert(_0x11efe3(0x14f)),window[_0x11efe3(0x13e)][_0x11efe3(0x115)]();},0x7d0);},'backToSummary':()=>{const _0x202059=_0x5277db;document['getElementById'](_0x202059(0xd3))[_0x202059(0xef)][_0x202059(0xff)](_0x202059(0x12f)),document[_0x202059(0xcd)](_0x202059(0x105))['classList'][_0x202059(0x14a)](_0x202059(0x12f)),state[_0x202059(0x104)]&&(state[_0x202059(0x132)]&&getDoc(doc(db,finalCollectionPath,state[_0x202059(0x132)]))[_0x202059(0x109)](_0x45baf2=>{const _0x2d7b3b=_0x202059;_0x45baf2[_0x2d7b3b(0x157)]()&&updateSuccessScreen(_0x45baf2[_0x2d7b3b(0x117)]()[_0x2d7b3b(0xd0)],_0x45baf2[_0x2d7b3b(0x117)]()[_0x2d7b3b(0xe2)]);}));},'claimReward':async _0x56ad0b=>{const _0x486e93=_0x5277db;if(!state['currentDocId'])return;const _0x101d05=_0x56ad0b==='summary',_0x673318=_0x101d05?_0x486e93(0xf2):_0x486e93(0xe6),_0x210a4e=_0x101d05?'text-claim-time-summary':_0x486e93(0x151),_0x35c2e7=_0x101d05?_0x486e93(0xd7):_0x486e93(0xcc),_0x3fdbda=document[_0x486e93(0xcd)](_0x673318),_0x3a7efd=_0x3fdbda[_0x486e93(0xf4)];_0x3fdbda[_0x486e93(0xe8)]=!![],_0x3fdbda[_0x486e93(0x101)]=_0x486e93(0x133);try{await updateDoc(doc(db,finalCollectionPath,state[_0x486e93(0x132)]),{'rewardClaimTime':serverTimestamp()});const _0x361643=new Date(),_0x5cff78=_0x361643[_0x486e93(0x158)](_0x486e93(0xfd));_0x3fdbda[_0x486e93(0xef)][_0x486e93(0xff)](_0x486e93(0x12f)),document[_0x486e93(0xcd)](_0x210a4e)[_0x486e93(0xef)]['remove']('hidden'),document[_0x486e93(0xcd)](_0x35c2e7)[_0x486e93(0x101)]=_0x5cff78,confetti({'particleCount':0x64,'spread':0x3c,'origin':{'y':0.7}});}catch(_0x5dad3a){console['error'](_0x5dad3a),alert('บันทึกการรับรางวัลไม่สำเร็จ\x20กรุณาลองใหม่'),_0x3fdbda[_0x486e93(0xe8)]=![],_0x3fdbda[_0x486e93(0xf4)]=_0x3a7efd;}}};function updateSuccessScreen(_0x528a48,_0x4bdc1d){const _0x83d99a=_0x5277db;document[_0x83d99a(0xcd)](_0x83d99a(0x12d))['classList']['add'](_0x83d99a(0x12f));const _0x4d5bd2=document[_0x83d99a(0xcd)](_0x83d99a(0xfb));_0x4d5bd2[_0x83d99a(0xef)][_0x83d99a(0x14a)]('hidden'),document['getElementById'](_0x83d99a(0x10c))[_0x83d99a(0x101)]=_0x528a48,document[_0x83d99a(0xcd)]('msg-box-recorded')['classList'][_0x83d99a(0xff)](_0x83d99a(0x12f));const _0x5c4222=document['getElementById']('claim-section-summary'),_0x2e0678=document[_0x83d99a(0xcd)](_0x83d99a(0xf2)),_0x27b399=document[_0x83d99a(0xcd)](_0x83d99a(0x134)),_0x4ad9d8=document[_0x83d99a(0xcd)](_0x83d99a(0xd7));_0x5c4222[_0x83d99a(0xef)][_0x83d99a(0x14a)](_0x83d99a(0x12f));if(_0x4bdc1d){_0x2e0678[_0x83d99a(0xef)][_0x83d99a(0xff)](_0x83d99a(0x12f)),_0x27b399[_0x83d99a(0xef)][_0x83d99a(0x14a)](_0x83d99a(0x12f));const _0x1a5f53=_0x4bdc1d[_0x83d99a(0xce)]?_0x4bdc1d[_0x83d99a(0xce)]():new Date(_0x4bdc1d);_0x4ad9d8[_0x83d99a(0x101)]=_0x1a5f53[_0x83d99a(0x158)](_0x83d99a(0xfd));}else _0x2e0678['classList']['remove'](_0x83d99a(0x12f)),_0x27b399['classList'][_0x83d99a(0xff)](_0x83d99a(0x12f));}function startSpinning(){const _0x19a26e=_0x5277db;document[_0x19a26e(0xcd)]('draw-state-validating')['classList'][_0x19a26e(0xff)](_0x19a26e(0x12f)),document[_0x19a26e(0xcd)](_0x19a26e(0x111))[_0x19a26e(0xef)][_0x19a26e(0x14a)](_0x19a26e(0x12f));const _0x3c4c91=[_0x19a26e(0xee),_0x19a26e(0x154),_0x19a26e(0x119),_0x19a26e(0x149)],_0x55cc28=state['prizesList'][_0x19a26e(0xf3)]>0x0?state['prizesList'][_0x19a26e(0xe0)](_0xcc3eb9=>_0xcc3eb9[_0x19a26e(0x131)]):_0x3c4c91,_0x3e3482=document[_0x19a26e(0xcd)](_0x19a26e(0x136));let _0x12758c=0x0;const _0x326595=setInterval(()=>{const _0x7a79da=_0x19a26e;_0x3e3482[_0x7a79da(0x101)]=_0x55cc28[Math[_0x7a79da(0x144)](Math['random']()*_0x55cc28[_0x7a79da(0xf3)])],_0x12758c++,_0x12758c>0x14&&(clearInterval(_0x326595),finalizePrize());},0x64);}async function finalizePrize(){const _0x48933d=_0x5277db,_0x3c5959=state[_0x48933d(0xe7)][_0x48933d(0xf3)]>0x0?state[_0x48933d(0xe7)][_0x48933d(0xe0)](_0x2c11d8=>_0x2c11d8[_0x48933d(0x131)]):[_0x48933d(0x135)],_0x2cafb5=_0x3c5959[Math['floor'](Math[_0x48933d(0x137)]()*_0x3c5959[_0x48933d(0xf3)])];try{state[_0x48933d(0x132)]&&(await updateDoc(doc(db,finalCollectionPath,state[_0x48933d(0x132)]),{'reward':_0x2cafb5,'rewardTime':serverTimestamp()}),showResult(_0x2cafb5,![],null));}catch(_0x94c28d){console['error']('Save\x20Prize\x20Error:',_0x94c28d),alert(_0x48933d(0x11e));}}function showResult(_0x352c97,_0x40d4c5,_0x3226b8){const _0x4d0366=_0x5277db;state[_0x4d0366(0x104)]=_0x352c97,document['getElementById'](_0x4d0366(0x111))['classList'][_0x4d0366(0xff)]('hidden'),document['getElementById']('draw-state-validating')[_0x4d0366(0xef)][_0x4d0366(0xff)](_0x4d0366(0x12f)),document[_0x4d0366(0xcd)](_0x4d0366(0x128))[_0x4d0366(0xef)][_0x4d0366(0x14a)]('hidden');const _0x1b8243=_0x40d4c5?'ท่านเคยได้รับรางวัลแล้ว':_0x4d0366(0xe5);document[_0x4d0366(0x10d)](_0x4d0366(0x140))[_0x4d0366(0x101)]=_0x1b8243,document[_0x4d0366(0xcd)](_0x4d0366(0x125))[_0x4d0366(0x101)]=_0x352c97;const _0x265a5a=document[_0x4d0366(0xcd)](_0x4d0366(0xe6)),_0x545d8e=document[_0x4d0366(0xcd)](_0x4d0366(0x151)),_0x5b9f83=document[_0x4d0366(0xcd)](_0x4d0366(0xcc));if(_0x3226b8){_0x265a5a['classList'][_0x4d0366(0xff)](_0x4d0366(0x12f)),_0x545d8e[_0x4d0366(0xef)]['remove'](_0x4d0366(0x12f));const _0x314b9f=_0x3226b8[_0x4d0366(0xce)]?_0x3226b8[_0x4d0366(0xce)]():new Date(_0x3226b8);_0x5b9f83[_0x4d0366(0x101)]=_0x314b9f['toLocaleString'](_0x4d0366(0xfd));}else _0x265a5a[_0x4d0366(0xef)][_0x4d0366(0x14a)](_0x4d0366(0x12f)),_0x265a5a[_0x4d0366(0xe8)]=![],_0x545d8e['classList'][_0x4d0366(0xff)](_0x4d0366(0x12f));!_0x40d4c5&&confetti({'particleCount':0x96,'spread':0x46,'origin':{'y':0.6}});}async function fetchPrizes(){const _0x4ef2ee=_0x5277db,_0x3b513f=query(collection(db,prizesCollectionPath)),_0x1aaa9a=await getDocs(_0x3b513f),_0x277ba8=[];_0x1aaa9a[_0x4ef2ee(0x12b)](_0x3ee9a1=>_0x277ba8[_0x4ef2ee(0x14e)](_0x3ee9a1['data']())),state[_0x4ef2ee(0xe7)]=_0x277ba8;}async function submitForm(_0xbd5fba){const _0x4aa37f=_0x5277db;_0xbd5fba['preventDefault']();if(!state[_0x4aa37f(0x110)])return;const _0xaefd85=document[_0x4aa37f(0xcd)](_0x4aa37f(0xde)),_0x4c9ce1=document[_0x4aa37f(0xcd)](_0x4aa37f(0x107)),_0x3f306d=document[_0x4aa37f(0xcd)](_0x4aa37f(0x10a));_0xaefd85[_0x4aa37f(0xe8)]=!![],_0x4c9ce1['innerText']='กำลังตรวจสอบ...',_0x3f306d[_0x4aa37f(0xef)][_0x4aa37f(0x14a)](_0x4aa37f(0x12f));try{const _0x4550c2=getDeviceId(),_0x771b9e=state[_0x4aa37f(0x13b)][_0x4aa37f(0x114)](/-/g,''),_0x338ffe=await sha256(_0x771b9e);state[_0x4aa37f(0xf7)]=_0x338ffe;const _0x1d13b2=query(collection(db,finalCollectionPath),where(_0x4aa37f(0x150),'==',_0x338ffe)),_0x19750c=await getDocs(_0x1d13b2);if(!_0x19750c[_0x4aa37f(0x10b)]){const _0x22245b=_0x19750c[_0x4aa37f(0x126)][0x0],_0x15d86b=_0x22245b[_0x4aa37f(0x117)]();if(_0x15d86b[_0x4aa37f(0xcf)]&&_0x15d86b[_0x4aa37f(0xcf)]!==_0x4550c2){document[_0x4aa37f(0xcd)](_0x4aa37f(0xfe))['innerHTML']=_0x4aa37f(0x12c),document[_0x4aa37f(0xcd)](_0x4aa37f(0x112))[_0x4aa37f(0xef)][_0x4aa37f(0xff)]('hidden'),document['getElementById'](_0x4aa37f(0x116))[_0x4aa37f(0xef)][_0x4aa37f(0x14a)](_0x4aa37f(0x12f));return;}state[_0x4aa37f(0x132)]=_0x22245b['id'];let _0x5951a3='-';if(_0x15d86b['CheckIN']){const _0x1ac568=_0x15d86b['CheckIN'][_0x4aa37f(0xce)]?_0x15d86b[_0x4aa37f(0x152)][_0x4aa37f(0xce)]():new Date(_0x15d86b[_0x4aa37f(0x152)]);_0x5951a3=_0x1ac568['toLocaleString'](_0x4aa37f(0xfd));}let _0x490565='';const _0x331865=new Date();_0x490565=_0x331865[_0x4aa37f(0x158)](_0x4aa37f(0xfd));const _0x280bf0={};let _0x377d72=![];!_0x15d86b['deviceId']&&(_0x280bf0[_0x4aa37f(0xcf)]=_0x4550c2,_0x377d72=!![]);if(!_0x15d86b[_0x4aa37f(0xea)])_0x280bf0[_0x4aa37f(0xea)]=serverTimestamp(),_0x15d86b[_0x4aa37f(0x152)]?_0x280bf0[_0x4aa37f(0x13a)]=_0x4aa37f(0x11f):_0x280bf0[_0x4aa37f(0x13a)]=_0x4aa37f(0x139),_0x377d72=!![];else{const _0x2fa17c=_0x15d86b[_0x4aa37f(0xea)][_0x4aa37f(0xce)]?_0x15d86b[_0x4aa37f(0xea)][_0x4aa37f(0xce)]():new Date(_0x15d86b[_0x4aa37f(0xea)]);_0x490565=_0x2fa17c[_0x4aa37f(0x158)](_0x4aa37f(0xfd));}_0x377d72&&await updateDoc(doc(db,finalCollectionPath,_0x22245b['id']),_0x280bf0),document[_0x4aa37f(0xcd)]('success-checkin-time')[_0x4aa37f(0x101)]=_0x5951a3,document[_0x4aa37f(0xcd)](_0x4aa37f(0x146))[_0x4aa37f(0x101)]=_0x490565,document['getElementById'](_0x4aa37f(0x112))['classList'][_0x4aa37f(0xff)](_0x4aa37f(0x12f)),document['getElementById'](_0x4aa37f(0x105))['classList'][_0x4aa37f(0x14a)]('hidden'),_0x15d86b[_0x4aa37f(0xd0)]?(state[_0x4aa37f(0x104)]=_0x15d86b[_0x4aa37f(0xd0)],updateSuccessScreen(_0x15d86b[_0x4aa37f(0xd0)],_0x15d86b[_0x4aa37f(0xe2)])):(state[_0x4aa37f(0x104)]=null,document['getElementById']('btn-start-draw')[_0x4aa37f(0xef)][_0x4aa37f(0x14a)]('hidden'),document['getElementById']('reward-display-badge')[_0x4aa37f(0xef)]['add']('hidden'),document[_0x4aa37f(0xcd)](_0x4aa37f(0xd5))['classList'][_0x4aa37f(0xff)](_0x4aa37f(0x12f)));}else{const _0x22a344=query(collection(db,finalCollectionPath),where('deviceId','==',_0x4550c2)),_0x4442c9=await getDocs(_0x22a344);if(!_0x4442c9[_0x4aa37f(0x10b)])document[_0x4aa37f(0xcd)](_0x4aa37f(0xfe))[_0x4aa37f(0x101)]='เครื่องนี้ถูกผูกบัญชีอื่นแล้ว\x20(ไม่สามารถลงทะเบียนใหม่ได้)',document[_0x4aa37f(0xcd)](_0x4aa37f(0x112))['classList'][_0x4aa37f(0xff)]('hidden'),document[_0x4aa37f(0xcd)]('screen-error-device')[_0x4aa37f(0xef)]['remove'](_0x4aa37f(0x12f));else{const _0x105f42=await addDoc(collection(db,finalCollectionPath),{'citizenId':_0x338ffe,'deviceId':_0x4550c2,'CheckIN':serverTimestamp(),'CheckOUT':serverTimestamp(),'status':_0x4aa37f(0x11f)});state[_0x4aa37f(0x132)]=_0x105f42['id'];const _0x1ae857=new Date(),_0xc345b9=_0x1ae857[_0x4aa37f(0x158)](_0x4aa37f(0xfd));updateSuccessUI(_0xc345b9,_0xc345b9,null,null,!![]);}}}catch(_0x276d21){console[_0x4aa37f(0x12e)](_0x276d21),alert(_0x4aa37f(0xe9)+_0x276d21['message']);}finally{_0xaefd85[_0x4aa37f(0xe8)]=![],_0x4c9ce1['innerText']=_0x4aa37f(0x138),_0x3f306d['classList'][_0x4aa37f(0xff)](_0x4aa37f(0x12f)),validateForm();}}function handleIdInput(_0x2b9575){const _0x25c4f8=_0x5277db;let _0x3a916d=_0x2b9575[_0x25c4f8(0xfa)]['value'][_0x25c4f8(0x114)](/[^0-9]/g,'');if(_0x3a916d[_0x25c4f8(0xf3)]>0xd)_0x3a916d=_0x3a916d[_0x25c4f8(0x13f)](0x0,0xd);let _0x5b8b16=_0x3a916d;if(_0x3a916d['length']>0x1)_0x5b8b16=_0x3a916d['slice'](0x0,0x1)+'-'+_0x3a916d[_0x25c4f8(0x13f)](0x1);if(_0x3a916d['length']>0x5)_0x5b8b16=_0x5b8b16[_0x25c4f8(0x13f)](0x0,0x6)+'-'+_0x5b8b16[_0x25c4f8(0x13f)](0x6);if(_0x3a916d[_0x25c4f8(0xf3)]>0xa)_0x5b8b16=_0x5b8b16[_0x25c4f8(0x13f)](0x0,0xc)+'-'+_0x5b8b16['slice'](0xc);if(_0x3a916d[_0x25c4f8(0xf3)]>0xc)_0x5b8b16=_0x5b8b16[_0x25c4f8(0x13f)](0x0,0xf)+'-'+_0x5b8b16[_0x25c4f8(0x13f)](0xf);document[_0x25c4f8(0xcd)]('idCard')['value']=_0x5b8b16,state[_0x25c4f8(0x13b)]=_0x5b8b16;const _0x55790e=document[_0x25c4f8(0xcd)](_0x25c4f8(0xd6)),_0x355923=document[_0x25c4f8(0xcd)](_0x25c4f8(0x13b));_0x3a916d[_0x25c4f8(0xf3)]===0xd?(_0x355923[_0x25c4f8(0xef)]['add'](_0x25c4f8(0x11b),_0x25c4f8(0x129)),_0x355923[_0x25c4f8(0xef)]['remove'](_0x25c4f8(0xdd)),_0x55790e[_0x25c4f8(0xef)][_0x25c4f8(0x14a)](_0x25c4f8(0x12f))):(_0x355923[_0x25c4f8(0xef)][_0x25c4f8(0x14a)]('border-purple-500',_0x25c4f8(0x129)),_0x355923['classList'][_0x25c4f8(0xff)](_0x25c4f8(0xdd)),_0x55790e[_0x25c4f8(0xef)][_0x25c4f8(0xff)](_0x25c4f8(0x12f))),validateForm();}function _0x4081(_0x1682d6,_0x292841){_0x1682d6=_0x1682d6-0xcc;const _0x5bcf6b=_0x5bcf();let _0x4081b9=_0x5bcf6b[_0x1682d6];return _0x4081b9;}function validateForm(){const _0x8db66e=_0x5277db,_0x2a27b0=state[_0x8db66e(0x13b)]['replace'](/[^0-9]/g,'')[_0x8db66e(0xf3)]===0xd,_0x51ad3f=document[_0x8db66e(0xcd)](_0x8db66e(0xde));_0x2a27b0?(_0x51ad3f[_0x8db66e(0xe8)]=![],_0x51ad3f[_0x8db66e(0xef)][_0x8db66e(0xff)]('bg-purple-600','text-white',_0x8db66e(0x141),_0x8db66e(0x122)),_0x51ad3f[_0x8db66e(0xef)][_0x8db66e(0x14a)](_0x8db66e(0xf1),_0x8db66e(0xe4),_0x8db66e(0xd1),_0x8db66e(0x108))):(_0x51ad3f['disabled']=!![],_0x51ad3f[_0x8db66e(0xef)][_0x8db66e(0x14a)]('bg-purple-600',_0x8db66e(0xdf),_0x8db66e(0x141),_0x8db66e(0x122)),_0x51ad3f[_0x8db66e(0xef)][_0x8db66e(0xff)](_0x8db66e(0xf1),_0x8db66e(0xe4),_0x8db66e(0xd1),_0x8db66e(0x108)));}function _0x5bcf(){const _0x13fb42=['ttb-register','28836665aMaLvG','ไม่สามารถบันทึกของรางวัลได้','ลงทะเบียนสำเร็จ','1070273157855','tmb_coop','shadow-purple-200','setItem','substr','prize-result-name','docs','encode','draw-state-result','bg-purple-50/30','default-app-id','forEach','รหัสบัตรประชาชนนี้\x20ผูกกับโทรศัพท์เครื่องอื่นแล้ว<br>(ไม่สามารถเปลี่ยนเครื่องได้)','btn-start-draw','error','hidden','1051108UAUTiC','name','currentDocId','กำลังบันทึก...','text-claim-time-summary','รางวัลพิเศษ','prize-ticker','random','ลงทะเบียนออก','checked-out','status','idCard','toString','9851024WaBUHA','app','slice','#draw-state-result\x20h2','hover:bg-purple-700','ttb-register.firebasestorage.app','undefined','floor','padStart','success-checkout-time','G-9DJLWJ5LQ1','style','เครื่องใช้ไฟฟ้า','remove','load','join','50%','push','ไม่พบข้อมูลผู้ใช้\x20กรุณาลงทะเบียนใหม่','citizenId','text-claim-time','CheckIN','2802blybkj','รางวัลพิเศษ\x202','100%','https://ttb-register-default-rtdb.asia-southeast1.firebasedate.app','exists','toLocaleString','claim-time-val','getElementById','toDate','deviceId','reward','cursor-not-allowed','artifacts/','screen-luckydraw','digest','claim-section-summary','icon-check-valid','claim-time-val-summary','7098360rkOcJA','10548402WxeUtJ','getItem','7DSaGMa','screen-not-found','border-gray-200','btn-submit','text-white','map','coop_device_identifier','rewardClaimTime','from','text-gray-400','ยินดีด้วย!\x20ท่านได้รับ','btn-claim-reward','prizesList','disabled','เกิดข้อผิดพลาด:\x20','CheckOUT','width','ttb-register.firebaseapp.com','createIcons','รางวัลพิเศษ\x201','classList','now','bg-gray-200','btn-claim-reward-summary','length','innerHTML','subtle','10944810kfeYOe','userHash','DEV-','3CxXiMH','target','reward-display-badge','addEventListener','th-TH','error-msg-text','add','9kwclrx','innerText','draw-state-validating','value','currentReward','screen-success','bg-purple-600','btn-text','shadow-none','then','btn-loader','empty','reward-name-text','querySelector','/public/data/coop_registrations','focus','user','draw-state-spinning','screen-form','validate-progress','replace','resetForm','screen-error-device','data','msg-box-recorded','ทองคำ\x201\x20สลึง','5900MyeYqj','border-purple-500'];_0x5bcf=function(){return _0x13fb42;};return _0x5bcf();}document[_0x5277db(0xcd)]('registration-form')[_0x5277db(0xfc)]('submit',submitForm),document['getElementById'](_0x5277db(0x13b))[_0x5277db(0xfc)]('input',handleIdInput),window['addEventListener'](_0x5277db(0x14b),()=>document[_0x5277db(0xcd)]('idCard')[_0x5277db(0x10f)]());async function initAuth(){const _0x4463a3=_0x5277db;typeof __initial_auth_token!==_0x4463a3(0x143)&&__initial_auth_token?await signInWithCustomToken(auth,__initial_auth_token):await signInAnonymously(auth),fetchPrizes();}onAuthStateChanged(auth,_0x308ad4=>state[_0x5277db(0x110)]=_0x308ad4),initAuth();if(window['lucide'])lucide[_0x5277db(0xed)]();

    </script>
</body>
</html>