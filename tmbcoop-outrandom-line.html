<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ลงทะเบียนออกและลุ้นรางวัล - สหกรณ์ออมทรัพย์ฯ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Font (Sarabun) -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Confetti for Lucky Draw -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .hidden { display: none !important; }
        /* Custom Animations */
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes bounce-slow {
            0%, 100% { transform: translateY(-5%); }
            50% { transform: translateY(5%); }
        }
        .animate-bounce-slow { animation: bounce-slow 2s infinite; }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-10">

    <!-- Header Section -->
    <div class="bg-gradient-to-r from-purple-600 to-indigo-700 text-white p-6 rounded-b-[2.5rem] shadow-lg mb-8 relative overflow-hidden">
        <div class="absolute top-0 right-0 opacity-10 transform translate-x-10 -translate-y-10">
            <i data-lucide="gift" width="150" height="150"></i>
        </div>
        
        <div class="relative z-10 flex flex-col items-center">
            <div class="bg-white/20 p-3 rounded-full mb-3 backdrop-blur-sm">
                <i data-lucide="party-popper" width="32" height="32" class="text-white"></i>
            </div>
            <h1 class="text-xl font-bold text-center">กิจกรรมลุ้นรางวัล</h1>
            <p class="text-purple-100 text-sm mt-1">สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด</p>
        </div>
    </div>

    <!-- Main Content Container -->
    <main class="px-2 sm:px-4 max-w-lg mx-auto -mt-10">
        
        <!-- Form Screen (Check-out first) -->
        <div id="screen-form" class="bg-white rounded-2xl shadow-xl p-6 border border-slate-100 relative z-20">
            <form id="registration-form" class="space-y-6 pt-2">
                <center>
                    <h2 class="text-lg font-bold text-gray-700 mb-4">ลงทะเบียนออกเพื่อลุ้นรางวัล</h2>
                    <div>
                        <label for="idCard" class="block text-sm font-semibold text-gray-700 mb-2">
                            เลขบัตรประจำตัวประชาชน
                        </label>
                        <div class="relative">
                            <input
                                type="text"
                                id="idCard"
                                placeholder="x-xxxx-xxxxx-xx-x"
                                class="w-full text-xl font-mono tracking-wide p-4 rounded-xl border-2 border-gray-200 bg-white focus:border-purple-400 focus:ring-4 focus:ring-purple-100 outline-none transition-all text-center"
                                inputmode="numeric"
                                maxlength="17"
                            />
                            <i id="icon-check-valid" data-lucide="check-circle" class="hidden absolute right-4 top-1/2 transform -translate-y-1/2 text-green-500 w-6 h-6 animate-fade-in"></i>
                        </div>
                        <p class="text-xs text-gray-400 mt-2 ml-1">กรุณากรอกตัวเลข 13 หลักให้ครบถ้วน</p>
                    </div>

                    <div class="p-3 bg-purple-50 text-purple-800 rounded-lg text-xs flex gap-2 items-start" style="margin-top:25px;">
                        <i data-lucide="shield-alert" class="w-4 h-4 shrink-0 mt-0.5"></i>
                        <span>ระบบจำกัดสิทธิ์ 1 เครื่อง / 1 ท่าน หากลงทะเบียนแล้วจะไม่สามารถเปลี่ยนเครื่องได้</span>
                    </div>
                </center>

                <button
                    type="submit"
                    id="btn-submit"
                    disabled
                    class="w-full py-3 rounded-lg font-semibold text-base shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2 bg-gray-200 text-gray-400 cursor-not-allowed shadow-none"
                >
                    <span id="btn-text">ลงทะเบียนออก</span>
                    <i id="btn-loader" data-lucide="loader-2" class="hidden animate-spin"></i>
                </button>
            </form>
        </div>

        <!-- Success Screen (Check-out Done & Reward Summary) -->
        <div id="screen-success" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i data-lucide="check-circle" class="text-green-600 w-10 h-10"></i>
            </div>
            
            <h2 id="success-title" class="text-xl font-bold text-gray-800 mb-4">ลงทะเบียนออกสำเร็จ</h2>
            
            <!-- Time Grid -->
            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="bg-blue-50 p-3 rounded-xl border border-blue-100 flex flex-col items-center justify-center">
                    <p class="text-xs font-bold text-blue-800 uppercase mb-1">ลงทะเบียนเข้า</p>
                    <p id="success-checkin-time" class="text-blue-600 font-mono text-sm font-semibold">--:--</p>
                </div>
                <div class="bg-orange-50 p-3 rounded-xl border border-orange-100 flex flex-col items-center justify-center">
                    <p class="text-xs font-bold text-orange-800 uppercase mb-1">ลงทะเบียนออก</p>
                    <p id="success-checkout-time" class="text-orange-600 font-mono text-sm font-semibold">--:--</p>
                </div>
            </div>
            
            <!-- Message Box (Will be hidden when reward exists) -->
            <div id="msg-box-recorded" class="bg-green-50 border border-green-100 rounded-xl p-5 mb-6 text-left shadow-sm">
                <h3 id="success-msg-header" class="font-bold text-green-900 mb-2 text-lg flex items-center gap-2">
                    <i data-lucide="calendar-check" width="20"></i> บันทึกเวลาเรียบร้อย
                </h3>
                <p id="success-msg-body" class="text-sm text-gray-700">
                    ท่านได้ลงทะเบียนออกและมีสิทธิ์ลุ้นรับรางวัลพิเศษจำนวน 50 รางวัล และขอให้ท่านเดินทางกลับโดยสวัสดิภาพ
                </p>
            </div>
            
            <!-- Lucky Draw Action Area -->
            <div id="lucky-draw-action-container">
                <!-- Case 1: Button for new draw -->
                <button id="btn-start-draw" onclick="window.app.goToLuckyDraw()" class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-white py-4 rounded-xl font-bold shadow-lg shadow-orange-200 hover:shadow-orange-300 transform hover:-translate-y-1 transition-all flex items-center justify-center gap-2 text-lg animate-bounce-slow">
                    <i data-lucide="gift" width="24"></i> กดเพื่อสุ่มของรางวัล
                </button>

                <!-- Case 2: Display Reward (Already drawn) -->
                <div id="reward-display-badge" class="hidden w-full bg-gradient-to-r from-purple-100 to-pink-100 border-2 border-purple-300 rounded-xl p-4 text-center shadow-inner mb-4">
                    <p class="text-sm text-purple-600 font-semibold mb-1">ของรางวัลของคุณคือ</p>
                    <p id="reward-name-text" class="text-xl font-bold text-purple-800">...</p>
                </div>

                <!-- Case 3: Claim Button (Added for Summary Page) -->
                <div id="claim-section-summary" class="hidden">
                    <button id="btn-claim-reward-summary" onclick="window.app.claimReward('summary')" class="w-full bg-green-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:bg-green-700 transition transform hover:scale-105 mb-2">
                        <i data-lucide="check-square" class="inline-block w-5 h-5 mr-1 mb-1"></i> ยืนยันการรับรางวัลแล้ว
                    </button>
                    <p id="text-claim-time-summary" class="text-xs text-gray-600 font-sm bg-green-50 p-3 rounded-lg border border-green-200 hidden">
                        <i data-lucide="clock" class="inline-block w-4 h-4 mr-1"></i> รับรางวัลเมื่อ: <span id="claim-time-val-summary"></span>
                    </p>
                </div>
            </div>

            <!-- Back to Registration Button -->
            <button onclick="window.app.resetForm()" class="mt-6 w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition flex items-center justify-center gap-2">
                <i data-lucide="log-out" width="18"></i> กลับสู่หน้าลงทะเบียน
            </button>
        </div>

        <!-- Lucky Draw Screen (Spinning & Result) -->
        <div id="screen-luckydraw" class="hidden bg-white rounded-2xl shadow-xl p-6 w-full text-center animate-fade-in relative z-20 min-h-[400px] flex flex-col items-center justify-center">
            
            <!-- State 1: Validating -->
            <div id="draw-state-validating" class="w-full">
                <div class="w-24 h-24 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse">
                    <i data-lucide="scan-face" class="text-blue-500 w-12 h-12"></i>
                </div>
                <h2 class="text-xl font-bold text-gray-800 mb-2">กำลังตรวจสอบข้อมูลพนักงาน...</h2>
                <p class="text-gray-500 text-sm">กรุณารอสักครู่ ระบบกำลังยืนยันสิทธิ์ของท่าน</p>
                <div class="mt-6 w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-200 overflow-hidden">
                    <div class="bg-blue-600 h-2.5 rounded-full" style="width: 0%; transition: width 2s ease-in-out;" id="validate-progress"></div>
                </div>
            </div>

            <!-- State 2: Spinning -->
            <div id="draw-state-spinning" class="hidden w-full">
                <div class="relative w-32 h-32 mx-auto mb-6">
                    <div class="absolute inset-0 border-4 border-t-purple-500 border-gray-200 rounded-full animate-spin"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i data-lucide="gift" class="text-purple-500 w-12 h-12"></i>
                    </div>
                </div>
                <h2 class="text-2xl font-bold text-purple-700 mb-2" id="spin-text">กำลังสุ่มรางวัล...</h2>
                <div class="h-8 overflow-hidden relative mt-2">
                    <div id="prize-ticker" class="text-gray-400 text-lg transition-all duration-100">...</div>
                </div>
            </div>

            <!-- State 3: Result -->
            <div id="draw-state-result" class="hidden w-full">
                <div class="mb-2" id="result-icon-container">
                    <i data-lucide="crown" width="60" height="60" class="mx-auto text-yellow-500"></i>
                </div>
                <h2 id="result-title" class="text-lg font-bold text-gray-500 mb-1">ยินดีด้วย! ท่านได้รับ</h2>
                <div id="result-card" class="bg-gradient-to-r from-yellow-100 to-orange-100 border-2 border-yellow-300 p-6 rounded-2xl mb-6 shadow-inner relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-2 opacity-20"><i data-lucide="sparkles" width="40"></i></div>
                    <h1 id="prize-result-name" class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-600 to-red-600 drop-shadow-sm mb-4">
                        รอสักครู่...
                    </h1>
                </div>
                
                <!-- Claim Reward Section -->
                <div id="claim-section" class="mb-6">
                    <button id="btn-claim-reward" onclick="window.app.claimReward('result')" class="bg-green-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:bg-green-700 transition transform hover:scale-105 hidden">
                        <i data-lucide="check-square" class="inline-block w-5 h-5 mr-1 mb-1"></i> ยืนยันการรับรางวัลแล้ว
                    </button>
                    <p id="text-claim-time" class="text-green-700 font-medium bg-green-50 p-3 rounded-lg border border-green-200 hidden">
                        <i data-lucide="clock" class="inline-block w-4 h-4 mr-1"></i> รับรางวัลเมื่อ: <span id="claim-time-val" class="font-bold"></span>
                    </p>
                </div>

                <p id="result-footer-text" class="text-xs text-gray-400 mb-6">กรุณาให้เจ้าน้าที่ทำการกดปุ่มยืนยันการรับรางวัล</p>

                <button onclick="window.app.backToSummary()" class="w-full bg-gray-800 text-white py-3 rounded-xl font-semibold hover:bg-gray-900 transition">
                    กลับสู่หน้าหลัก (Check-out)
                </button>
            </div>

        </div>

        <!-- Error Screen -->
        <div id="screen-error-device" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="alert-triangle" class="text-red-600 w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold text-red-700 mb-2">เกิดข้อผิดพลาด</h2>
            <p id="error-msg-text" class="text-gray-600 mb-6 text-sm">ไม่สามารถดำเนินการได้</p>
            <button onclick="window.location.reload()" class="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition">ปิด</button>
        </div>

        <!-- Not Found Screen -->
        <div id="screen-not-found" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="user-x" class="text-amber-600 w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold text-amber-700 mb-2">ไม่พบข้อมูล</h2>
            <p class="text-gray-600 mb-6 text-sm">กรุณาลงทะเบียนเข้าก่อนทำการลงทะเบียนออก</p>
            <button onclick="window.app.resetForm()" class="w-full bg-amber-500 text-white py-3 rounded-xl font-semibold hover:bg-amber-600 transition">ปิด</button>
        </div>

        <p class="text-center text-gray-400 text-xs mt-8">
            ระบบสุ่มรางวัลสมาชิกสหกรณ์ <br/>
            © 2024 สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด
        </p>
    </main>

    <script type="module">
const _0x38d203=_0x360e;function _0x5dbd(){const _0x49b1bd=['เกิดข้อผิดพลาด:\x20','join','text-transparent','reward-display-badge','to-pink-100','claim-time-val','1086118BBNxBn','getItem','border-yellow-300','toDate','data','claim-section-summary','winnersCount','กำลังสุ่ม...','result-icon-container','เครื่องนี้ถูกผูกบัญชีอื่นแล้ว\x20(ไม่สามารถลงทะเบียนใหม่ได้)','screen-error-device','SHA-256','btn-start-draw','1:1070273157855:web:5c8120e1df27e233d8676a','push','slice','Reward\x20claim\x20failed','reward','text-2xl\x20font-black\x20drop-shadow-sm\x20mb-4','btn-claim-reward','from-yellow-100','encode','50%','bg-purple-50/30','bg-gradient-to-r','deviceId','coop_device_identifier','toString','createIcons','undefined','to-orange-100','from-purple-100','screen-success','error-msg-text','text-gray-500','rewardClaimTime','100%','name','=([^;]+)','toLocaleString','th-TH','from-gray-100','validate-progress','lucide','userHash','CheckOUT','result-footer-text','ttb-register.firebaseapp.com','/public/data/coop_registrations','border-purple-500','cookie','to-red-600','4686792vPnzHK','length',';\x20path=/;\x20max-age=31536000','CheckIN','success-checkout-time','floor','DEV-','prizesList','citizenId','preventDefault','setItem','8UigxHz','border-gray-300','4308780kMlWWV','<i\x20data-lucide=\x22frown\x22\x20width=\x2260\x22\x20height=\x2260\x22\x20class=\x22mx-auto\x20text-gray-400\x22></i>','cursor-not-allowed','btn-claim-reward-summary','map','message','padStart','totalQty','to-gray-200','464400GBAhoD','border-gray-200','bg-gray-200','ยินดีด้วย!\x20ท่านได้รับ','text-gray-400','draw-state-validating','60RoozhQ','prize-result-name','innerHTML','substr','digest','bg-clip-text','disabled','width','value','coop_gift','querySelector','empty','coop_registered_citizen_id','text-white','1070273157855','btn-submit','exists','1065122bSOZvP','183DwULWI','6907815kdHDDM','innerText','ลงทะเบียนออก','shadow-purple-200','เสียใจด้วย','artifacts/','classList','add','https://ttb-register-default-rtdb.asia-southeast1.firebasedate.app','msg-box-recorded','load','docs','shadow-none','resetForm','target','#draw-state-result\x20h2','remove','replace','screen-luckydraw','status','กำลังบันทึก...','from-yellow-600','text-gray-600','subtle','bg-purple-600','text-claim-time-summary','ไม่พบข้อมูลผู้ใช้\x20กรุณาลงทะเบียนใหม่','error','screen-form','parse','Save\x20Prize\x20Error:','hidden','style','default-app-id','getElementById','currentDocId','user','random','ลงทะเบียนสำเร็จ','forEach','กำลังตรวจสอบ...','registration-form','then','/public/data/','ttb-register.firebasestorage.app','text-purple-800','idCard','match','btn-text','currentReward','ไม่ได้รับรางวัล','(^|\x20)','icon-check-valid','success-checkin-time','focus','now','94916YpnQtr','addEventListener','ท่านเคยได้รับรางวัลแล้ว','claim-time-val-summary','draw-state-spinning','text-claim-time','app','claim-section','1HgIwUN','โชคดี...','รหัสบัตรประชาชนนี้\x20ผูกกับโทรศัพท์เครื่องอื่นแล้ว<br>(ไม่สามารถเปลี่ยนเครื่องได้)'];_0x5dbd=function(){return _0x49b1bd;};return _0x5dbd();}(function(_0x5f0eb4,_0x3b3364){const _0x4fa06d=_0x360e,_0x32ecd2=_0x5f0eb4();while(!![]){try{const _0x5411e5=-parseInt(_0x4fa06d(0x111))/0x1*(parseInt(_0x4fa06d(0xcf))/0x2)+-parseInt(_0x4fa06d(0xd0))/0x3*(parseInt(_0x4fa06d(0x109))/0x4)+parseInt(_0x4fa06d(0xb8))/0x5+parseInt(_0x4fa06d(0xa2))/0x6+parseInt(_0x4fa06d(0xaf))/0x7+-parseInt(_0x4fa06d(0xad))/0x8*(-parseInt(_0x4fa06d(0xd1))/0x9)+-parseInt(_0x4fa06d(0xbe))/0xa*(-parseInt(_0x4fa06d(0x11a))/0xb);if(_0x5411e5===_0x3b3364)break;else _0x32ecd2['push'](_0x32ecd2['shift']());}catch(_0x2954dd){_0x32ecd2['push'](_0x32ecd2['shift']());}}}(_0x5dbd,0xd446d));import{initializeApp}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js';import{getAuth,signInAnonymously,onAuthStateChanged,signInWithCustomToken}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js';import{getFirestore,collection,updateDoc,doc,serverTimestamp,query,where,getDocs,getDoc,addDoc,onSnapshot}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js';const TARGET_COLLECTION_NAME='tmb_coop',PRIZES_COLLECTION_NAME=_0x38d203(0xc7),isSandboxEnv=typeof __firebase_config!==_0x38d203(0x137);function _0x360e(_0x2adf26,_0x2d1821){_0x2adf26=_0x2adf26-0x9c;const _0x5dbd25=_0x5dbd();let _0x360e12=_0x5dbd25[_0x2adf26];return _0x360e12;}let firebaseConfig,finalCollectionPath,prizesCollectionPath;if(isSandboxEnv){firebaseConfig=JSON[_0x38d203(0xee)](__firebase_config);const appId=typeof __app_id!==_0x38d203(0x137)?__app_id:_0x38d203(0xf2);finalCollectionPath=_0x38d203(0xd6)+appId+_0x38d203(0x9e),prizesCollectionPath=_0x38d203(0xd6)+appId+_0x38d203(0xfc)+PRIZES_COLLECTION_NAME;}else firebaseConfig={'apiKey':'AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','authDomain':_0x38d203(0x9d),'databaseURL':_0x38d203(0xd9),'projectId':'ttb-register','storageBucket':_0x38d203(0xfd),'messagingSenderId':_0x38d203(0xcc),'appId':_0x38d203(0x127),'measurementId':'G-9DJLWJ5LQ1'},finalCollectionPath=TARGET_COLLECTION_NAME,prizesCollectionPath=PRIZES_COLLECTION_NAME;const app=initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app),state={'user':null,'idCard':'','currentDocId':null,'userHash':null,'currentReward':null,'prizesList':[],'winnersCount':{}};async function sha256(_0x1ac503){const _0x58e258=_0x38d203,_0x18c146=new TextEncoder()[_0x58e258(0x12f)](_0x1ac503),_0xf707be=await crypto[_0x58e258(0xe8)][_0x58e258(0xc2)](_0x58e258(0x125),_0x18c146),_0x361060=Array['from'](new Uint8Array(_0xf707be));return _0x361060[_0x58e258(0xb3)](_0x127f03=>_0x127f03['toString'](0x10)[_0x58e258(0xb5)](0x2,'0'))[_0x58e258(0x115)]('');}function getDeviceId(){const _0x80a314=_0x38d203,_0x3c6775=_0x80a314(0x134);let _0x4cebf8=localStorage[_0x80a314(0x11b)](_0x3c6775);if(!_0x4cebf8){const _0x241159=document[_0x80a314(0xa0)][_0x80a314(0x100)](new RegExp(_0x80a314(0x104)+_0x3c6775+_0x80a314(0x140)));_0x241159&&(_0x4cebf8=_0x241159[0x2],localStorage[_0x80a314(0xac)](_0x3c6775,_0x4cebf8));}return!_0x4cebf8?(_0x4cebf8=_0x80a314(0xa8)+Date[_0x80a314(0x108)]()[_0x80a314(0x135)](0x24)+Math[_0x80a314(0xf6)]()[_0x80a314(0x135)](0x24)[_0x80a314(0xc1)](0x2,0x9),localStorage['setItem'](_0x3c6775,_0x4cebf8),document[_0x80a314(0xa0)]=_0x3c6775+'='+_0x4cebf8+_0x80a314(0xa4)):document[_0x80a314(0xa0)]=_0x3c6775+'='+_0x4cebf8+';\x20path=/;\x20max-age=31536000',_0x4cebf8;}function setLocalRegistration(_0x2b5220){const _0x2f6f88=_0x38d203;localStorage[_0x2f6f88(0xac)](_0x2f6f88(0xca),_0x2b5220);}function getLocalRegistration(){const _0x4b9f7f=_0x38d203;return localStorage[_0x4b9f7f(0x11b)](_0x4b9f7f(0xca));}function setupDataListeners(){const _0x558124=_0x38d203,_0x4875da=query(collection(db,prizesCollectionPath));onSnapshot(_0x4875da,_0x2e2999=>{const _0x48fe50=_0x360e,_0x168472=[];_0x2e2999[_0x48fe50(0xf8)](_0x447381=>{const _0xee45b2=_0x48fe50;_0x168472[_0xee45b2(0x128)]({'id':_0x447381['id'],..._0x447381['data']()});}),state[_0x48fe50(0xa9)]=_0x168472;});const _0x5a7a0b=query(collection(db,finalCollectionPath),where(_0x558124(0x12b),'>',''));onSnapshot(_0x5a7a0b,_0x5add50=>{const _0x5e8b94={};_0x5add50['forEach'](_0x16a2b7=>{const _0x17f622=_0x360e,_0x1f9631=_0x16a2b7[_0x17f622(0x11e)]()[_0x17f622(0x12b)];if(_0x1f9631)_0x5e8b94[_0x1f9631]=(_0x5e8b94[_0x1f9631]||0x0)+0x1;}),state['winnersCount']=_0x5e8b94;});}window['app']={'resetForm':()=>{const _0x50a835=_0x38d203;[_0x50a835(0x13a),'screen-error-device','screen-not-found',_0x50a835(0xe3)]['forEach'](_0x1c3b46=>document[_0x50a835(0xf3)](_0x1c3b46)[_0x50a835(0xd7)][_0x50a835(0xd8)](_0x50a835(0xf0))),document['getElementById'](_0x50a835(0xed))[_0x50a835(0xd7)][_0x50a835(0xe1)](_0x50a835(0xf0)),document['getElementById'](_0x50a835(0xff))[_0x50a835(0xc6)]='',document[_0x50a835(0xf3)](_0x50a835(0x105))[_0x50a835(0xd7)][_0x50a835(0xd8)](_0x50a835(0xf0)),document[_0x50a835(0xf3)](_0x50a835(0x11f))[_0x50a835(0xd7)]['add'](_0x50a835(0xf0)),document[_0x50a835(0xf3)]('msg-box-recorded')[_0x50a835(0xd7)][_0x50a835(0xe1)](_0x50a835(0xf0));const _0x18ef60=document['getElementById'](_0x50a835(0xcd));_0x18ef60[_0x50a835(0xc4)]=!![],_0x18ef60[_0x50a835(0xd7)][_0x50a835(0xd8)](_0x50a835(0xba),_0x50a835(0xbc)),_0x18ef60[_0x50a835(0xd7)][_0x50a835(0xe1)](_0x50a835(0xe9),_0x50a835(0xcb)),document[_0x50a835(0xf3)](_0x50a835(0x101))[_0x50a835(0xd2)]=_0x50a835(0xd3),document[_0x50a835(0xf3)]('btn-loader')[_0x50a835(0xd7)][_0x50a835(0xd8)](_0x50a835(0xf0)),state[_0x50a835(0xff)]='',state[_0x50a835(0xf4)]=null,state['currentReward']=null,document[_0x50a835(0xf3)](_0x50a835(0xff))[_0x50a835(0x107)]();},'goToLuckyDraw':async()=>{const _0x2a2d75=_0x38d203;document['getElementById']('screen-success')['classList'][_0x2a2d75(0xd8)](_0x2a2d75(0xf0)),document['getElementById'](_0x2a2d75(0xe3))[_0x2a2d75(0xd7)]['remove'](_0x2a2d75(0xf0)),document['getElementById'](_0x2a2d75(0xbd))[_0x2a2d75(0xd7)]['remove']('hidden'),document['getElementById']('draw-state-spinning')['classList'][_0x2a2d75(0xd8)](_0x2a2d75(0xf0)),document[_0x2a2d75(0xf3)]('draw-state-result')[_0x2a2d75(0xd7)][_0x2a2d75(0xd8)](_0x2a2d75(0xf0)),setTimeout(()=>{const _0x5a29ec=_0x2a2d75;document[_0x5a29ec(0xf3)](_0x5a29ec(0x144))[_0x5a29ec(0xf1)][_0x5a29ec(0xc5)]=_0x5a29ec(0x130);},0x64),setTimeout(()=>{const _0x1a6ec7=_0x2a2d75;document[_0x1a6ec7(0xf3)](_0x1a6ec7(0x144))[_0x1a6ec7(0xf1)][_0x1a6ec7(0xc5)]=_0x1a6ec7(0x13e);},0x5dc),setTimeout(async()=>{const _0x4729e6=_0x2a2d75;if(state[_0x4729e6(0xf4)])try{const _0x56d64f=doc(db,finalCollectionPath,state['currentDocId']),_0x3f4fb5=await getDoc(_0x56d64f),_0x321d18=_0x3f4fb5[_0x4729e6(0x11e)]();_0x3f4fb5[_0x4729e6(0xce)]()&&_0x321d18[_0x4729e6(0x12b)]?showResult(_0x321d18[_0x4729e6(0x12b)],!![],_0x321d18['rewardClaimTime']):startSpinning();}catch(_0x4a6163){console[_0x4729e6(0xec)](_0x4a6163),alert('เกิดข้อผิดพลาดในการตรวจสอบข้อมูล'),window[_0x4729e6(0x10f)]['resetForm']();}else alert(_0x4729e6(0xeb)),window['app'][_0x4729e6(0xde)]();},0x7d0);},'backToSummary':()=>{const _0x3a636f=_0x38d203;document[_0x3a636f(0xf3)](_0x3a636f(0xe3))[_0x3a636f(0xd7)][_0x3a636f(0xd8)](_0x3a636f(0xf0)),document[_0x3a636f(0xf3)](_0x3a636f(0x13a))[_0x3a636f(0xd7)][_0x3a636f(0xe1)](_0x3a636f(0xf0)),state[_0x3a636f(0x102)]&&(state[_0x3a636f(0xf4)]&&getDoc(doc(db,finalCollectionPath,state[_0x3a636f(0xf4)]))[_0x3a636f(0xfb)](_0x14acc4=>{const _0x5a75be=_0x3a636f;_0x14acc4[_0x5a75be(0xce)]()&&updateSuccessScreen(_0x14acc4[_0x5a75be(0x11e)]()[_0x5a75be(0x12b)],_0x14acc4[_0x5a75be(0x11e)]()[_0x5a75be(0x13d)]);}));},'claimReward':async _0x35fdae=>{const _0x32c488=_0x38d203;if(!state[_0x32c488(0xf4)])return;const _0x2a9b81=_0x35fdae==='summary',_0x5e32f6=_0x2a9b81?_0x32c488(0xb2):_0x32c488(0x12d),_0x81c107=_0x2a9b81?_0x32c488(0xea):_0x32c488(0x10e),_0x3d9d7a=_0x2a9b81?_0x32c488(0x10c):'claim-time-val',_0x5d0e8c=document[_0x32c488(0xf3)](_0x5e32f6),_0x8827e6=_0x5d0e8c['innerHTML'];_0x5d0e8c[_0x32c488(0xc4)]=!![],_0x5d0e8c[_0x32c488(0xd2)]=_0x32c488(0xe5);try{await updateDoc(doc(db,finalCollectionPath,state[_0x32c488(0xf4)]),{'rewardClaimTime':serverTimestamp()});const _0x177693=new Date(),_0xa6db8b=_0x177693[_0x32c488(0x141)](_0x32c488(0x142));_0x5d0e8c[_0x32c488(0xd7)][_0x32c488(0xd8)](_0x32c488(0xf0)),document[_0x32c488(0xf3)](_0x81c107)[_0x32c488(0xd7)][_0x32c488(0xe1)](_0x32c488(0xf0)),document[_0x32c488(0xf3)](_0x3d9d7a)[_0x32c488(0xd2)]=_0xa6db8b,confetti({'particleCount':0x64,'spread':0x3c,'origin':{'y':0.7}});}catch(_0x5abd06){console['error'](_0x5abd06),console[_0x32c488(0xec)](_0x32c488(0x12a)),_0x5d0e8c[_0x32c488(0xc4)]=![],_0x5d0e8c[_0x32c488(0xc0)]=_0x8827e6;}}};function updateSuccessScreen(_0x55d8f0,_0x2bf552){const _0x5a1d45=_0x38d203;document[_0x5a1d45(0xf3)](_0x5a1d45(0x126))[_0x5a1d45(0xd7)]['add'](_0x5a1d45(0xf0));const _0x20cb75=document['getElementById'](_0x5a1d45(0x117));_0x20cb75[_0x5a1d45(0xd7)][_0x5a1d45(0xe1)](_0x5a1d45(0xf0));const _0x3fc891=document[_0x5a1d45(0xf3)]('reward-name-text');_0x3fc891[_0x5a1d45(0xd2)]=_0x55d8f0;_0x55d8f0===_0x5a1d45(0x103)?(_0x20cb75[_0x5a1d45(0xd7)][_0x5a1d45(0xe1)](_0x5a1d45(0x139),_0x5a1d45(0x118),'border-purple-300'),_0x20cb75[_0x5a1d45(0xd7)][_0x5a1d45(0xd8)](_0x5a1d45(0x143),_0x5a1d45(0xb7),_0x5a1d45(0xae)),_0x3fc891['classList'][_0x5a1d45(0xe1)](_0x5a1d45(0xfe)),_0x3fc891[_0x5a1d45(0xd7)]['add'](_0x5a1d45(0xe7))):(_0x20cb75[_0x5a1d45(0xd7)][_0x5a1d45(0xd8)]('from-purple-100',_0x5a1d45(0x118),'border-purple-300'),_0x20cb75[_0x5a1d45(0xd7)][_0x5a1d45(0xe1)]('from-gray-100','to-gray-200',_0x5a1d45(0xae)),_0x3fc891[_0x5a1d45(0xd7)][_0x5a1d45(0xd8)](_0x5a1d45(0xfe)),_0x3fc891[_0x5a1d45(0xd7)][_0x5a1d45(0xe1)]('text-gray-600'));document[_0x5a1d45(0xf3)](_0x5a1d45(0xda))[_0x5a1d45(0xd7)]['add'](_0x5a1d45(0xf0));const _0x49245d=document[_0x5a1d45(0xf3)](_0x5a1d45(0x11f)),_0x215d25=document[_0x5a1d45(0xf3)](_0x5a1d45(0xb2)),_0x310b1a=document[_0x5a1d45(0xf3)](_0x5a1d45(0xea)),_0x1968b0=document['getElementById'](_0x5a1d45(0x10c));if(_0x55d8f0===_0x5a1d45(0x103))_0x49245d['classList'][_0x5a1d45(0xd8)]('hidden');else{_0x49245d[_0x5a1d45(0xd7)][_0x5a1d45(0xe1)](_0x5a1d45(0xf0));if(_0x2bf552){_0x215d25[_0x5a1d45(0xd7)][_0x5a1d45(0xd8)](_0x5a1d45(0xf0)),_0x310b1a[_0x5a1d45(0xd7)][_0x5a1d45(0xe1)](_0x5a1d45(0xf0));const _0x416b02=_0x2bf552['toDate']?_0x2bf552['toDate']():new Date(_0x2bf552);_0x1968b0[_0x5a1d45(0xd2)]=_0x416b02[_0x5a1d45(0x141)]('th-TH');}else _0x215d25[_0x5a1d45(0xd7)][_0x5a1d45(0xe1)](_0x5a1d45(0xf0)),_0x310b1a[_0x5a1d45(0xd7)][_0x5a1d45(0xd8)](_0x5a1d45(0xf0));}}function startSpinning(){const _0x6a5392=_0x38d203;document[_0x6a5392(0xf3)](_0x6a5392(0xbd))[_0x6a5392(0xd7)][_0x6a5392(0xd8)](_0x6a5392(0xf0)),document[_0x6a5392(0xf3)](_0x6a5392(0x10d))[_0x6a5392(0xd7)][_0x6a5392(0xe1)](_0x6a5392(0xf0));const _0x2c371d=[];state['prizesList'][_0x6a5392(0xf8)](_0xc3c9e3=>{const _0x91ebc1=_0x6a5392,_0x14bab2=parseInt(_0xc3c9e3[_0x91ebc1(0xb6)])||0x0,_0x2bf133=state[_0x91ebc1(0x120)][_0xc3c9e3[_0x91ebc1(0x13f)]]||0x0;_0x14bab2>_0x2bf133&&_0x2c371d['push'](_0xc3c9e3['name']);});const _0x2497ee=_0x2c371d[_0x6a5392(0xa3)]>0x0?_0x2c371d:[_0x6a5392(0x121),_0x6a5392(0x112),'รางวัลใหญ่...'],_0x55309f=document[_0x6a5392(0xf3)]('prize-ticker');let _0x59971c=0x0;const _0xce1d62=setInterval(()=>{const _0xb5c2d7=_0x6a5392;_0x55309f[_0xb5c2d7(0xd2)]=_0x2497ee[Math[_0xb5c2d7(0xa7)](Math[_0xb5c2d7(0xf6)]()*_0x2497ee[_0xb5c2d7(0xa3)])],_0x59971c++,_0x59971c>0x14&&(clearInterval(_0xce1d62),finalizePrize());},0x64);}async function finalizePrize(){const _0x1f1906=_0x38d203,_0x4a8687=[];state['prizesList'][_0x1f1906(0xf8)](_0xb81507=>{const _0x413b42=_0x1f1906,_0x4de403=parseInt(_0xb81507[_0x413b42(0xb6)])||0x0,_0x3254cd=state['winnersCount'][_0xb81507[_0x413b42(0x13f)]]||0x0;_0x4de403>_0x3254cd&&_0x4a8687[_0x413b42(0x128)](_0xb81507[_0x413b42(0x13f)]);});let _0x2e8aa2=_0x1f1906(0x103);const _0x3f49d8=Math[_0x1f1906(0xf6)]()>0.3;_0x4a8687[_0x1f1906(0xa3)]>0x0&&_0x3f49d8&&(_0x2e8aa2=_0x4a8687[Math[_0x1f1906(0xa7)](Math[_0x1f1906(0xf6)]()*_0x4a8687[_0x1f1906(0xa3)])]);try{state[_0x1f1906(0xf4)]&&(await updateDoc(doc(db,finalCollectionPath,state[_0x1f1906(0xf4)]),{'reward':_0x2e8aa2,'rewardTime':serverTimestamp()}),showResult(_0x2e8aa2,![],null));}catch(_0x53ba4f){console[_0x1f1906(0xec)](_0x1f1906(0xef),_0x53ba4f);}}function showResult(_0x4a9b9a,_0x3eb666,_0x6c9999){const _0x41f8bd=_0x38d203;state['currentReward']=_0x4a9b9a,document[_0x41f8bd(0xf3)](_0x41f8bd(0x10d))[_0x41f8bd(0xd7)]['add']('hidden'),document[_0x41f8bd(0xf3)]('draw-state-validating')[_0x41f8bd(0xd7)][_0x41f8bd(0xd8)](_0x41f8bd(0xf0)),document[_0x41f8bd(0xf3)]('draw-state-result')[_0x41f8bd(0xd7)]['remove'](_0x41f8bd(0xf0));const _0x2f933c=document[_0x41f8bd(0xc8)](_0x41f8bd(0xe0)),_0x54b156=document[_0x41f8bd(0xf3)]('result-card'),_0x5b5b5b=document[_0x41f8bd(0xf3)](_0x41f8bd(0xbf)),_0x4bc48b=document[_0x41f8bd(0xf3)](_0x41f8bd(0x122));_0x5b5b5b['className']=_0x41f8bd(0x12c);if(_0x4a9b9a===_0x41f8bd(0x103))_0x2f933c[_0x41f8bd(0xd2)]=_0x3eb666?'ประวัติการสุ่มรางวัล':_0x41f8bd(0xd5),_0x5b5b5b[_0x41f8bd(0xd2)]='คุณไม่ได้รางวัล',_0x5b5b5b['classList'][_0x41f8bd(0xd8)](_0x41f8bd(0x13c)),_0x54b156[_0x41f8bd(0xd7)][_0x41f8bd(0xe1)]('from-yellow-100',_0x41f8bd(0x138),_0x41f8bd(0x11c)),_0x54b156['classList'][_0x41f8bd(0xd8)](_0x41f8bd(0x143),'to-gray-200','border-gray-300'),_0x4bc48b[_0x41f8bd(0xc0)]=_0x41f8bd(0xb0),document['getElementById']('claim-section')['classList'][_0x41f8bd(0xd8)](_0x41f8bd(0xf0)),document[_0x41f8bd(0xf3)](_0x41f8bd(0x9c))[_0x41f8bd(0xd7)][_0x41f8bd(0xd8)](_0x41f8bd(0xf0));else{_0x2f933c['innerText']=_0x3eb666?_0x41f8bd(0x10b):_0x41f8bd(0xbb),_0x5b5b5b['innerText']=_0x4a9b9a,_0x5b5b5b[_0x41f8bd(0xd7)][_0x41f8bd(0xd8)](_0x41f8bd(0x116),_0x41f8bd(0xc3),_0x41f8bd(0x132),_0x41f8bd(0xe6),_0x41f8bd(0xa1)),_0x54b156[_0x41f8bd(0xd7)][_0x41f8bd(0xd8)](_0x41f8bd(0x12e),_0x41f8bd(0x138),_0x41f8bd(0x11c)),_0x54b156[_0x41f8bd(0xd7)]['remove'](_0x41f8bd(0x143),_0x41f8bd(0xb7),_0x41f8bd(0xae)),_0x4bc48b[_0x41f8bd(0xc0)]='<i\x20data-lucide=\x22crown\x22\x20width=\x2260\x22\x20height=\x2260\x22\x20class=\x22mx-auto\x20text-yellow-500\x22></i>',document[_0x41f8bd(0xf3)](_0x41f8bd(0x110))[_0x41f8bd(0xd7)][_0x41f8bd(0xe1)](_0x41f8bd(0xf0)),document['getElementById']('result-footer-text')[_0x41f8bd(0xd7)][_0x41f8bd(0xe1)]('hidden');const _0x11abfa=document[_0x41f8bd(0xf3)](_0x41f8bd(0x12d)),_0x1321fd=document[_0x41f8bd(0xf3)](_0x41f8bd(0x10e)),_0x343cf7=document['getElementById'](_0x41f8bd(0x119));if(_0x6c9999){_0x11abfa[_0x41f8bd(0xd7)][_0x41f8bd(0xd8)](_0x41f8bd(0xf0)),_0x1321fd[_0x41f8bd(0xd7)]['remove'](_0x41f8bd(0xf0));const _0x5f3349=_0x6c9999[_0x41f8bd(0x11d)]?_0x6c9999[_0x41f8bd(0x11d)]():new Date(_0x6c9999);_0x343cf7[_0x41f8bd(0xd2)]=_0x5f3349[_0x41f8bd(0x141)](_0x41f8bd(0x142));}else _0x11abfa[_0x41f8bd(0xd7)][_0x41f8bd(0xe1)]('hidden'),_0x11abfa[_0x41f8bd(0xc4)]=![],_0x1321fd['classList'][_0x41f8bd(0xd8)](_0x41f8bd(0xf0));!_0x3eb666&&confetti({'particleCount':0x96,'spread':0x46,'origin':{'y':0.6}});}if(window[_0x41f8bd(0x145)])lucide[_0x41f8bd(0x136)]();}async function submitForm(_0x5ac869){const _0x1e359c=_0x38d203;_0x5ac869[_0x1e359c(0xab)]();if(!state[_0x1e359c(0xf5)])return;const _0x36c7b4=document[_0x1e359c(0xf3)](_0x1e359c(0xcd)),_0x440c6b=document[_0x1e359c(0xf3)]('btn-text'),_0x357494=document['getElementById']('btn-loader');_0x36c7b4[_0x1e359c(0xc4)]=!![],_0x440c6b[_0x1e359c(0xd2)]=_0x1e359c(0xf9),_0x357494['classList'][_0x1e359c(0xe1)]('hidden');try{const _0x3562e8=getDeviceId(),_0x245a2c=state[_0x1e359c(0xff)]['replace'](/-/g,''),_0x297af5=await sha256(_0x245a2c);state[_0x1e359c(0x146)]=_0x297af5;const _0x433f2b=getLocalRegistration();if(_0x433f2b&&_0x433f2b!==_0x297af5){document[_0x1e359c(0xf3)]('error-msg-text')[_0x1e359c(0xd2)]='อุปกรณ์นี้ได้ทำการลงทะเบียนให้กับหมายเลขบัตรประชาชนอื่นไปแล้ว\x20ไม่สามารถลงทะเบียนซ้ำได้\x20(Local\x20Lock)',document[_0x1e359c(0xf3)]('screen-form')[_0x1e359c(0xd7)]['add'](_0x1e359c(0xf0)),document[_0x1e359c(0xf3)]('screen-error-device')[_0x1e359c(0xd7)][_0x1e359c(0xe1)](_0x1e359c(0xf0));return;}const _0x5dfdfe=query(collection(db,finalCollectionPath),where(_0x1e359c(0xaa),'==',_0x297af5)),_0x5e5c7b=await getDocs(_0x5dfdfe);if(!_0x5e5c7b['empty']){const _0x21818e=_0x5e5c7b[_0x1e359c(0xdc)][0x0],_0x500cb7=_0x21818e[_0x1e359c(0x11e)]();if(_0x500cb7[_0x1e359c(0x133)]&&_0x500cb7['deviceId']!==_0x3562e8){document[_0x1e359c(0xf3)]('error-msg-text')[_0x1e359c(0xc0)]=_0x1e359c(0x113),document[_0x1e359c(0xf3)]('screen-form')[_0x1e359c(0xd7)][_0x1e359c(0xd8)]('hidden'),document['getElementById'](_0x1e359c(0x124))[_0x1e359c(0xd7)][_0x1e359c(0xe1)]('hidden');return;}state[_0x1e359c(0xf4)]=_0x21818e['id'];let _0x2f45f8='-';if(_0x500cb7[_0x1e359c(0xa5)]){const _0x57775f=_0x500cb7[_0x1e359c(0xa5)]['toDate']?_0x500cb7[_0x1e359c(0xa5)]['toDate']():new Date(_0x500cb7[_0x1e359c(0xa5)]);_0x2f45f8=_0x57775f[_0x1e359c(0x141)]('th-TH');}let _0x421bbf='';const _0x1c5cbb=new Date();_0x421bbf=_0x1c5cbb[_0x1e359c(0x141)]('th-TH');const _0x128925={};let _0x16f7eb=![];!_0x500cb7[_0x1e359c(0x133)]&&(_0x128925[_0x1e359c(0x133)]=_0x3562e8,_0x16f7eb=!![]);if(!_0x500cb7['CheckOUT'])_0x128925[_0x1e359c(0x147)]=serverTimestamp(),_0x500cb7[_0x1e359c(0xa5)]?_0x128925[_0x1e359c(0xe4)]=_0x1e359c(0xf7):_0x128925[_0x1e359c(0xe4)]='checked-out',_0x16f7eb=!![];else{const _0x38624c=_0x500cb7[_0x1e359c(0x147)][_0x1e359c(0x11d)]?_0x500cb7[_0x1e359c(0x147)][_0x1e359c(0x11d)]():new Date(_0x500cb7[_0x1e359c(0x147)]);_0x421bbf=_0x38624c[_0x1e359c(0x141)](_0x1e359c(0x142));}_0x16f7eb&&await updateDoc(doc(db,finalCollectionPath,_0x21818e['id']),_0x128925),setLocalRegistration(_0x297af5),document[_0x1e359c(0xf3)](_0x1e359c(0x106))['innerText']=_0x2f45f8,document[_0x1e359c(0xf3)](_0x1e359c(0xa6))[_0x1e359c(0xd2)]=_0x421bbf,document[_0x1e359c(0xf3)](_0x1e359c(0xed))[_0x1e359c(0xd7)]['add']('hidden'),document[_0x1e359c(0xf3)](_0x1e359c(0x13a))[_0x1e359c(0xd7)]['remove'](_0x1e359c(0xf0)),_0x500cb7[_0x1e359c(0x12b)]?(state[_0x1e359c(0x102)]=_0x500cb7['reward'],updateSuccessScreen(_0x500cb7['reward'],_0x500cb7[_0x1e359c(0x13d)])):(state[_0x1e359c(0x102)]=null,document['getElementById'](_0x1e359c(0x126))['classList'][_0x1e359c(0xe1)](_0x1e359c(0xf0)),document[_0x1e359c(0xf3)](_0x1e359c(0x117))[_0x1e359c(0xd7)][_0x1e359c(0xd8)](_0x1e359c(0xf0)),document[_0x1e359c(0xf3)]('claim-section-summary')[_0x1e359c(0xd7)][_0x1e359c(0xd8)](_0x1e359c(0xf0)));}else{const _0x14f610=query(collection(db,finalCollectionPath),where(_0x1e359c(0x133),'==',_0x3562e8)),_0x1acb1=await getDocs(_0x14f610);if(!_0x1acb1[_0x1e359c(0xc9)])document['getElementById'](_0x1e359c(0x13b))[_0x1e359c(0xd2)]=_0x1e359c(0x123),document[_0x1e359c(0xf3)](_0x1e359c(0xed))[_0x1e359c(0xd7)][_0x1e359c(0xd8)](_0x1e359c(0xf0)),document[_0x1e359c(0xf3)](_0x1e359c(0x124))[_0x1e359c(0xd7)][_0x1e359c(0xe1)](_0x1e359c(0xf0));else{const _0x532a92=await addDoc(collection(db,finalCollectionPath),{'citizenId':_0x297af5,'deviceId':_0x3562e8,'CheckIN':serverTimestamp(),'CheckOUT':serverTimestamp(),'status':_0x1e359c(0xf7)});state[_0x1e359c(0xf4)]=_0x532a92['id'],setLocalRegistration(_0x297af5);const _0x492c27=new Date(),_0x24f955=_0x492c27['toLocaleString'](_0x1e359c(0x142));updateSuccessUI(_0x24f955,_0x24f955,null,null,!![]);}}}catch(_0x4dd985){console[_0x1e359c(0xec)](_0x4dd985),alert(_0x1e359c(0x114)+_0x4dd985[_0x1e359c(0xb4)]);}finally{_0x36c7b4[_0x1e359c(0xc4)]=![],_0x440c6b[_0x1e359c(0xd2)]='ลงทะเบียนออก',_0x357494[_0x1e359c(0xd7)][_0x1e359c(0xd8)](_0x1e359c(0xf0)),validateForm();}}function handleIdInput(_0x48c43d){const _0x14af94=_0x38d203;let _0x5d3d75=_0x48c43d[_0x14af94(0xdf)][_0x14af94(0xc6)][_0x14af94(0xe2)](/[^0-9]/g,'');if(_0x5d3d75[_0x14af94(0xa3)]>0xd)_0x5d3d75=_0x5d3d75[_0x14af94(0x129)](0x0,0xd);let _0x45855e=_0x5d3d75;if(_0x5d3d75[_0x14af94(0xa3)]>0x1)_0x45855e=_0x5d3d75[_0x14af94(0x129)](0x0,0x1)+'-'+_0x5d3d75[_0x14af94(0x129)](0x1);if(_0x5d3d75[_0x14af94(0xa3)]>0x5)_0x45855e=_0x45855e['slice'](0x0,0x6)+'-'+_0x45855e[_0x14af94(0x129)](0x6);if(_0x5d3d75[_0x14af94(0xa3)]>0xa)_0x45855e=_0x45855e['slice'](0x0,0xc)+'-'+_0x45855e[_0x14af94(0x129)](0xc);if(_0x5d3d75[_0x14af94(0xa3)]>0xc)_0x45855e=_0x45855e[_0x14af94(0x129)](0x0,0xf)+'-'+_0x45855e[_0x14af94(0x129)](0xf);document['getElementById'](_0x14af94(0xff))[_0x14af94(0xc6)]=_0x45855e,state[_0x14af94(0xff)]=_0x45855e;const _0x4d834b=document[_0x14af94(0xf3)]('icon-check-valid'),_0x25045d=document[_0x14af94(0xf3)](_0x14af94(0xff));_0x5d3d75[_0x14af94(0xa3)]===0xd?(_0x25045d[_0x14af94(0xd7)][_0x14af94(0xd8)](_0x14af94(0x9f),_0x14af94(0x131)),_0x25045d['classList'][_0x14af94(0xe1)](_0x14af94(0xb9)),_0x4d834b[_0x14af94(0xd7)][_0x14af94(0xe1)](_0x14af94(0xf0))):(_0x25045d[_0x14af94(0xd7)][_0x14af94(0xe1)](_0x14af94(0x9f),_0x14af94(0x131)),_0x25045d[_0x14af94(0xd7)][_0x14af94(0xd8)]('border-gray-200'),_0x4d834b[_0x14af94(0xd7)][_0x14af94(0xd8)]('hidden')),validateForm();}function validateForm(){const _0x27dfcf=_0x38d203,_0x337227=state[_0x27dfcf(0xff)][_0x27dfcf(0xe2)](/[^0-9]/g,'')[_0x27dfcf(0xa3)]===0xd,_0x19947f=document[_0x27dfcf(0xf3)](_0x27dfcf(0xcd));_0x337227?(_0x19947f[_0x27dfcf(0xc4)]=![],_0x19947f[_0x27dfcf(0xd7)][_0x27dfcf(0xd8)](_0x27dfcf(0xe9),_0x27dfcf(0xcb),'hover:bg-purple-700','shadow-purple-200'),_0x19947f[_0x27dfcf(0xd7)][_0x27dfcf(0xe1)]('bg-gray-200','text-gray-400',_0x27dfcf(0xb1),_0x27dfcf(0xdd))):(_0x19947f[_0x27dfcf(0xc4)]=!![],_0x19947f[_0x27dfcf(0xd7)]['remove'](_0x27dfcf(0xe9),'text-white','hover:bg-purple-700',_0x27dfcf(0xd4)),_0x19947f[_0x27dfcf(0xd7)][_0x27dfcf(0xd8)]('bg-gray-200',_0x27dfcf(0xbc),'cursor-not-allowed','shadow-none'));}document['getElementById'](_0x38d203(0xfa))[_0x38d203(0x10a)]('submit',submitForm),document['getElementById']('idCard')['addEventListener']('input',handleIdInput),window[_0x38d203(0x10a)](_0x38d203(0xdb),()=>document[_0x38d203(0xf3)](_0x38d203(0xff))[_0x38d203(0x107)]());async function initAuth(){const _0x4d72b6=_0x38d203;typeof __initial_auth_token!==_0x4d72b6(0x137)&&__initial_auth_token?await signInWithCustomToken(auth,__initial_auth_token):await signInAnonymously(auth),setupDataListeners();}onAuthStateChanged(auth,_0x253a2a=>state['user']=_0x253a2a),initAuth();if(window[_0x38d203(0x145)])lucide[_0x38d203(0x136)]();

    </script>
</body>
</html>