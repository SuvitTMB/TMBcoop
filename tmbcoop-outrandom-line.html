<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ลงทะเบียนออกและลุ้นรางวัล - สหกรณ์ออมทรัพย์ฯ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Font (Sarabun) -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Confetti for Lucky Draw -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .hidden { display: none !important; }
        /* Custom Animations */
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes bounce-slow {
            0%, 100% { transform: translateY(-5%); }
            50% { transform: translateY(5%); }
        }
        .animate-bounce-slow { animation: bounce-slow 2s infinite; }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-10">

    <!-- Header Section -->
    <div class="bg-gradient-to-r from-purple-600 to-indigo-700 text-white p-6 rounded-b-[2.5rem] shadow-lg mb-8 relative overflow-hidden">
        <div class="absolute top-0 right-0 opacity-10 transform translate-x-10 -translate-y-10">
            <i data-lucide="gift" width="150" height="150"></i>
        </div>
        
        <div class="relative z-10 flex flex-col items-center">
            <div class="bg-white/20 p-3 rounded-full mb-3 backdrop-blur-sm">
                <i data-lucide="party-popper" width="32" height="32" class="text-white"></i>
            </div>
            <h1 class="text-xl font-bold text-center">กิจกรรมลุ้นรางวัล</h1>
            <p class="text-purple-100 text-sm mt-1">สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด</p>
        </div>
    </div>

    <!-- Main Content Container -->
    <main class="px-2 sm:px-4 max-w-lg mx-auto -mt-10">
        
        <!-- Form Screen (Check-out first) -->
        <div id="screen-form" class="bg-white rounded-2xl shadow-xl p-6 border border-slate-100 relative z-20">
            <form id="registration-form" class="space-y-6 pt-2">
                <center>
                    <h2 class="text-lg font-bold text-gray-700 mb-4">ลงทะเบียนออกเพื่อลุ้นรางวัล</h2>
                    <div>
                        <label for="idCard" class="block text-sm font-semibold text-gray-700 mb-2">
                            เลขบัตรประจำตัวประชาชน
                        </label>
                        <div class="relative">
                            <input
                                type="text"
                                id="idCard"
                                placeholder="x-xxxx-xxxxx-xx-x"
                                class="w-full text-xl font-mono tracking-wide p-4 rounded-xl border-2 border-gray-200 bg-white focus:border-purple-400 focus:ring-4 focus:ring-purple-100 outline-none transition-all text-center"
                                inputmode="numeric"
                                maxlength="17"
                            />
                            <i id="icon-check-valid" data-lucide="check-circle" class="hidden absolute right-4 top-1/2 transform -translate-y-1/2 text-green-500 w-6 h-6 animate-fade-in"></i>
                        </div>
                        <p class="text-xs text-gray-400 mt-2 ml-1">กรุณากรอกตัวเลข 13 หลักให้ครบถ้วน</p>
                    </div>

                    <div class="p-3 bg-purple-50 text-purple-800 rounded-lg text-xs flex gap-2 items-start" style="margin-top:25px;">
                        <i data-lucide="shield-alert" class="w-4 h-4 shrink-0 mt-0.5"></i>
                        <span>ระบบจำกัดสิทธิ์ 1 เครื่อง / 1 ท่าน หากลงทะเบียนแล้วจะไม่สามารถเปลี่ยนเครื่องได้</span>
                    </div>
                </center>

                <button
                    type="submit"
                    id="btn-submit"
                    disabled
                    class="w-full py-3 rounded-lg font-semibold text-base shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2 bg-gray-200 text-gray-400 cursor-not-allowed shadow-none"
                >
                    <span id="btn-text">ลงทะเบียนออก</span>
                    <i id="btn-loader" data-lucide="loader-2" class="hidden animate-spin"></i>
                </button>
            </form>
        </div>

        <!-- Success Screen (Check-out Done & Reward Summary) -->
        <div id="screen-success" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i data-lucide="check-circle" class="text-green-600 w-10 h-10"></i>
            </div>
            
            <h2 id="success-title" class="text-xl font-bold text-gray-800 mb-4">ลงทะเบียนออกสำเร็จ</h2>
            
            <!-- Time Grid -->
            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="bg-blue-50 p-3 rounded-xl border border-blue-100 flex flex-col items-center justify-center">
                    <p class="text-xs font-bold text-blue-800 uppercase mb-1">ลงทะเบียนเข้า</p>
                    <p id="success-checkin-time" class="text-blue-600 font-mono text-sm font-semibold">--:--</p>
                </div>
                <div class="bg-orange-50 p-3 rounded-xl border border-orange-100 flex flex-col items-center justify-center">
                    <p class="text-xs font-bold text-orange-800 uppercase mb-1">ลงทะเบียนออก</p>
                    <p id="success-checkout-time" class="text-orange-600 font-mono text-sm font-semibold">--:--</p>
                </div>
            </div>
            
            <!-- Message Box (Will be hidden when reward exists) -->
            <div id="msg-box-recorded" class="bg-green-50 border border-green-100 rounded-xl p-5 mb-6 text-left shadow-sm">
                <h3 id="success-msg-header" class="font-bold text-green-900 mb-2 text-lg flex items-center gap-2">
                    <i data-lucide="calendar-check" width="20"></i> บันทึกเวลาเรียบร้อย
                </h3>
                <p id="success-msg-body" class="text-sm text-gray-700">
                    ท่านได้ลงทะเบียนออกและมีสิทธิ์ลุ้นรับรางวัลพิเศษจำนวน 50 รางวัล และขอให้ท่านเดินทางกลับโดยสวัสดิภาพ
                </p>
            </div>
            
            <!-- Lucky Draw Action Area -->
            <div id="lucky-draw-action-container">
                <!-- Case 1: Button for new draw -->
                <button id="btn-start-draw" onclick="window.app.goToLuckyDraw()" class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-white py-4 rounded-xl font-bold shadow-lg shadow-orange-200 hover:shadow-orange-300 transform hover:-translate-y-1 transition-all flex items-center justify-center gap-2 text-lg animate-bounce-slow">
                    <i data-lucide="gift" width="24"></i> กดเพื่อสุ่มของรางวัล
                </button>

                <!-- Case 2: Display Reward (Already drawn) -->
                <div id="reward-display-badge" class="hidden w-full bg-gradient-to-r from-purple-100 to-pink-100 border-2 border-purple-300 rounded-xl p-4 text-center shadow-inner mb-4">
                    <p class="text-sm text-purple-600 font-semibold mb-1">ของรางวัลของคุณคือ</p>
                    <p id="reward-name-text" class="text-xl font-bold text-purple-800">...</p>
                </div>

                <!-- Case 3: Claim Button (Added for Summary Page) -->
                <div id="claim-section-summary" class="hidden">
                    <button id="btn-claim-reward-summary" onclick="window.app.claimReward('summary')" class="w-full bg-green-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:bg-green-700 transition transform hover:scale-105 mb-2">
                        <i data-lucide="check-square" class="inline-block w-5 h-5 mr-1 mb-1"></i> ยืนยันการรับรางวัลแล้ว
                    </button>
                    <p id="text-claim-time-summary" class="text-xs text-gray-600 font-sm bg-green-50 p-3 rounded-lg border border-green-200 hidden">
                        <i data-lucide="clock" class="inline-block w-4 h-4 mr-1"></i> รับรางวัลเมื่อ: <span id="claim-time-val-summary"></span>
                    </p>
                </div>
            </div>

            <!-- Back to Registration Button -->
            <button onclick="window.app.resetForm()" class="mt-6 w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition flex items-center justify-center gap-2">
                <i data-lucide="log-out" width="18"></i> กลับสู่หน้าลงทะเบียน
            </button>
        </div>

        <!-- Lucky Draw Screen (Spinning & Result) -->
        <div id="screen-luckydraw" class="hidden bg-white rounded-2xl shadow-xl p-6 w-full text-center animate-fade-in relative z-20 min-h-[400px] flex flex-col items-center justify-center">
            
            <!-- State 1: Validating -->
            <div id="draw-state-validating" class="w-full">
                <div class="w-24 h-24 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse">
                    <i data-lucide="scan-face" class="text-blue-500 w-12 h-12"></i>
                </div>
                <h2 class="text-xl font-bold text-gray-800 mb-2">กำลังตรวจสอบข้อมูลพนักงาน...</h2>
                <p class="text-gray-500 text-sm">กรุณารอสักครู่ ระบบกำลังยืนยันสิทธิ์ของท่าน</p>
                <div class="mt-6 w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-200 overflow-hidden">
                    <div class="bg-blue-600 h-2.5 rounded-full" style="width: 0%; transition: width 2s ease-in-out;" id="validate-progress"></div>
                </div>
            </div>

            <!-- State 2: Spinning -->
            <div id="draw-state-spinning" class="hidden w-full">
                <div class="relative w-32 h-32 mx-auto mb-6">
                    <div class="absolute inset-0 border-4 border-t-purple-500 border-gray-200 rounded-full animate-spin"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i data-lucide="gift" class="text-purple-500 w-12 h-12"></i>
                    </div>
                </div>
                <h2 class="text-2xl font-bold text-purple-700 mb-2" id="spin-text">กำลังสุ่มรางวัล...</h2>
                <div class="h-8 overflow-hidden relative mt-2">
                    <div id="prize-ticker" class="text-gray-400 text-lg transition-all duration-100">...</div>
                </div>
            </div>

            <!-- State 3: Result -->
            <div id="draw-state-result" class="hidden w-full">
                <div class="mb-2 text-yellow-500">
                    <i data-lucide="crown" width="60" height="60" class="mx-auto"></i>
                </div>
                <h2 class="text-lg font-bold text-gray-500 mb-1">ยินดีด้วย! ท่านได้รับ</h2>
                <div class="bg-gradient-to-r from-yellow-100 to-orange-100 border-2 border-yellow-300 p-6 rounded-2xl mb-6 shadow-inner relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-2 opacity-20"><i data-lucide="sparkles" width="40"></i></div>
                    <h1 id="prize-result-name" class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-600 to-red-600 drop-shadow-sm mb-4">
                        รอสักครู่...
                    </h1>
                </div>
                
                <!-- Claim Reward Section -->
                <div id="claim-section" class="mb-6">
                    <button id="btn-claim-reward" onclick="window.app.claimReward('result')" class="bg-green-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:bg-green-700 transition transform hover:scale-105 hidden">
                        <i data-lucide="check-square" class="inline-block w-5 h-5 mr-1 mb-1"></i> ยืนยันการรับรางวัลแล้ว
                    </button>
                    <p id="text-claim-time" class="text-green-700 font-medium bg-green-50 p-3 rounded-lg border border-green-200 hidden">
                        <i data-lucide="clock" class="inline-block w-4 h-4 mr-1"></i> รับรางวัลเมื่อ: <span id="claim-time-val" class="font-bold"></span>
                    </p>
                </div>

                <p class="text-xs text-gray-400 mb-6">กรุณาให้เจ้าน้าที่ทำการกดปุ่มยืนยันการรับรางวัล</p>

                <button onclick="window.app.backToSummary()" class="w-full bg-gray-800 text-white py-3 rounded-xl font-semibold hover:bg-gray-900 transition">
                    กลับสู่หน้าหลัก (Check-out)
                </button>
            </div>

        </div>

        <!-- Error Screen -->
        <div id="screen-error-device" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="alert-triangle" class="text-red-600 w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold text-red-700 mb-2">เกิดข้อผิดพลาด</h2>
            <p id="error-msg-text" class="text-gray-600 mb-6 text-sm">ไม่สามารถดำเนินการได้</p>
            <button onclick="window.location.reload()" class="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition">ปิด</button>
        </div>

        <!-- Not Found Screen -->
        <div id="screen-not-found" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="user-x" class="text-amber-600 w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold text-amber-700 mb-2">ไม่พบข้อมูล</h2>
            <p class="text-gray-600 mb-6 text-sm">กรุณาลงทะเบียนเข้าก่อนทำการลงทะเบียนออก</p>
            <button onclick="window.app.resetForm()" class="w-full bg-amber-500 text-white py-3 rounded-xl font-semibold hover:bg-amber-600 transition">ปิด</button>
        </div>

        <p class="text-center text-gray-400 text-xs mt-8">
            ระบบสุ่มรางวัลสมาชิกสหกรณ์ <br/>
            © 2024 สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด
        </p>
    </main>

    <script type="module">
const _0x26becc=_0x1d94;(function(_0x5dd52c,_0x10f68d){const _0x2c5611=_0x1d94,_0x50d0d5=_0x5dd52c();while(!![]){try{const _0x8a9858=-parseInt(_0x2c5611(0x269))/0x1+-parseInt(_0x2c5611(0x266))/0x2*(parseInt(_0x2c5611(0x24f))/0x3)+-parseInt(_0x2c5611(0x23c))/0x4*(-parseInt(_0x2c5611(0x256))/0x5)+parseInt(_0x2c5611(0x20f))/0x6+-parseInt(_0x2c5611(0x202))/0x7+-parseInt(_0x2c5611(0x21f))/0x8*(parseInt(_0x2c5611(0x244))/0x9)+parseInt(_0x2c5611(0x232))/0xa;if(_0x8a9858===_0x10f68d)break;else _0x50d0d5['push'](_0x50d0d5['shift']());}catch(_0x5c3013){_0x50d0d5['push'](_0x50d0d5['shift']());}}}(_0x3809,0x18ea3));function _0x3809(){const _0x4726c3=['disabled','1:1070273157855:web:5c8120e1df27e233d8676a','50%','userHash','draw-state-result','toLocaleString','1003702DMuVkm','coop_device_identifier','https://ttb-register-default-rtdb.asia-southeast1.firebasedate.app','error-msg-text','subtle','ทองคำ','rewardClaimTime','Save\x20Prize\x20Error:','/public/data/coop_registrations','DEV-','msg-box-recorded','citizenId','ttb-register.firebaseapp.com','1045776kWHVaV','width','bg-purple-600','th-TH','currentDocId','เกิดข้อผิดพลาดในการตรวจสอบข้อมูล','text-white','setItem','รหัสบัตรประชาชนนี้\x20ผูกกับโทรศัพท์เครื่องอื่นแล้ว<br>(ไม่สามารถเปลี่ยนเครื่องได้)','ไม่สามารถบันทึกของรางวัลได้','random','value','forEach','btn-text','load','bg-gray-200','688uicREZ','text-gray-400','shadow-none','screen-luckydraw','push','submit','shadow-purple-200','ttb-register','text-claim-time','slice','reward','cursor-not-allowed','createIcons','exists','เครื่องนี้ถูกผูกบัญชีอื่นแล้ว\x20(ไม่สามารถลงทะเบียนใหม่ได้)','lucide','artifacts/','coop_gift','draw-state-spinning','3093950PfkAub','btn-claim-reward','icon-check-valid','map','deviceId','รางวัลพิเศษ','tmb_coop','toString','classList','reward-display-badge','4TKIBPc','substr','name','length','prizesList','data','draw-state-validating','success-checkout-time','9108EiIxzX','claim-section-summary','summary','innerText','currentReward','border-gray-200','เครื่องใช้ไฟฟ้า','screen-form','add','CheckIN','user','21WYDFmJ','message','btn-loader','default-app-id','btn-start-draw','now','status','169435JENujW','idCard','replace','เกิดข้อผิดพลาด:\x20','บันทึกการรับรางวัลไม่สำเร็จ\x20กรุณาลองใหม่','claim-time-val','checked-out','docs','prize-result-name','addEventListener','screen-error-device','/public/data/','btn-claim-reward-summary','validate-progress','error','hover:bg-purple-700','4172hIOHUy','floor','resetForm','170507qmAJmB','screen-success','style','ยินดีด้วย!\x20ท่านได้รับ','claim-time-val-summary','bg-purple-50/30','app','ttb-register.firebasestorage.app','1070273157855','encode','CheckOUT','remove','ลงทะเบียนสำเร็จ','btn-submit','hidden','toDate','parse','G-9DJLWJ5LQ1','focus','กำลังตรวจสอบ...','getElementById','ท่านเคยได้รับรางวัลแล้ว','ลงทะเบียนออก','from','join','border-purple-500','innerHTML','then'];_0x3809=function(){return _0x4726c3;};return _0x3809();}import{initializeApp}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js';import{getAuth,signInAnonymously,onAuthStateChanged,signInWithCustomToken}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js';import{getFirestore,collection,updateDoc,doc,serverTimestamp,query,where,getDocs,getDoc,addDoc,onSnapshot}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js';const TARGET_COLLECTION_NAME=_0x26becc(0x238),PRIZES_COLLECTION_NAME=_0x26becc(0x230),isSandboxEnv=typeof __firebase_config!=='undefined';let firebaseConfig,finalCollectionPath,prizesCollectionPath;if(isSandboxEnv){firebaseConfig=JSON[_0x26becc(0x1f0)](__firebase_config);const appId=typeof __app_id!=='undefined'?__app_id:_0x26becc(0x252);finalCollectionPath=_0x26becc(0x22f)+appId+_0x26becc(0x20a),prizesCollectionPath=_0x26becc(0x22f)+appId+_0x26becc(0x261)+PRIZES_COLLECTION_NAME;}else firebaseConfig={'apiKey':'AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','authDomain':_0x26becc(0x20e),'databaseURL':_0x26becc(0x204),'projectId':_0x26becc(0x226),'storageBucket':_0x26becc(0x270),'messagingSenderId':_0x26becc(0x1e8),'appId':_0x26becc(0x1fd),'measurementId':_0x26becc(0x1f1)},finalCollectionPath=TARGET_COLLECTION_NAME,prizesCollectionPath=PRIZES_COLLECTION_NAME;const state={'user':null,'idCard':'','currentDocId':null,'userHash':null,'currentReward':null,'prizesList':[]},app=initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app);async function sha256(_0x4a0507){const _0x26b1ab=_0x26becc,_0x117ffe=new TextEncoder()[_0x26b1ab(0x1e9)](_0x4a0507),_0x39ec10=await crypto[_0x26b1ab(0x206)]['digest']('SHA-256',_0x117ffe),_0x398075=Array[_0x26b1ab(0x1f7)](new Uint8Array(_0x39ec10));return _0x398075['map'](_0x13ed66=>_0x13ed66[_0x26b1ab(0x239)](0x10)['padStart'](0x2,'0'))[_0x26b1ab(0x1f8)]('');}function getDeviceId(){const _0x392e32=_0x26becc,_0x4d66a5=_0x392e32(0x203);let _0xc0b165=localStorage['getItem'](_0x4d66a5);return!_0xc0b165&&(_0xc0b165=_0x392e32(0x20b)+Date[_0x392e32(0x254)]()[_0x392e32(0x239)](0x24)+Math[_0x392e32(0x219)]()[_0x392e32(0x239)](0x24)[_0x392e32(0x23d)](0x2,0x9),localStorage[_0x392e32(0x216)](_0x4d66a5,_0xc0b165)),_0xc0b165;}window['app']={'resetForm':()=>{const _0x371fb0=_0x26becc;['screen-success','screen-error-device','screen-not-found',_0x371fb0(0x222)][_0x371fb0(0x21b)](_0x140b0b=>document['getElementById'](_0x140b0b)['classList'][_0x371fb0(0x24c)]('hidden')),document['getElementById']('screen-form')[_0x371fb0(0x23a)][_0x371fb0(0x1eb)](_0x371fb0(0x1ee)),document[_0x371fb0(0x1f4)](_0x371fb0(0x257))[_0x371fb0(0x21a)]='',document['getElementById'](_0x371fb0(0x234))[_0x371fb0(0x23a)][_0x371fb0(0x24c)]('hidden'),document[_0x371fb0(0x1f4)](_0x371fb0(0x245))[_0x371fb0(0x23a)][_0x371fb0(0x24c)](_0x371fb0(0x1ee)),document[_0x371fb0(0x1f4)](_0x371fb0(0x20c))[_0x371fb0(0x23a)][_0x371fb0(0x1eb)](_0x371fb0(0x1ee));const _0x1ff7a0=document[_0x371fb0(0x1f4)](_0x371fb0(0x1ed));_0x1ff7a0[_0x371fb0(0x1fc)]=!![],_0x1ff7a0['classList'][_0x371fb0(0x24c)](_0x371fb0(0x21e),_0x371fb0(0x220)),_0x1ff7a0['classList'][_0x371fb0(0x1eb)](_0x371fb0(0x211),'text-white'),document[_0x371fb0(0x1f4)](_0x371fb0(0x21c))['innerText']=_0x371fb0(0x1f6),document[_0x371fb0(0x1f4)](_0x371fb0(0x251))[_0x371fb0(0x23a)][_0x371fb0(0x24c)](_0x371fb0(0x1ee)),state[_0x371fb0(0x257)]='',state[_0x371fb0(0x213)]=null,state[_0x371fb0(0x248)]=null,document[_0x371fb0(0x1f4)](_0x371fb0(0x257))['focus']();},'goToLuckyDraw':async()=>{const _0x349848=_0x26becc;document['getElementById']('screen-success')[_0x349848(0x23a)]['add']('hidden'),document[_0x349848(0x1f4)](_0x349848(0x222))['classList'][_0x349848(0x1eb)](_0x349848(0x1ee)),document['getElementById'](_0x349848(0x242))[_0x349848(0x23a)][_0x349848(0x1eb)](_0x349848(0x1ee)),document[_0x349848(0x1f4)](_0x349848(0x231))['classList'][_0x349848(0x24c)]('hidden'),document['getElementById'](_0x349848(0x200))[_0x349848(0x23a)][_0x349848(0x24c)](_0x349848(0x1ee)),setTimeout(()=>{const _0x58663e=_0x349848;document['getElementById'](_0x58663e(0x263))['style'][_0x58663e(0x210)]=_0x58663e(0x1fe);},0x64),setTimeout(()=>{const _0x2bfecc=_0x349848;document[_0x2bfecc(0x1f4)](_0x2bfecc(0x263))[_0x2bfecc(0x26b)]['width']='100%';},0x5dc),setTimeout(async()=>{const _0x8173d=_0x349848;if(state['currentDocId'])try{const _0x2e135a=doc(db,finalCollectionPath,state['currentDocId']),_0x579206=await getDoc(_0x2e135a),_0x562d4d=_0x579206[_0x8173d(0x241)]();_0x579206[_0x8173d(0x22c)]()&&_0x562d4d['reward']?showResult(_0x562d4d[_0x8173d(0x229)],!![],_0x562d4d[_0x8173d(0x208)]):startSpinning();}catch(_0xb1e563){console[_0x8173d(0x264)](_0xb1e563),alert(_0x8173d(0x214)),window['app'][_0x8173d(0x268)]();}else alert('ไม่พบข้อมูลผู้ใช้\x20กรุณาลงทะเบียนใหม่'),window[_0x8173d(0x26f)]['resetForm']();},0x7d0);},'backToSummary':()=>{const _0x1c47f4=_0x26becc;document['getElementById'](_0x1c47f4(0x222))['classList']['add'](_0x1c47f4(0x1ee)),document[_0x1c47f4(0x1f4)](_0x1c47f4(0x26a))[_0x1c47f4(0x23a)]['remove']('hidden'),state['currentReward']&&(state[_0x1c47f4(0x213)]&&getDoc(doc(db,finalCollectionPath,state[_0x1c47f4(0x213)]))[_0x1c47f4(0x1fb)](_0x4684de=>{const _0x1bda71=_0x1c47f4;_0x4684de[_0x1bda71(0x22c)]()&&updateSuccessScreen(_0x4684de[_0x1bda71(0x241)]()['reward'],_0x4684de[_0x1bda71(0x241)]()['rewardClaimTime']);}));},'claimReward':async _0xc9da3b=>{const _0x142475=_0x26becc;if(!state['currentDocId'])return;const _0x3d869d=_0xc9da3b===_0x142475(0x246),_0x124c00=_0x3d869d?_0x142475(0x262):'btn-claim-reward',_0x59802e=_0x3d869d?'text-claim-time-summary':_0x142475(0x227),_0x44ed5b=_0x3d869d?_0x142475(0x26d):_0x142475(0x25b),_0x238902=document['getElementById'](_0x124c00),_0x1d2f99=_0x238902[_0x142475(0x1fa)];_0x238902[_0x142475(0x1fc)]=!![],_0x238902[_0x142475(0x247)]='กำลังบันทึก...';try{await updateDoc(doc(db,finalCollectionPath,state[_0x142475(0x213)]),{'rewardClaimTime':serverTimestamp()});const _0x56f6de=new Date(),_0x3744f1=_0x56f6de['toLocaleString'](_0x142475(0x212));_0x238902[_0x142475(0x23a)][_0x142475(0x24c)](_0x142475(0x1ee)),document['getElementById'](_0x59802e)[_0x142475(0x23a)][_0x142475(0x1eb)]('hidden'),document[_0x142475(0x1f4)](_0x44ed5b)[_0x142475(0x247)]=_0x3744f1,confetti({'particleCount':0x64,'spread':0x3c,'origin':{'y':0.7}});}catch(_0x4dd634){console[_0x142475(0x264)](_0x4dd634),alert(_0x142475(0x25a)),_0x238902[_0x142475(0x1fc)]=![],_0x238902[_0x142475(0x1fa)]=_0x1d2f99;}}};function updateSuccessScreen(_0x467110,_0x95666c){const _0x388d38=_0x26becc;document[_0x388d38(0x1f4)](_0x388d38(0x253))[_0x388d38(0x23a)][_0x388d38(0x24c)](_0x388d38(0x1ee));const _0x5e6dd5=document[_0x388d38(0x1f4)](_0x388d38(0x23b));_0x5e6dd5['classList']['remove'](_0x388d38(0x1ee)),document[_0x388d38(0x1f4)]('reward-name-text')['innerText']=_0x467110,document[_0x388d38(0x1f4)](_0x388d38(0x20c))['classList'][_0x388d38(0x24c)](_0x388d38(0x1ee));const _0x118681=document[_0x388d38(0x1f4)](_0x388d38(0x245)),_0x412842=document[_0x388d38(0x1f4)](_0x388d38(0x262)),_0x2447ea=document[_0x388d38(0x1f4)]('text-claim-time-summary'),_0x21ab60=document[_0x388d38(0x1f4)]('claim-time-val-summary');_0x118681['classList'][_0x388d38(0x1eb)](_0x388d38(0x1ee));if(_0x95666c){_0x412842[_0x388d38(0x23a)][_0x388d38(0x24c)](_0x388d38(0x1ee)),_0x2447ea['classList']['remove']('hidden');const _0x3cdce9=_0x95666c['toDate']?_0x95666c['toDate']():new Date(_0x95666c);_0x21ab60[_0x388d38(0x247)]=_0x3cdce9[_0x388d38(0x201)]('th-TH');}else _0x412842[_0x388d38(0x23a)][_0x388d38(0x1eb)](_0x388d38(0x1ee)),_0x2447ea[_0x388d38(0x23a)][_0x388d38(0x24c)](_0x388d38(0x1ee));}async function fetchPrizes(){const _0x4d0c3c=query(collection(db,prizesCollectionPath));onSnapshot(_0x4d0c3c,_0x3c7f08=>{const _0x51ae51=_0x1d94,_0x5b57c9=[];_0x3c7f08[_0x51ae51(0x21b)](_0x3286e9=>_0x5b57c9[_0x51ae51(0x223)](_0x3286e9[_0x51ae51(0x241)]())),state[_0x51ae51(0x240)]=_0x5b57c9;});}function startSpinning(){const _0x52b686=_0x26becc;document['getElementById'](_0x52b686(0x242))[_0x52b686(0x23a)][_0x52b686(0x24c)]('hidden'),document[_0x52b686(0x1f4)]('draw-state-spinning')[_0x52b686(0x23a)][_0x52b686(0x1eb)](_0x52b686(0x1ee));const _0x67dc9=[_0x52b686(0x237),_0x52b686(0x207),_0x52b686(0x24a)],_0x4b4a8c=state[_0x52b686(0x240)][_0x52b686(0x23f)]>0x0?state[_0x52b686(0x240)]['map'](_0x389d9a=>_0x389d9a[_0x52b686(0x23e)]):_0x67dc9,_0x377cee=document[_0x52b686(0x1f4)]('prize-ticker');let _0x20ff6a=0x0;const _0x9abc0b=setInterval(()=>{const _0x306868=_0x52b686;_0x377cee[_0x306868(0x247)]=_0x4b4a8c[Math[_0x306868(0x267)](Math[_0x306868(0x219)]()*_0x4b4a8c[_0x306868(0x23f)])],_0x20ff6a++,_0x20ff6a>0x14&&(clearInterval(_0x9abc0b),finalizePrize());},0x64);}async function finalizePrize(){const _0x34a378=_0x26becc,_0x5846cc=state['prizesList']['length']>0x0?state[_0x34a378(0x240)][_0x34a378(0x235)](_0xdb3f5f=>_0xdb3f5f[_0x34a378(0x23e)]):[_0x34a378(0x237)],_0x1fc4ee=_0x5846cc[Math[_0x34a378(0x267)](Math[_0x34a378(0x219)]()*_0x5846cc[_0x34a378(0x23f)])];try{state['currentDocId']&&(await updateDoc(doc(db,finalCollectionPath,state[_0x34a378(0x213)]),{'reward':_0x1fc4ee,'rewardTime':serverTimestamp()}),showResult(_0x1fc4ee,![],null));}catch(_0x219656){console[_0x34a378(0x264)](_0x34a378(0x209),_0x219656),alert(_0x34a378(0x218));}}function showResult(_0x16eb1f,_0x131423,_0x312303){const _0x58e708=_0x26becc;state['currentReward']=_0x16eb1f,document[_0x58e708(0x1f4)](_0x58e708(0x231))[_0x58e708(0x23a)]['add'](_0x58e708(0x1ee)),document[_0x58e708(0x1f4)](_0x58e708(0x242))[_0x58e708(0x23a)][_0x58e708(0x24c)](_0x58e708(0x1ee)),document[_0x58e708(0x1f4)](_0x58e708(0x200))[_0x58e708(0x23a)]['remove'](_0x58e708(0x1ee));const _0x50db10=_0x131423?_0x58e708(0x1f5):_0x58e708(0x26c);document['querySelector']('#draw-state-result\x20h2')[_0x58e708(0x247)]=_0x50db10,document[_0x58e708(0x1f4)](_0x58e708(0x25e))[_0x58e708(0x247)]=_0x16eb1f;const _0xe3629=document[_0x58e708(0x1f4)](_0x58e708(0x233)),_0x5b04c0=document[_0x58e708(0x1f4)](_0x58e708(0x227)),_0x1486f6=document[_0x58e708(0x1f4)](_0x58e708(0x25b));if(_0x312303){_0xe3629['classList'][_0x58e708(0x24c)](_0x58e708(0x1ee)),_0x5b04c0[_0x58e708(0x23a)][_0x58e708(0x1eb)](_0x58e708(0x1ee));const _0x2a3207=_0x312303[_0x58e708(0x1ef)]?_0x312303[_0x58e708(0x1ef)]():new Date(_0x312303);_0x1486f6[_0x58e708(0x247)]=_0x2a3207[_0x58e708(0x201)](_0x58e708(0x212));}else _0xe3629['classList'][_0x58e708(0x1eb)]('hidden'),_0xe3629[_0x58e708(0x1fc)]=![],_0x5b04c0[_0x58e708(0x23a)][_0x58e708(0x24c)]('hidden');!_0x131423&&confetti({'particleCount':0x96,'spread':0x46,'origin':{'y':0.6}});}async function submitForm(_0x1bf3fb){const _0x164cf=_0x26becc;_0x1bf3fb['preventDefault']();if(!state['user'])return;const _0x3082f4=document[_0x164cf(0x1f4)](_0x164cf(0x1ed)),_0x50c37d=document['getElementById'](_0x164cf(0x21c)),_0x21c34d=document[_0x164cf(0x1f4)]('btn-loader');_0x3082f4['disabled']=!![],_0x50c37d['innerText']=_0x164cf(0x1f3),_0x21c34d[_0x164cf(0x23a)]['remove'](_0x164cf(0x1ee));try{const _0x337a41=getDeviceId(),_0x4c73e5=state[_0x164cf(0x257)][_0x164cf(0x258)](/-/g,''),_0x2d1021=await sha256(_0x4c73e5);state[_0x164cf(0x1ff)]=_0x2d1021;const _0x4f7f50=query(collection(db,finalCollectionPath),where(_0x164cf(0x20d),'==',_0x2d1021)),_0x231edf=await getDocs(_0x4f7f50);if(!_0x231edf['empty']){const _0xccf135=_0x231edf[_0x164cf(0x25d)][0x0],_0x1fec36=_0xccf135[_0x164cf(0x241)]();if(_0x1fec36['deviceId']&&_0x1fec36['deviceId']!==_0x337a41){document[_0x164cf(0x1f4)](_0x164cf(0x205))[_0x164cf(0x1fa)]=_0x164cf(0x217),document['getElementById'](_0x164cf(0x24b))[_0x164cf(0x23a)][_0x164cf(0x24c)](_0x164cf(0x1ee)),document[_0x164cf(0x1f4)](_0x164cf(0x260))[_0x164cf(0x23a)][_0x164cf(0x1eb)](_0x164cf(0x1ee));return;}state[_0x164cf(0x213)]=_0xccf135['id'];let _0x1aadfd='-';if(_0x1fec36['CheckIN']){const _0x143617=_0x1fec36['CheckIN'][_0x164cf(0x1ef)]?_0x1fec36[_0x164cf(0x24d)]['toDate']():new Date(_0x1fec36[_0x164cf(0x24d)]);_0x1aadfd=_0x143617['toLocaleString'](_0x164cf(0x212));}let _0x4b5fc0='';const _0x3474b7=new Date();_0x4b5fc0=_0x3474b7[_0x164cf(0x201)](_0x164cf(0x212));const _0x10bcae={};let _0x32ff20=![];!_0x1fec36[_0x164cf(0x236)]&&(_0x10bcae[_0x164cf(0x236)]=_0x337a41,_0x32ff20=!![]);if(!_0x1fec36[_0x164cf(0x1ea)])_0x10bcae[_0x164cf(0x1ea)]=serverTimestamp(),_0x1fec36[_0x164cf(0x24d)]?_0x10bcae[_0x164cf(0x255)]=_0x164cf(0x1ec):_0x10bcae['status']=_0x164cf(0x25c),_0x32ff20=!![];else{const _0x459af1=_0x1fec36[_0x164cf(0x1ea)]['toDate']?_0x1fec36['CheckOUT'][_0x164cf(0x1ef)]():new Date(_0x1fec36['CheckOUT']);_0x4b5fc0=_0x459af1[_0x164cf(0x201)](_0x164cf(0x212));}_0x32ff20&&await updateDoc(doc(db,finalCollectionPath,_0xccf135['id']),_0x10bcae),document[_0x164cf(0x1f4)]('success-checkin-time')[_0x164cf(0x247)]=_0x1aadfd,document[_0x164cf(0x1f4)](_0x164cf(0x243))['innerText']=_0x4b5fc0,document['getElementById'](_0x164cf(0x24b))['classList'][_0x164cf(0x24c)](_0x164cf(0x1ee)),document[_0x164cf(0x1f4)]('screen-success')[_0x164cf(0x23a)][_0x164cf(0x1eb)](_0x164cf(0x1ee)),_0x1fec36['reward']?(state['currentReward']=_0x1fec36['reward'],updateSuccessScreen(_0x1fec36[_0x164cf(0x229)],_0x1fec36[_0x164cf(0x208)])):(state[_0x164cf(0x248)]=null,document[_0x164cf(0x1f4)](_0x164cf(0x253))[_0x164cf(0x23a)]['remove'](_0x164cf(0x1ee)),document[_0x164cf(0x1f4)](_0x164cf(0x23b))[_0x164cf(0x23a)][_0x164cf(0x24c)]('hidden'),document[_0x164cf(0x1f4)]('claim-section-summary')[_0x164cf(0x23a)][_0x164cf(0x24c)]('hidden'));}else{const _0x9239fe=query(collection(db,finalCollectionPath),where(_0x164cf(0x236),'==',_0x337a41)),_0x36f03=await getDocs(_0x9239fe);if(!_0x36f03['empty'])document[_0x164cf(0x1f4)](_0x164cf(0x205))[_0x164cf(0x247)]=_0x164cf(0x22d),document[_0x164cf(0x1f4)]('screen-form')[_0x164cf(0x23a)][_0x164cf(0x24c)]('hidden'),document[_0x164cf(0x1f4)](_0x164cf(0x260))[_0x164cf(0x23a)][_0x164cf(0x1eb)](_0x164cf(0x1ee));else{const _0x2b8189=await addDoc(collection(db,finalCollectionPath),{'citizenId':_0x2d1021,'deviceId':_0x337a41,'CheckIN':serverTimestamp(),'CheckOUT':serverTimestamp(),'status':_0x164cf(0x1ec)});state['currentDocId']=_0x2b8189['id'];const _0x963803=new Date(),_0x55e5e9=_0x963803[_0x164cf(0x201)](_0x164cf(0x212));updateSuccessUI(_0x55e5e9,_0x55e5e9,null,null,!![]);}}}catch(_0x427726){console[_0x164cf(0x264)](_0x427726),alert(_0x164cf(0x259)+_0x427726[_0x164cf(0x250)]);}finally{_0x3082f4['disabled']=![],_0x50c37d[_0x164cf(0x247)]=_0x164cf(0x1f6),_0x21c34d['classList'][_0x164cf(0x24c)]('hidden'),validateForm();}}function handleIdInput(_0x3f4b6b){const _0x12e871=_0x26becc;let _0x3355df=_0x3f4b6b['target'][_0x12e871(0x21a)][_0x12e871(0x258)](/[^0-9]/g,'');if(_0x3355df[_0x12e871(0x23f)]>0xd)_0x3355df=_0x3355df[_0x12e871(0x228)](0x0,0xd);let _0x90077c=_0x3355df;if(_0x3355df[_0x12e871(0x23f)]>0x1)_0x90077c=_0x3355df[_0x12e871(0x228)](0x0,0x1)+'-'+_0x3355df[_0x12e871(0x228)](0x1);if(_0x3355df['length']>0x5)_0x90077c=_0x90077c[_0x12e871(0x228)](0x0,0x6)+'-'+_0x90077c[_0x12e871(0x228)](0x6);if(_0x3355df[_0x12e871(0x23f)]>0xa)_0x90077c=_0x90077c[_0x12e871(0x228)](0x0,0xc)+'-'+_0x90077c[_0x12e871(0x228)](0xc);if(_0x3355df[_0x12e871(0x23f)]>0xc)_0x90077c=_0x90077c['slice'](0x0,0xf)+'-'+_0x90077c[_0x12e871(0x228)](0xf);document[_0x12e871(0x1f4)](_0x12e871(0x257))['value']=_0x90077c,state[_0x12e871(0x257)]=_0x90077c;const _0x3f9fbc=document['getElementById'](_0x12e871(0x234)),_0x3c319b=document[_0x12e871(0x1f4)](_0x12e871(0x257));_0x3355df[_0x12e871(0x23f)]===0xd?(_0x3c319b[_0x12e871(0x23a)]['add'](_0x12e871(0x1f9),_0x12e871(0x26e)),_0x3c319b[_0x12e871(0x23a)][_0x12e871(0x1eb)](_0x12e871(0x249)),_0x3f9fbc['classList'][_0x12e871(0x1eb)]('hidden')):(_0x3c319b['classList'][_0x12e871(0x1eb)]('border-purple-500','bg-purple-50/30'),_0x3c319b[_0x12e871(0x23a)][_0x12e871(0x24c)](_0x12e871(0x249)),_0x3f9fbc[_0x12e871(0x23a)][_0x12e871(0x24c)](_0x12e871(0x1ee))),validateForm();}function validateForm(){const _0x3d29f9=_0x26becc,_0x4ea910=state['idCard'][_0x3d29f9(0x258)](/[^0-9]/g,'')[_0x3d29f9(0x23f)]===0xd,_0x450da4=document[_0x3d29f9(0x1f4)]('btn-submit');_0x4ea910?(_0x450da4['disabled']=![],_0x450da4[_0x3d29f9(0x23a)][_0x3d29f9(0x24c)]('bg-purple-600',_0x3d29f9(0x215),'hover:bg-purple-700',_0x3d29f9(0x225)),_0x450da4['classList'][_0x3d29f9(0x1eb)](_0x3d29f9(0x21e),'text-gray-400','cursor-not-allowed',_0x3d29f9(0x221))):(_0x450da4['disabled']=!![],_0x450da4['classList']['remove'](_0x3d29f9(0x211),_0x3d29f9(0x215),_0x3d29f9(0x265),_0x3d29f9(0x225)),_0x450da4[_0x3d29f9(0x23a)][_0x3d29f9(0x24c)](_0x3d29f9(0x21e),_0x3d29f9(0x220),_0x3d29f9(0x22a),_0x3d29f9(0x221)));}document['getElementById']('registration-form')[_0x26becc(0x25f)](_0x26becc(0x224),submitForm),document['getElementById'](_0x26becc(0x257))[_0x26becc(0x25f)]('input',handleIdInput),window[_0x26becc(0x25f)](_0x26becc(0x21d),()=>document[_0x26becc(0x1f4)](_0x26becc(0x257))[_0x26becc(0x1f2)]());async function initAuth(){typeof __initial_auth_token!=='undefined'&&__initial_auth_token?await signInWithCustomToken(auth,__initial_auth_token):await signInAnonymously(auth),fetchPrizes();}onAuthStateChanged(auth,_0x1cdc8e=>state[_0x26becc(0x24e)]=_0x1cdc8e),initAuth();function _0x1d94(_0x5af120,_0x5b5f66){_0x5af120=_0x5af120-0x1e8;const _0x3809ea=_0x3809();let _0x1d94b1=_0x3809ea[_0x5af120];return _0x1d94b1;}if(window[_0x26becc(0x22e)])lucide[_0x26becc(0x22b)]();

    </script>
</body>
</html>