<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ลงทะเบียนออกและลุ้นรางวัล - สหกรณ์ออมทรัพย์ฯ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Font (Sarabun) -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Confetti for Lucky Draw -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .hidden { display: none !important; }
        /* Custom Animations */
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes bounce-slow {
            0%, 100% { transform: translateY(-5%); }
            50% { transform: translateY(5%); }
        }
        .animate-bounce-slow { animation: bounce-slow 2s infinite; }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-10">

    <!-- Header Section -->
    <div class="bg-gradient-to-r from-purple-600 to-indigo-700 text-white p-6 rounded-b-[2.5rem] shadow-lg mb-8 relative overflow-hidden">
        <div class="absolute top-0 right-0 opacity-10 transform translate-x-10 -translate-y-10">
            <i data-lucide="gift" width="150" height="150"></i>
        </div>
        
        <div class="relative z-10 flex flex-col items-center">
            <div class="bg-white/20 p-3 rounded-full mb-3 backdrop-blur-sm">
                <i data-lucide="party-popper" width="32" height="32" class="text-white"></i>
            </div>
            <h1 class="text-xl font-bold text-center">กิจกรรมลุ้นรางวัล</h1>
            <p class="text-purple-100 text-sm mt-1">สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด</p>
        </div>
    </div>

    <!-- Main Content Container -->
    <main class="px-2 sm:px-4 max-w-lg mx-auto -mt-10">
        
        <!-- Form Screen (Check-out first) -->
        <div id="screen-form" class="bg-white rounded-2xl shadow-xl p-6 border border-slate-100 relative z-20">
            <form id="registration-form" class="space-y-6 pt-2">
                <center>
                    <h2 class="text-lg font-bold text-gray-700 mb-4">ลงทะเบียนออกเพื่อลุ้นรางวัล</h2>
                    <div>
                        <label for="idCard" class="block text-sm font-semibold text-gray-700 mb-2">
                            เลขบัตรประจำตัวประชาชน
                        </label>
                        <div class="relative">
                            <input
                                type="text"
                                id="idCard"
                                placeholder="x-xxxx-xxxxx-xx-x"
                                class="w-full text-xl font-mono tracking-wide p-4 rounded-xl border-2 border-gray-200 bg-white focus:border-purple-400 focus:ring-4 focus:ring-purple-100 outline-none transition-all text-center"
                                inputmode="numeric"
                                maxlength="17"
                            />
                            <i id="icon-check-valid" data-lucide="check-circle" class="hidden absolute right-4 top-1/2 transform -translate-y-1/2 text-green-500 w-6 h-6 animate-fade-in"></i>
                        </div>
                        <p class="text-xs text-gray-400 mt-2 ml-1">กรุณากรอกตัวเลข 13 หลักให้ครบถ้วน</p>
                    </div>

                    <div class="p-3 bg-purple-50 text-purple-800 rounded-lg text-xs flex gap-2 items-start" style="margin-top:25px;">
                        <i data-lucide="shield-alert" class="w-4 h-4 shrink-0 mt-0.5"></i>
                        <span>ระบบจำกัดสิทธิ์ 1 เครื่อง / 1 ท่าน หากลงทะเบียนแล้วจะไม่สามารถเปลี่ยนเครื่องได้</span>
                    </div>
                </center>

                <button
                    type="submit"
                    id="btn-submit"
                    disabled
                    class="w-full py-3 rounded-lg font-semibold text-base shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2 bg-gray-200 text-gray-400 cursor-not-allowed shadow-none"
                >
                    <span id="btn-text">ลงทะเบียนออก</span>
                    <i id="btn-loader" data-lucide="loader-2" class="hidden animate-spin"></i>
                </button>
            </form>
        </div>

        <!-- Success Screen (Check-out Done & Reward Summary) -->
        <div id="screen-success" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i data-lucide="check-circle" class="text-green-600 w-10 h-10"></i>
            </div>
            
            <!-- Added Name Display -->
            <h3 id="success-user-name" class="text-lg font-bold text-blue-600 mb-1 hidden"></h3>
            <h2 id="success-title" class="text-xl font-bold text-gray-800 mb-4">ลงทะเบียนออกสำเร็จ</h2>
            
            <!-- Time Grid -->
            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="bg-blue-50 p-3 rounded-xl border border-blue-100 flex flex-col items-center justify-center">
                    <p class="text-xs font-bold text-blue-800 uppercase mb-1">ลงทะเบียนเข้า</p>
                    <p id="success-checkin-time" class="text-blue-600 font-mono text-sm font-semibold">--:--</p>
                </div>
                <div class="bg-orange-50 p-3 rounded-xl border border-orange-100 flex flex-col items-center justify-center">
                    <p class="text-xs font-bold text-orange-800 uppercase mb-1">ลงทะเบียนออก</p>
                    <p id="success-checkout-time" class="text-orange-600 font-mono text-sm font-semibold">--:--</p>
                </div>
            </div>
            
            <!-- Message Box (Will be hidden when reward exists) -->
            <div id="msg-box-recorded" class="bg-green-50 border border-green-100 rounded-xl p-5 mb-6 text-left shadow-sm">
                <h3 id="success-msg-header" class="font-bold text-green-900 mb-2 text-lg flex items-center gap-2">
                    <i data-lucide="calendar-check" width="20"></i> บันทึกเวลาเรียบร้อย
                </h3>
                <p id="success-msg-body" class="text-sm text-gray-700">
                    ท่านได้ลงทะเบียนออกและมีสิทธิ์ลุ้นรับรางวัลพิเศษจำนวน 50 รางวัล และขอให้ท่านเดินทางกลับโดยสวัสดิภาพ
                </p>
            </div>
            
            <!-- Lucky Draw Action Area -->
            <div id="lucky-draw-action-container">
                <!-- Case 1: Button for new draw -->
                <button id="btn-start-draw" onclick="window.app.goToLuckyDraw()" class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-white py-4 rounded-xl font-bold shadow-lg shadow-orange-200 hover:shadow-orange-300 transform hover:-translate-y-1 transition-all flex items-center justify-center gap-2 text-lg animate-bounce-slow">
                    <i data-lucide="gift" width="24"></i> กดเพื่อสุ่มของรางวัล
                </button>

                <!-- Case 2: Display Reward (Already drawn) -->
                <div id="reward-display-badge" class="hidden w-full bg-gradient-to-r from-purple-100 to-pink-100 border-2 border-purple-300 rounded-xl p-4 text-center shadow-inner mb-4">
                    <p class="text-sm text-purple-600 font-semibold mb-1">ของรางวัลของคุณคือ</p>
                    <p id="reward-name-text" class="text-xl font-bold text-purple-800">...</p>
                </div>

                <!-- Case 3: Claim Button (Added for Summary Page) -->
                <div id="claim-section-summary" class="hidden">
                    <button id="btn-claim-reward-summary" onclick="window.app.claimReward('summary')" class="w-full bg-green-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:bg-green-700 transition transform hover:scale-105 mb-2">
                        <i data-lucide="check-square" class="inline-block w-5 h-5 mr-1 mb-1"></i> ยืนยันการรับรางวัลแล้ว
                    </button>
                    <p id="text-claim-time-summary" class="text-xs text-gray-600 font-sm bg-green-50 p-3 rounded-lg border border-green-200 hidden">
                        <i data-lucide="clock" class="inline-block w-4 h-4 mr-1"></i> รับรางวัลเมื่อ: <span id="claim-time-val-summary"></span>
                    </p>
                </div>
            </div>

            <!-- Back to Registration Button -->
            <button onclick="window.app.resetForm()" class="mt-6 w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition flex items-center justify-center gap-2">
                <i data-lucide="log-out" width="18"></i> กลับสู่หน้าลงทะเบียน
            </button>
        </div>

        <!-- Lucky Draw Screen (Spinning & Result) -->
        <div id="screen-luckydraw" class="hidden bg-white rounded-2xl shadow-xl p-6 w-full text-center animate-fade-in relative z-20 min-h-[400px] flex flex-col items-center justify-center">
            
            <!-- State 1: Validating -->
            <div id="draw-state-validating" class="w-full">
                <div class="w-24 h-24 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse">
                    <i data-lucide="scan-face" class="text-blue-500 w-12 h-12"></i>
                </div>
                <h2 class="text-xl font-bold text-gray-800 mb-2">กำลังตรวจสอบข้อมูลพนักงาน...</h2>
                <p class="text-gray-500 text-sm">กรุณารอสักครู่ ระบบกำลังยืนยันสิทธิ์ของท่าน</p>
                <div class="mt-6 w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-200 overflow-hidden">
                    <div class="bg-blue-600 h-2.5 rounded-full" style="width: 0%; transition: width 2s ease-in-out;" id="validate-progress"></div>
                </div>
            </div>

            <!-- State 2: Spinning -->
            <div id="draw-state-spinning" class="hidden w-full">
                <div class="relative w-32 h-32 mx-auto mb-6">
                    <div class="absolute inset-0 border-4 border-t-purple-500 border-gray-200 rounded-full animate-spin"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i data-lucide="gift" class="text-purple-500 w-12 h-12"></i>
                    </div>
                </div>
                <h2 class="text-2xl font-bold text-purple-700 mb-2" id="spin-text">กำลังสุ่มรางวัล...</h2>
                <div class="h-8 overflow-hidden relative mt-2">
                    <div id="prize-ticker" class="text-gray-400 text-lg transition-all duration-100">...</div>
                </div>
            </div>

            <!-- State 3: Result -->
            <div id="draw-state-result" class="hidden w-full">
                <div class="mb-2" id="result-icon-container">
                    <i data-lucide="crown" width="60" height="60" class="mx-auto text-yellow-500"></i>
                </div>
                <h2 id="result-title" class="text-lg font-bold text-gray-500 mb-1">ยินดีด้วย! ท่านได้รับ</h2>
                <div id="result-card" class="bg-gradient-to-r from-yellow-100 to-orange-100 border-2 border-yellow-300 p-6 rounded-2xl mb-6 shadow-inner relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-2 opacity-20"><i data-lucide="sparkles" width="40"></i></div>
                    <h1 id="prize-result-name" class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-600 to-red-600 drop-shadow-sm mb-4">
                        รอสักครู่...
                    </h1>
                </div>
                
                <!-- Claim Reward Section -->
                <div id="claim-section" class="mb-6">
                    <button id="btn-claim-reward" onclick="window.app.claimReward('result')" class="bg-green-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:bg-green-700 transition transform hover:scale-105 hidden">
                        <i data-lucide="check-square" class="inline-block w-5 h-5 mr-1 mb-1"></i> ยืนยันการรับรางวัลแล้ว
                    </button>
                    <p id="text-claim-time" class="text-green-700 font-medium bg-green-50 p-3 rounded-lg border border-green-200 hidden">
                        <i data-lucide="clock" class="inline-block w-4 h-4 mr-1"></i> รับรางวัลเมื่อ: <span id="claim-time-val" class="font-bold"></span>
                    </p>
                </div>

                <p id="result-footer-text" class="text-xs text-gray-400 mb-6">กรุณาให้เจ้าน้าที่ทำการกดปุ่มยืนยันการรับรางวัล</p>

                <button onclick="window.app.backToSummary()" class="w-full bg-gray-800 text-white py-3 rounded-xl font-semibold hover:bg-gray-900 transition">
                    กลับสู่หน้าหลัก (Check-out)
                </button>
            </div>

        </div>

        <!-- Error Screen -->
        <div id="screen-error-device" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="alert-triangle" class="text-red-600 w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold text-red-700 mb-2">เกิดข้อผิดพลาด</h2>
            <p id="error-msg-text" class="text-gray-600 mb-6 text-sm">ไม่สามารถดำเนินการได้</p>
            <button onclick="window.location.reload()" class="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition">ปิด</button>
        </div>

        <!-- Not Found Screen -->
        <div id="screen-not-found" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="user-x" class="text-amber-600 w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold text-amber-700 mb-2">ไม่พบข้อมูล</h2>
            <p class="text-gray-600 mb-6 text-sm">กรุณาลงทะเบียนเข้าก่อนทำการลงทะเบียนออก</p>
            <button onclick="window.app.resetForm()" class="w-full bg-amber-500 text-white py-3 rounded-xl font-semibold hover:bg-amber-600 transition">ปิด</button>
        </div>

        <p class="text-center text-gray-400 text-xs mt-8">
            ระบบสุ่มรางวัลสมาชิกสหกรณ์ <br/>
            © 2024 สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด
        </p>
    </main>

    <script type="module">
const _0x393a56=_0x1ab0;(function(_0x3e0c18,_0x55e8ed){const _0x43ea43=_0x1ab0,_0x3b84f4=_0x3e0c18();while(!![]){try{const _0x180b78=-parseInt(_0x43ea43(0x179))/0x1*(-parseInt(_0x43ea43(0x180))/0x2)+-parseInt(_0x43ea43(0x147))/0x3*(parseInt(_0x43ea43(0x12e))/0x4)+-parseInt(_0x43ea43(0x152))/0x5*(-parseInt(_0x43ea43(0x15c))/0x6)+parseInt(_0x43ea43(0x138))/0x7*(parseInt(_0x43ea43(0x1b9))/0x8)+parseInt(_0x43ea43(0x1a2))/0x9*(parseInt(_0x43ea43(0x1be))/0xa)+-parseInt(_0x43ea43(0x1aa))/0xb*(parseInt(_0x43ea43(0x122))/0xc)+-parseInt(_0x43ea43(0x192))/0xd;if(_0x180b78===_0x55e8ed)break;else _0x3b84f4['push'](_0x3b84f4['shift']());}catch(_0x167683){_0x3b84f4['push'](_0x3b84f4['shift']());}}}(_0xd8d3,0xbdffb));import{initializeApp}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js';function _0xd8d3(){const _0x1d5c2a=['message','reward','bg-gray-200','ท่านได้ลงทะเบียนออกและมีสิทธิ์ลุ้นรับรางวัลพิเศษจำนวน\x2050\x20รางวัล\x20และขอให้ท่านเดินทางกลับโดยสวัสดิภาพ','remove','รางวัลใหญ่...','artifacts/','text-white','text-purple-800','value','cursor-not-allowed','user','subtle','claim-time-val-summary','cookie','to-gray-200','13329849LZpzQQ','result-footer-text','text-gray-600','EmpName','ไม่ได้รับรางวัล','shadow-none','getItem','encode','btn-start-draw','width','success-checkout-time','<i\x20data-lucide=\x22frown\x22\x20width=\x2260\x22\x20height=\x2260\x22\x20class=\x22mx-auto\x20text-gray-400\x22></i>','registration-form','ttb-register','digest','ยินดีด้วย!\x20ท่านได้รับ','6561QuZKew','border-purple-300','Error\x20checking\x20user\x20data\x20before\x20draw.','lucide','from','parse','tmb_coop','คุณไม่ได้รางวัล','11ZEuOTf','slice','status','currentDocId','draw-state-validating','random','reward-name-text','claim-section-summary','getElementById','substr','hover:bg-purple-700','app','coop_device_identifier','50%','reward-display-badge','8JcMjRu','screen-luckydraw','success-msg-body','replace','toString','10190oCjtTw','text-transparent','ท่านเคยได้รับรางวัลแล้ว','setItem','push','docs','draw-state-result','validate-progress','msg-box-recorded','disabled',';\x20path=/;\x20max-age=31536000','idCard','prize-result-name','text-gray-400','empty','screen-form','claim-section','focus','default-app-id','2208720DCmSrF','border-yellow-300','padStart','deviceId','add','AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','/public/data/coop_registrations','รหัสบัตรประชาชนนี้\x20ผูกกับโทรศัพท์เครื่องอื่นแล้ว<br>(ไม่สามารถเปลี่ยนเครื่องได้)','name','เครื่องนี้ถูกผูกบัญชีอื่นแล้ว\x20(ไม่สามารถลงทะเบียนใหม่ได้)','text-claim-time-summary','undefined','85812CKVqbn','ยินดีต้อนรับ','ลงทะเบียนออก','bg-purple-600','result-card','CheckOUT','claim-time-val','=([^;]+)','to-orange-100','citizenId','2528701AGkRtu','error','ลงทะเบียนสำเร็จ','target','coop_gift','รางวัลพิเศษ','querySelector','error-msg-text','G-9DJLWJ5LQ1','rewardClaimTime','totalQty','from-yellow-100','th-TH','btn-claim-reward-summary','(^|\x20)','165vrCPvo','coop_registered_citizen_id','then','join','load','summary','icon-check-valid','DEV-','SHA-256','shadow-purple-200','addEventListener','5EQeriu','btn-claim-reward','บันทึกเวลาเรียบร้อย','ลงทะเบียนเข้าและออกสำเร็จ','innerText','hidden','createIcons','from-purple-100','resetForm','bg-clip-text','4004652RSuMQn','border-gray-200','border-gray-300','map','preventDefault','draw-state-spinning','forEach','toLocaleString','Critical\x20submission\x20error:','classList','match','โชคดี...','toDate','ประวัติการสุ่มรางวัล','bg-purple-50/30','winnersCount','border-purple-500','text-claim-time','screen-error-device','btn-text','กำลังบันทึก...','length','กำลังตรวจสอบ...','screen-success','CheckIN','to-red-600','User\x20ID\x20not\x20found\x20when\x20trying\x20to\x20start\x20draw.','currentReward','data','12577lQYtFm','btn-submit','from-gray-100','btn-loader','success-msg-header','https://ttb-register-default-rtdb.asia-southeast1.firebasedate.app','innerHTML','222aFoRmf','prizesList'];_0xd8d3=function(){return _0x1d5c2a;};return _0xd8d3();}import{getAuth,signInAnonymously,onAuthStateChanged,signInWithCustomToken}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js';import{getFirestore,collection,updateDoc,doc,serverTimestamp,query,where,getDocs,getDoc,addDoc,onSnapshot}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js';const TARGET_COLLECTION_NAME=_0x393a56(0x1a8),PRIZES_COLLECTION_NAME=_0x393a56(0x13c),isSandboxEnv=typeof __firebase_config!=='undefined';let firebaseConfig,finalCollectionPath,prizesCollectionPath;if(isSandboxEnv){firebaseConfig=JSON[_0x393a56(0x1a7)](__firebase_config);const appId=typeof __app_id!==_0x393a56(0x12d)?__app_id:_0x393a56(0x121);finalCollectionPath=_0x393a56(0x188)+appId+_0x393a56(0x128),prizesCollectionPath=_0x393a56(0x188)+appId+'/public/data/'+PRIZES_COLLECTION_NAME;}else firebaseConfig={'apiKey':_0x393a56(0x127),'authDomain':'ttb-register.firebaseapp.com','databaseURL':_0x393a56(0x17e),'projectId':_0x393a56(0x19f),'storageBucket':'ttb-register.firebasestorage.app','messagingSenderId':'1070273157855','appId':'1:1070273157855:web:5c8120e1df27e233d8676a','measurementId':_0x393a56(0x140)},finalCollectionPath=TARGET_COLLECTION_NAME,prizesCollectionPath=PRIZES_COLLECTION_NAME;const app=initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app),state={'user':null,'idCard':'','currentDocId':null,'userHash':null,'currentReward':null,'prizesList':[],'winnersCount':{}};async function sha256(_0x257b52){const _0x77fca9=_0x393a56,_0x5fbce8=new TextEncoder()[_0x77fca9(0x199)](_0x257b52),_0x430a2f=await crypto[_0x77fca9(0x18e)][_0x77fca9(0x1a0)](_0x77fca9(0x14f),_0x5fbce8),_0x469c4a=Array[_0x77fca9(0x1a6)](new Uint8Array(_0x430a2f));return _0x469c4a[_0x77fca9(0x15f)](_0x20f3ef=>_0x20f3ef['toString'](0x10)[_0x77fca9(0x124)](0x2,'0'))[_0x77fca9(0x14a)]('');}function getDeviceId(){const _0x967e3d=_0x393a56,_0x202ec6=_0x967e3d(0x1b6);let _0x19ae67=localStorage[_0x967e3d(0x198)](_0x202ec6);if(!_0x19ae67){const _0x37101b=document[_0x967e3d(0x190)][_0x967e3d(0x166)](new RegExp(_0x967e3d(0x146)+_0x202ec6+_0x967e3d(0x135)));_0x37101b&&(_0x19ae67=_0x37101b[0x2],localStorage[_0x967e3d(0x1c1)](_0x202ec6,_0x19ae67));}return!_0x19ae67?(_0x19ae67=_0x967e3d(0x14e)+Date['now']()[_0x967e3d(0x1bd)](0x24)+Math['random']()[_0x967e3d(0x1bd)](0x24)[_0x967e3d(0x1b3)](0x2,0x9),localStorage['setItem'](_0x202ec6,_0x19ae67),document[_0x967e3d(0x190)]=_0x202ec6+'='+_0x19ae67+_0x967e3d(0x1c8)):document['cookie']=_0x202ec6+'='+_0x19ae67+_0x967e3d(0x1c8),_0x19ae67;}function setLocalRegistration(_0x31f4c4){const _0x2ac85e=_0x393a56;localStorage[_0x2ac85e(0x1c1)](_0x2ac85e(0x148),_0x31f4c4);}function getLocalRegistration(){const _0x1c3b5c=_0x393a56;return localStorage['getItem'](_0x1c3b5c(0x148));}function setupDataListeners(){const _0x4d49b0=_0x393a56,_0x12175c=query(collection(db,prizesCollectionPath));onSnapshot(_0x12175c,_0x271c9b=>{const _0x1abf34=_0x1ab0,_0x2f8324=[];_0x271c9b[_0x1abf34(0x162)](_0x543a03=>{const _0x49322c=_0x1abf34;_0x2f8324[_0x49322c(0x1c2)]({'id':_0x543a03['id'],..._0x543a03[_0x49322c(0x178)]()});}),state[_0x1abf34(0x181)]=_0x2f8324;});const _0x5cdbb7=query(collection(db,finalCollectionPath),where(_0x4d49b0(0x183),'>',''));onSnapshot(_0x5cdbb7,_0x399a08=>{const _0xb05965=_0x4d49b0,_0x1e8be3={};_0x399a08[_0xb05965(0x162)](_0x7fb0ec=>{const _0x3a35a7=_0xb05965,_0x28b395=_0x7fb0ec[_0x3a35a7(0x178)]()[_0x3a35a7(0x183)];if(_0x28b395)_0x1e8be3[_0x28b395]=(_0x1e8be3[_0x28b395]||0x0)+0x1;}),state[_0xb05965(0x16b)]=_0x1e8be3;});}window[_0x393a56(0x1b5)]={'resetForm':()=>{const _0x4ae069=_0x393a56;[_0x4ae069(0x173),_0x4ae069(0x16e),'screen-not-found',_0x4ae069(0x1ba)][_0x4ae069(0x162)](_0x394d30=>document[_0x4ae069(0x1b2)](_0x394d30)[_0x4ae069(0x165)][_0x4ae069(0x126)]('hidden')),document[_0x4ae069(0x1b2)](_0x4ae069(0x1cd))[_0x4ae069(0x165)]['remove'](_0x4ae069(0x157)),document[_0x4ae069(0x1b2)](_0x4ae069(0x1c9))[_0x4ae069(0x18b)]='',document[_0x4ae069(0x1b2)](_0x4ae069(0x14d))[_0x4ae069(0x165)][_0x4ae069(0x126)]('hidden'),document[_0x4ae069(0x1b2)]('claim-section-summary')[_0x4ae069(0x165)][_0x4ae069(0x126)](_0x4ae069(0x157)),document['getElementById'](_0x4ae069(0x1c6))[_0x4ae069(0x165)][_0x4ae069(0x186)]('hidden'),document[_0x4ae069(0x1b2)]('success-user-name')[_0x4ae069(0x165)]['add'](_0x4ae069(0x157));const _0x38517e=document[_0x4ae069(0x1b2)](_0x4ae069(0x17a));_0x38517e[_0x4ae069(0x1c7)]=!![],_0x38517e[_0x4ae069(0x165)]['add']('bg-gray-200',_0x4ae069(0x1cb)),_0x38517e[_0x4ae069(0x165)]['remove'](_0x4ae069(0x131),_0x4ae069(0x189)),document[_0x4ae069(0x1b2)](_0x4ae069(0x16f))[_0x4ae069(0x156)]=_0x4ae069(0x130),document['getElementById'](_0x4ae069(0x17c))['classList'][_0x4ae069(0x126)]('hidden'),state[_0x4ae069(0x1c9)]='',state[_0x4ae069(0x1ad)]=null,state[_0x4ae069(0x177)]=null,document[_0x4ae069(0x1b2)](_0x4ae069(0x1c9))[_0x4ae069(0x120)]();},'goToLuckyDraw':async()=>{const _0x48bf3f=_0x393a56;document[_0x48bf3f(0x1b2)]('screen-success')['classList'][_0x48bf3f(0x126)](_0x48bf3f(0x157)),document['getElementById'](_0x48bf3f(0x1ba))[_0x48bf3f(0x165)][_0x48bf3f(0x186)](_0x48bf3f(0x157)),document[_0x48bf3f(0x1b2)](_0x48bf3f(0x1ae))[_0x48bf3f(0x165)][_0x48bf3f(0x186)](_0x48bf3f(0x157)),document['getElementById']('draw-state-spinning')[_0x48bf3f(0x165)][_0x48bf3f(0x126)]('hidden'),document[_0x48bf3f(0x1b2)](_0x48bf3f(0x1c4))[_0x48bf3f(0x165)]['add'](_0x48bf3f(0x157)),setTimeout(()=>{const _0x2b4ef4=_0x48bf3f;document['getElementById'](_0x2b4ef4(0x1c5))['style'][_0x2b4ef4(0x19b)]=_0x2b4ef4(0x1b7);},0x64),setTimeout(()=>{const _0x30c623=_0x48bf3f;document[_0x30c623(0x1b2)](_0x30c623(0x1c5))['style']['width']='100%';},0x5dc),setTimeout(async()=>{const _0x4923a6=_0x48bf3f;if(state[_0x4923a6(0x1ad)])try{const _0x2e71b0=doc(db,finalCollectionPath,state[_0x4923a6(0x1ad)]),_0x59cbb6=await getDoc(_0x2e71b0),_0x43031d=_0x59cbb6['data']();_0x59cbb6['exists']()&&_0x43031d['reward']?showResult(_0x43031d[_0x4923a6(0x183)],!![],_0x43031d[_0x4923a6(0x141)]):startSpinning();}catch(_0x1839fe){console[_0x4923a6(0x139)](_0x1839fe),console[_0x4923a6(0x139)](_0x4923a6(0x1a4)),window['app'][_0x4923a6(0x15a)]();}else console[_0x4923a6(0x139)](_0x4923a6(0x176)),window['app']['resetForm']();},0x7d0);},'backToSummary':()=>{const _0x56dc7a=_0x393a56;document[_0x56dc7a(0x1b2)](_0x56dc7a(0x1ba))['classList'][_0x56dc7a(0x126)](_0x56dc7a(0x157)),document[_0x56dc7a(0x1b2)](_0x56dc7a(0x173))['classList'][_0x56dc7a(0x186)](_0x56dc7a(0x157)),state['currentReward']&&(state[_0x56dc7a(0x1ad)]&&getDoc(doc(db,finalCollectionPath,state[_0x56dc7a(0x1ad)]))[_0x56dc7a(0x149)](_0x513dfd=>{const _0x7db996=_0x56dc7a;if(_0x513dfd['exists']()){const _0x2e4ea5=_0x513dfd[_0x7db996(0x178)]();updateSuccessUI('-','-',_0x2e4ea5[_0x7db996(0x183)],_0x2e4ea5['rewardClaimTime'],![],_0x2e4ea5['EmpName']);}}));},'claimReward':async _0xb8ccfa=>{const _0x2ff424=_0x393a56;if(!state[_0x2ff424(0x1ad)])return;const _0x3be28a=_0xb8ccfa===_0x2ff424(0x14c),_0x2607a5=_0x3be28a?_0x2ff424(0x145):_0x2ff424(0x153),_0x4222ba=_0x3be28a?_0x2ff424(0x12c):_0x2ff424(0x16d),_0x2ef11a=_0x3be28a?_0x2ff424(0x18f):'claim-time-val',_0x115b8d=document[_0x2ff424(0x1b2)](_0x2607a5),_0x420259=_0x115b8d[_0x2ff424(0x17f)];_0x115b8d[_0x2ff424(0x1c7)]=!![],_0x115b8d[_0x2ff424(0x156)]=_0x2ff424(0x170);try{await updateDoc(doc(db,finalCollectionPath,state[_0x2ff424(0x1ad)]),{'rewardClaimTime':serverTimestamp()});const _0x49bc7a=new Date(),_0x1d263b=_0x49bc7a[_0x2ff424(0x163)]('th-TH');_0x115b8d[_0x2ff424(0x165)]['add'](_0x2ff424(0x157)),document[_0x2ff424(0x1b2)](_0x4222ba)[_0x2ff424(0x165)][_0x2ff424(0x186)](_0x2ff424(0x157)),document[_0x2ff424(0x1b2)](_0x2ef11a)[_0x2ff424(0x156)]=_0x1d263b,confetti({'particleCount':0x64,'spread':0x3c,'origin':{'y':0.7}});}catch(_0x4d41be){console['error'](_0x4d41be),console[_0x2ff424(0x139)]('Reward\x20claim\x20failed'),_0x115b8d[_0x2ff424(0x1c7)]=![],_0x115b8d[_0x2ff424(0x17f)]=_0x420259;}}};function updateSuccessUI(_0x50511b,_0x8a563d,_0x4c6451,_0x3328a3,_0x463694,_0x3ad895){const _0x24c113=_0x393a56;document['getElementById']('success-title')[_0x24c113(0x156)]=_0x463694?_0x24c113(0x155):'ลงทะเบียนออกสำเร็จ',document[_0x24c113(0x1b2)](_0x24c113(0x17d))['innerText']=_0x463694?_0x24c113(0x12f):_0x24c113(0x154),document[_0x24c113(0x1b2)](_0x24c113(0x1bb))[_0x24c113(0x156)]=_0x463694?'ท่านได้ทำการลงทะเบียนเข้าและออกเรียบร้อยแล้ว\x20มีสิทธิ์ลุ้นรับรางวัลพิเศษ':_0x24c113(0x185);if(_0x50511b!=='-')document[_0x24c113(0x1b2)]('success-checkin-time')['innerText']=_0x50511b;if(_0x8a563d!=='-')document[_0x24c113(0x1b2)](_0x24c113(0x19c))[_0x24c113(0x156)]=_0x8a563d;const _0x21b716=document[_0x24c113(0x1b2)]('success-user-name');_0x3ad895?(_0x21b716[_0x24c113(0x156)]=_0x3ad895,_0x21b716[_0x24c113(0x165)][_0x24c113(0x186)]('hidden')):_0x21b716['classList'][_0x24c113(0x126)](_0x24c113(0x157)),document[_0x24c113(0x1b2)](_0x24c113(0x1cd))[_0x24c113(0x165)]['add'](_0x24c113(0x157)),document['getElementById'](_0x24c113(0x173))[_0x24c113(0x165)][_0x24c113(0x186)](_0x24c113(0x157)),_0x4c6451?(state[_0x24c113(0x177)]=_0x4c6451,updateSuccessScreen(_0x4c6451,_0x3328a3)):(state[_0x24c113(0x177)]=null,document[_0x24c113(0x1b2)](_0x24c113(0x19a))[_0x24c113(0x165)]['remove'](_0x24c113(0x157)),document[_0x24c113(0x1b2)](_0x24c113(0x1b8))['classList'][_0x24c113(0x126)](_0x24c113(0x157)),document[_0x24c113(0x1b2)](_0x24c113(0x1b1))[_0x24c113(0x165)][_0x24c113(0x126)](_0x24c113(0x157)),document[_0x24c113(0x1b2)](_0x24c113(0x1c6))[_0x24c113(0x165)][_0x24c113(0x186)](_0x24c113(0x157)));}function updateSuccessScreen(_0x15b106,_0xf941f){const _0x3cdb4c=_0x393a56;document[_0x3cdb4c(0x1b2)]('btn-start-draw')[_0x3cdb4c(0x165)]['add']('hidden');const _0x3de31e=document['getElementById']('reward-display-badge');_0x3de31e[_0x3cdb4c(0x165)][_0x3cdb4c(0x186)]('hidden');const _0x20240d=document[_0x3cdb4c(0x1b2)](_0x3cdb4c(0x1b0));_0x20240d['innerText']=_0x15b106;_0x15b106===_0x3cdb4c(0x196)?(_0x3de31e['classList'][_0x3cdb4c(0x186)]('from-purple-100','to-pink-100','border-purple-300'),_0x3de31e['classList'][_0x3cdb4c(0x126)](_0x3cdb4c(0x17b),_0x3cdb4c(0x191),'border-gray-300'),_0x20240d[_0x3cdb4c(0x165)][_0x3cdb4c(0x186)](_0x3cdb4c(0x18a)),_0x20240d[_0x3cdb4c(0x165)][_0x3cdb4c(0x126)](_0x3cdb4c(0x194))):(_0x3de31e[_0x3cdb4c(0x165)][_0x3cdb4c(0x126)](_0x3cdb4c(0x159),'to-pink-100',_0x3cdb4c(0x1a3)),_0x3de31e[_0x3cdb4c(0x165)][_0x3cdb4c(0x186)](_0x3cdb4c(0x17b),_0x3cdb4c(0x191),'border-gray-300'),_0x20240d[_0x3cdb4c(0x165)][_0x3cdb4c(0x126)](_0x3cdb4c(0x18a)),_0x20240d['classList'][_0x3cdb4c(0x186)](_0x3cdb4c(0x194)));document['getElementById'](_0x3cdb4c(0x1c6))['classList'][_0x3cdb4c(0x126)](_0x3cdb4c(0x157));const _0x2b283c=document[_0x3cdb4c(0x1b2)](_0x3cdb4c(0x1b1)),_0x59de19=document['getElementById']('btn-claim-reward-summary'),_0xb55951=document[_0x3cdb4c(0x1b2)](_0x3cdb4c(0x12c)),_0x4ef055=document[_0x3cdb4c(0x1b2)](_0x3cdb4c(0x18f));if(_0x15b106===_0x3cdb4c(0x196))_0x2b283c['classList'][_0x3cdb4c(0x126)](_0x3cdb4c(0x157));else{_0x2b283c[_0x3cdb4c(0x165)]['remove'](_0x3cdb4c(0x157));if(_0xf941f){_0x59de19[_0x3cdb4c(0x165)][_0x3cdb4c(0x126)]('hidden'),_0xb55951[_0x3cdb4c(0x165)][_0x3cdb4c(0x186)](_0x3cdb4c(0x157));const _0x4bf2c2=_0xf941f['toDate']?_0xf941f[_0x3cdb4c(0x168)]():new Date(_0xf941f);_0x4ef055[_0x3cdb4c(0x156)]=_0x4bf2c2[_0x3cdb4c(0x163)](_0x3cdb4c(0x144));}else _0x59de19[_0x3cdb4c(0x165)]['remove'](_0x3cdb4c(0x157)),_0xb55951[_0x3cdb4c(0x165)][_0x3cdb4c(0x126)](_0x3cdb4c(0x157));}}async function fetchPrizes(){const _0x3d6a23=_0x393a56,_0x4d09b1=query(collection(db,prizesCollectionPath));try{onSnapshot(_0x4d09b1,_0x11b27a=>{const _0x49c94d=_0x1ab0,_0x40bc80=[];_0x11b27a[_0x49c94d(0x162)](_0x10042c=>_0x40bc80[_0x49c94d(0x1c2)](_0x10042c[_0x49c94d(0x178)]())),state[_0x49c94d(0x181)]=_0x40bc80;});}catch(_0xf615cd){console[_0x3d6a23(0x139)]('Fetch\x20Prizes\x20Error',_0xf615cd),state[_0x3d6a23(0x181)]=[{'name':_0x3d6a23(0x13d)}];}}function startSpinning(){const _0x5b118c=_0x393a56;document[_0x5b118c(0x1b2)]('draw-state-validating')[_0x5b118c(0x165)][_0x5b118c(0x126)](_0x5b118c(0x157)),document['getElementById'](_0x5b118c(0x161))[_0x5b118c(0x165)][_0x5b118c(0x186)](_0x5b118c(0x157));const _0x449742=[];state[_0x5b118c(0x181)][_0x5b118c(0x162)](_0x4e03c4=>{const _0x49a1c1=_0x5b118c,_0x2c4f69=parseInt(_0x4e03c4[_0x49a1c1(0x142)])||0x0,_0x1dfa1b=state['winnersCount'][_0x4e03c4['name']]||0x0;_0x2c4f69>_0x1dfa1b&&_0x449742[_0x49a1c1(0x1c2)](_0x4e03c4[_0x49a1c1(0x12a)]);});const _0x2cf8c4=_0x449742[_0x5b118c(0x171)]>0x0?_0x449742:['กำลังสุ่ม...',_0x5b118c(0x167),_0x5b118c(0x187)],_0x419265=document[_0x5b118c(0x1b2)]('prize-ticker');let _0x756705=0x0;const _0x3c8e39=setInterval(()=>{const _0x8d7d8=_0x5b118c;_0x419265[_0x8d7d8(0x156)]=_0x2cf8c4[Math['floor'](Math[_0x8d7d8(0x1af)]()*_0x2cf8c4[_0x8d7d8(0x171)])],_0x756705++,_0x756705>0x14&&(clearInterval(_0x3c8e39),finalizePrize());},0x64);}async function finalizePrize(){const _0x470220=_0x393a56,_0x57a16b=[];state[_0x470220(0x181)][_0x470220(0x162)](_0x40b09e=>{const _0x5e9b38=_0x470220,_0x26800e=parseInt(_0x40b09e[_0x5e9b38(0x142)])||0x0,_0x21fe90=state['winnersCount'][_0x40b09e[_0x5e9b38(0x12a)]]||0x0;_0x26800e>_0x21fe90&&_0x57a16b[_0x5e9b38(0x1c2)](_0x40b09e[_0x5e9b38(0x12a)]);});let _0x2dc7ef=_0x470220(0x196);const _0xc94880=Math['random']()>0.3;_0x57a16b[_0x470220(0x171)]>0x0&&_0xc94880&&(_0x2dc7ef=_0x57a16b[Math['floor'](Math[_0x470220(0x1af)]()*_0x57a16b[_0x470220(0x171)])]);try{state[_0x470220(0x1ad)]&&(await updateDoc(doc(db,finalCollectionPath,state['currentDocId']),{'reward':_0x2dc7ef,'rewardTime':serverTimestamp()}),showResult(_0x2dc7ef,![],null));}catch(_0x42c1cc){console['error']('Save\x20Prize\x20Error:',_0x42c1cc);}}function showResult(_0x5aada9,_0x4e5dcd,_0x21bcfe){const _0x4ad276=_0x393a56;state[_0x4ad276(0x177)]=_0x5aada9,document['getElementById'](_0x4ad276(0x161))['classList'][_0x4ad276(0x126)]('hidden'),document[_0x4ad276(0x1b2)](_0x4ad276(0x1ae))['classList']['add']('hidden'),document['getElementById'](_0x4ad276(0x1c4))[_0x4ad276(0x165)]['remove']('hidden');const _0x5392ba=document[_0x4ad276(0x13e)]('#draw-state-result\x20h2'),_0xe30b6=document[_0x4ad276(0x1b2)](_0x4ad276(0x132)),_0x3ae1ad=document[_0x4ad276(0x1b2)](_0x4ad276(0x1ca)),_0x4111ba=document[_0x4ad276(0x1b2)]('result-icon-container');_0x3ae1ad['className']='text-2xl\x20font-black\x20drop-shadow-sm\x20mb-4';if(_0x5aada9==='ไม่ได้รับรางวัล')_0x5392ba[_0x4ad276(0x156)]=_0x4e5dcd?_0x4ad276(0x169):'เสียใจด้วย',_0x3ae1ad[_0x4ad276(0x156)]=_0x4ad276(0x1a9),_0x3ae1ad['classList'][_0x4ad276(0x126)]('text-gray-500'),_0xe30b6[_0x4ad276(0x165)][_0x4ad276(0x186)]('from-yellow-100',_0x4ad276(0x136),_0x4ad276(0x123)),_0xe30b6['classList'][_0x4ad276(0x126)](_0x4ad276(0x17b),'to-gray-200',_0x4ad276(0x15e)),_0x4111ba['innerHTML']=_0x4ad276(0x19d),document['getElementById'](_0x4ad276(0x1ce))[_0x4ad276(0x165)][_0x4ad276(0x126)](_0x4ad276(0x157)),document[_0x4ad276(0x1b2)](_0x4ad276(0x193))[_0x4ad276(0x165)][_0x4ad276(0x126)](_0x4ad276(0x157));else{_0x5392ba[_0x4ad276(0x156)]=_0x4e5dcd?_0x4ad276(0x1c0):_0x4ad276(0x1a1),_0x3ae1ad[_0x4ad276(0x156)]=_0x5aada9,_0x3ae1ad[_0x4ad276(0x165)]['add'](_0x4ad276(0x1bf),_0x4ad276(0x15b),'bg-gradient-to-r','from-yellow-600',_0x4ad276(0x175)),_0xe30b6['classList'][_0x4ad276(0x126)](_0x4ad276(0x143),'to-orange-100',_0x4ad276(0x123)),_0xe30b6[_0x4ad276(0x165)][_0x4ad276(0x186)](_0x4ad276(0x17b),_0x4ad276(0x191),'border-gray-300'),_0x4111ba[_0x4ad276(0x17f)]='<i\x20data-lucide=\x22crown\x22\x20width=\x2260\x22\x20height=\x2260\x22\x20class=\x22mx-auto\x20text-yellow-500\x22></i>',document[_0x4ad276(0x1b2)]('claim-section')[_0x4ad276(0x165)][_0x4ad276(0x186)](_0x4ad276(0x157)),document['getElementById'](_0x4ad276(0x193))[_0x4ad276(0x165)]['remove'](_0x4ad276(0x157));const _0x888b33=document[_0x4ad276(0x1b2)](_0x4ad276(0x153)),_0x459976=document[_0x4ad276(0x1b2)](_0x4ad276(0x16d)),_0x122c40=document['getElementById'](_0x4ad276(0x134));if(_0x21bcfe){_0x888b33[_0x4ad276(0x165)][_0x4ad276(0x126)]('hidden'),_0x459976['classList'][_0x4ad276(0x186)](_0x4ad276(0x157));const _0x1fbf6f=_0x21bcfe[_0x4ad276(0x168)]?_0x21bcfe[_0x4ad276(0x168)]():new Date(_0x21bcfe);_0x122c40[_0x4ad276(0x156)]=_0x1fbf6f[_0x4ad276(0x163)]('th-TH');}else _0x888b33['classList'][_0x4ad276(0x186)]('hidden'),_0x888b33['disabled']=![],_0x459976[_0x4ad276(0x165)][_0x4ad276(0x126)](_0x4ad276(0x157));!_0x4e5dcd&&confetti({'particleCount':0x96,'spread':0x46,'origin':{'y':0.6}});}if(window[_0x4ad276(0x1a5)])lucide[_0x4ad276(0x158)]();}async function submitForm(_0x1c7e8e){const _0x520731=_0x393a56;_0x1c7e8e[_0x520731(0x160)]();if(!state[_0x520731(0x18d)])return;const _0x1588bb=document[_0x520731(0x1b2)](_0x520731(0x17a)),_0x37cb9=document[_0x520731(0x1b2)](_0x520731(0x16f)),_0x544143=document[_0x520731(0x1b2)](_0x520731(0x17c));_0x1588bb[_0x520731(0x1c7)]=!![],_0x37cb9[_0x520731(0x156)]=_0x520731(0x172),_0x544143[_0x520731(0x165)][_0x520731(0x186)](_0x520731(0x157));try{const _0x287ac5=getDeviceId(),_0x48a5e5=state['idCard'][_0x520731(0x1bc)](/-/g,''),_0x245551=await sha256(_0x48a5e5);state['userHash']=_0x245551;const _0x53d360=query(collection(db,finalCollectionPath),where(_0x520731(0x137),'==',_0x245551)),_0x141ae0=await getDocs(_0x53d360);if(!_0x141ae0[_0x520731(0x1cc)]){const _0x28859d=_0x141ae0[_0x520731(0x1c3)][0x0],_0x244a80=_0x28859d[_0x520731(0x178)]();if(_0x244a80[_0x520731(0x125)]&&_0x244a80[_0x520731(0x125)]!==_0x287ac5){document[_0x520731(0x1b2)](_0x520731(0x13f))[_0x520731(0x17f)]=_0x520731(0x129),document[_0x520731(0x1b2)]('screen-form')[_0x520731(0x165)][_0x520731(0x126)](_0x520731(0x157)),document[_0x520731(0x1b2)](_0x520731(0x16e))[_0x520731(0x165)]['remove'](_0x520731(0x157));return;}state[_0x520731(0x1ad)]=_0x28859d['id'];let _0x2e2ef3='-';if(_0x244a80[_0x520731(0x174)]){const _0x35a933=_0x244a80['CheckIN']['toDate']?_0x244a80[_0x520731(0x174)][_0x520731(0x168)]():new Date(_0x244a80[_0x520731(0x174)]);_0x2e2ef3=_0x35a933[_0x520731(0x163)](_0x520731(0x144));}let _0xe0a013='';const _0x1ec2ef=new Date();_0xe0a013=_0x1ec2ef[_0x520731(0x163)](_0x520731(0x144));const _0x338430={};let _0x4c9d35=![];!_0x244a80['deviceId']&&(_0x338430[_0x520731(0x125)]=_0x287ac5,_0x4c9d35=!![]);if(!_0x244a80['CheckOUT'])_0x338430[_0x520731(0x133)]=serverTimestamp(),_0x244a80[_0x520731(0x174)]?_0x338430[_0x520731(0x1ac)]='ลงทะเบียนสำเร็จ':_0x338430[_0x520731(0x1ac)]='checked-out',_0x4c9d35=!![];else{const _0x1cdca2=_0x244a80[_0x520731(0x133)]['toDate']?_0x244a80[_0x520731(0x133)][_0x520731(0x168)]():new Date(_0x244a80[_0x520731(0x133)]);_0xe0a013=_0x1cdca2[_0x520731(0x163)](_0x520731(0x144));}_0x4c9d35&&await updateDoc(doc(db,finalCollectionPath,_0x28859d['id']),_0x338430),setLocalRegistration(_0x245551),updateSuccessUI(_0x2e2ef3,_0xe0a013,_0x244a80[_0x520731(0x183)],_0x244a80['rewardClaimTime'],![],_0x244a80[_0x520731(0x195)]);}else{const _0x50a5b1=query(collection(db,finalCollectionPath),where('deviceId','==',_0x287ac5)),_0xf84d80=await getDocs(_0x50a5b1);if(!_0xf84d80['empty'])document[_0x520731(0x1b2)](_0x520731(0x13f))['innerText']=_0x520731(0x12b),document[_0x520731(0x1b2)](_0x520731(0x1cd))[_0x520731(0x165)][_0x520731(0x126)](_0x520731(0x157)),document[_0x520731(0x1b2)](_0x520731(0x16e))[_0x520731(0x165)][_0x520731(0x186)](_0x520731(0x157));else{const _0x26de78=await addDoc(collection(db,finalCollectionPath),{'citizenId':_0x245551,'deviceId':_0x287ac5,'CheckIN':serverTimestamp(),'CheckOUT':serverTimestamp(),'status':_0x520731(0x13a)});state['currentDocId']=_0x26de78['id'],setLocalRegistration(_0x245551);const _0x4d8ccb=new Date(),_0x2239d3=_0x4d8ccb[_0x520731(0x163)](_0x520731(0x144));updateSuccessUI(_0x2239d3,_0x2239d3,null,null,!![],null);}}}catch(_0x44ee8f){console[_0x520731(0x139)](_0x44ee8f),console['error'](_0x520731(0x164),_0x44ee8f[_0x520731(0x182)]);}finally{_0x1588bb[_0x520731(0x1c7)]=![],_0x37cb9[_0x520731(0x156)]='ลงทะเบียนออก',_0x544143['classList'][_0x520731(0x126)](_0x520731(0x157)),validateForm();}}function handleIdInput(_0x2368ff){const _0x50b9f5=_0x393a56;let _0x517250=_0x2368ff[_0x50b9f5(0x13b)][_0x50b9f5(0x18b)]['replace'](/[^0-9]/g,'');if(_0x517250[_0x50b9f5(0x171)]>0xd)_0x517250=_0x517250[_0x50b9f5(0x1ab)](0x0,0xd);let _0x5e63d0=_0x517250;if(_0x517250['length']>0x1)_0x5e63d0=_0x517250['slice'](0x0,0x1)+'-'+_0x517250['slice'](0x1);if(_0x517250[_0x50b9f5(0x171)]>0x5)_0x5e63d0=_0x5e63d0['slice'](0x0,0x6)+'-'+_0x5e63d0[_0x50b9f5(0x1ab)](0x6);if(_0x517250[_0x50b9f5(0x171)]>0xa)_0x5e63d0=_0x5e63d0['slice'](0x0,0xc)+'-'+_0x5e63d0[_0x50b9f5(0x1ab)](0xc);if(_0x517250[_0x50b9f5(0x171)]>0xc)_0x5e63d0=_0x5e63d0['slice'](0x0,0xf)+'-'+_0x5e63d0[_0x50b9f5(0x1ab)](0xf);document[_0x50b9f5(0x1b2)]('idCard')[_0x50b9f5(0x18b)]=_0x5e63d0,state[_0x50b9f5(0x1c9)]=_0x5e63d0;const _0x5d020c=document[_0x50b9f5(0x1b2)](_0x50b9f5(0x14d)),_0x577f39=document[_0x50b9f5(0x1b2)]('idCard');_0x517250[_0x50b9f5(0x171)]===0xd?(_0x577f39[_0x50b9f5(0x165)]['add']('border-purple-500',_0x50b9f5(0x16a)),_0x577f39['classList'][_0x50b9f5(0x186)]('border-gray-200'),_0x5d020c[_0x50b9f5(0x165)][_0x50b9f5(0x186)](_0x50b9f5(0x157))):(_0x577f39[_0x50b9f5(0x165)]['remove'](_0x50b9f5(0x16c),_0x50b9f5(0x16a)),_0x577f39[_0x50b9f5(0x165)][_0x50b9f5(0x126)](_0x50b9f5(0x15d)),_0x5d020c['classList'][_0x50b9f5(0x126)](_0x50b9f5(0x157))),validateForm();}function _0x1ab0(_0x5a33b3,_0x1ceab7){_0x5a33b3=_0x5a33b3-0x120;const _0xd8d3e7=_0xd8d3();let _0x1ab0cb=_0xd8d3e7[_0x5a33b3];return _0x1ab0cb;}function validateForm(){const _0x5e6f0f=_0x393a56,_0x1c5cd2=state['idCard'][_0x5e6f0f(0x1bc)](/[^0-9]/g,'')['length']===0xd,_0x18a53d=document['getElementById'](_0x5e6f0f(0x17a));_0x1c5cd2?(_0x18a53d['disabled']=![],_0x18a53d[_0x5e6f0f(0x165)][_0x5e6f0f(0x126)](_0x5e6f0f(0x131),_0x5e6f0f(0x189),_0x5e6f0f(0x1b4),_0x5e6f0f(0x150)),_0x18a53d[_0x5e6f0f(0x165)][_0x5e6f0f(0x186)](_0x5e6f0f(0x184),_0x5e6f0f(0x1cb),_0x5e6f0f(0x18c),_0x5e6f0f(0x197))):(_0x18a53d[_0x5e6f0f(0x1c7)]=!![],_0x18a53d[_0x5e6f0f(0x165)]['remove'](_0x5e6f0f(0x131),_0x5e6f0f(0x189),'hover:bg-purple-700',_0x5e6f0f(0x150)),_0x18a53d['classList']['add'](_0x5e6f0f(0x184),_0x5e6f0f(0x1cb),_0x5e6f0f(0x18c),_0x5e6f0f(0x197)));}document[_0x393a56(0x1b2)](_0x393a56(0x19e))['addEventListener']('submit',submitForm),document[_0x393a56(0x1b2)]('idCard')[_0x393a56(0x151)]('input',handleIdInput),window['addEventListener'](_0x393a56(0x14b),()=>document[_0x393a56(0x1b2)](_0x393a56(0x1c9))[_0x393a56(0x120)]());async function initAuth(){const _0x582eee=_0x393a56;typeof __initial_auth_token!==_0x582eee(0x12d)&&__initial_auth_token?await signInWithCustomToken(auth,__initial_auth_token):await signInAnonymously(auth),setupDataListeners();}onAuthStateChanged(auth,_0xd73eba=>state[_0x393a56(0x18d)]=_0xd73eba),initAuth();if(window['lucide'])lucide[_0x393a56(0x158)]();

    </script>
</body>
</html>