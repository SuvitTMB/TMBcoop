<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Canvas Confetti for Fireworks -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Google Font (Sarabun) -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .hidden { display: none !important; }
        
        /* Custom Animations */
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes bounce-slow { 0%, 100% { transform: translateY(-5%); } 50% { transform: translateY(0); } }
        .animate-bounce-slow { animation: bounce-slow 2s infinite; }
        
        /* Remove number arrows */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        
        .input-focus:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen pb-10">

    <!-- Header Section -->
    <div class="bg-gradient-to-r from-blue-800 to-indigo-900 text-white p-6 rounded-b-[2.5rem] shadow-xl mb-8 relative overflow-hidden">
        <div class="absolute top-0 right-0 opacity-10 transform translate-x-10 -translate-y-10">
            <i data-lucide="shield-check" width="150" height="150"></i>
        </div>
        
        <div class="relative z-10 flex flex-col items-center">
            <div class="bg-white/20 p-3 rounded-full mb-3 backdrop-blur-sm">
                <i data-lucide="calendar" width="32" height="32" class="text-white"></i>
            </div>
            <h1 class="text-xl font-bold text-center">ประชุมใหญ่สามัญประจำปี 2568</h1>
            <p class="text-blue-100 text-sm mt-1 text-center">สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด</p>
        </div>
    </div>

    <!-- Main Content Container -->
    <main class="px-4 max-w-lg mx-auto -mt-10">
        
        <!-- Registration Form Screen -->
        <div id="screen-form" class="bg-white rounded-2xl shadow-2xl p-6 border border-slate-200 relative z-20">
            <form id="registration-form" class="space-y-6 pt-2">
                <div class="text-center">
                    <div>
                        <label for="idCard" class="block text-sm font-semibold text-gray-700 mb-2 text-center">
                            เลขบัตรประจำตัวประชาชน
                        </label>
                        <div class="relative">
                            <input
                                type="text"
                                id="idCard"
                                placeholder="x-xxxx-xxxxx-xx-x"
                                class="w-full text-xl font-mono tracking-widest p-4 rounded-xl border-2 border-gray-300 bg-white outline-none transition-all text-center input-focus"
                                inputmode="numeric"
                                maxlength="17"
                            />
                            <i id="icon-check-valid" data-lucide="check-circle" class="hidden absolute right-4 top-1/2 transform -translate-y-1/2 text-green-500 w-6 h-6 animate-fade-in"></i>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">กรุณากรอกตัวเลข 13 หลักให้ครบถ้วน</p>
                    </div>

                    <!-- Info Box -->
                    <div class="p-4 bg-amber-50 border border-amber-200 text-amber-900 rounded-xl text-xs flex gap-3 items-start mt-6 text-left">
                        <i data-lucide="info" class="w-5 h-5 shrink-0 text-amber-600"></i>
                        <span class="leading-relaxed">ผู้ที่จะได้รับรางวัลค่าตอบแทนการประชุม 200 บาท <b class="text-red-600">จะต้องลงทะเบียนเข้า และลงทะเบียนออก เท่านั้น</b></span>
                    </div>
                </div>

                <button
                    type="submit"
                    id="btn-submit"
                    disabled
                    class="w-full py-4 rounded-xl font-bold text-lg shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2 bg-gray-200 text-gray-400 cursor-not-allowed"
                >
                    <span id="btn-text">ตรวจสอบ / ลงทะเบียน</span>
                    <i id="btn-loader" data-lucide="loader-2" class="hidden animate-spin"></i>
                </button>
            </form>
        </div>

        <!-- Success Screen -->
        <div id="screen-success" class="hidden bg-white rounded-2xl shadow-2xl p-8 w-full text-center animate-fade-in relative z-20 border border-blue-100">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i data-lucide="user-check" class="text-green-600 w-10 h-10"></i>
            </div>
            
            <!-- User Info Section -->
            <div class="mb-4">
                <h3 id="success-user-name" class="text-2xl font-bold text-blue-800 mb-1"></h3>
                <h2 id="success-title" class="text-lg font-medium text-gray-600">ลงทะเบียนสำเร็จ</h2>
                <p id="success-checkin-datetime" class="text-blue-500 font-semibold text-xs mt-1">--/--/---- --:--</p>
            </div>
            
            <!-- Dynamic Content Area -->
            <div id="status-content-area" class="mb-8">
                <!-- First Time Flow: Voting Card -->
                <div id="flow-first-time" class="hidden space-y-4">
                    <div id="voting-status-box" class="bg-indigo-700 text-white p-6 rounded-2xl shadow-inner">
                        <div id="voting-box-content">
                            <p class="text-lg font-bold">ขอให้สมาชิกติดต่อเจ้าหน้าที่</p>
                            <p class="text-sm mt-2 leading-relaxed">เพื่อขอบัตรเลือกตั้งกรรมการ <br>สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด</p>
                        </div>
                    </div>
                    
                    <div class="pt-4 space-y-3">
                        <button id="btn-confirm-voting" onclick="window.app.confirmVotingCard()" class="w-full bg-emerald-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-emerald-700 shadow-lg transition-all active:scale-95">
                            ยืนยันการรับบัตรเลือกตั้งแล้ว
                        </button>
                        
                        <!-- Warning Message moved here and staff hint removed -->
                        <p id="voting-warning" class="text-red-600 text-sm font-semibold">คำเตือน<br>ห้ามออกจากหน้านี้หากยังไม่ได้รับบัตรเลือกตั้ง<br>เมื่อออกไปแล้วจะไม่สามารถรับบัตรเลือกตั้งได้</p>
                    </div>
                </div>

                <!-- Returning Flow: Visit Counter -->
                <div id="flow-returning" class="hidden">
                    <div class="bg-blue-50 border-2 border-blue-200 p-8 rounded-2xl">
                        <p class="text-gray-500 text-sm">คุณเข้ามาทำรายการเป็น</p>
                        <div class="flex items-baseline justify-center gap-2 mt-1">
                            <span id="login-count-text" class="text-5xl font-black text-blue-700">0</span>
                            <span class="text-xl font-bold text-blue-700">ครั้ง</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="btn-back-main" onclick="window.app.resetForm()" class="hidden w-full bg-slate-800 text-white py-4 rounded-xl font-bold text-lg hover:bg-slate-900 transition shadow-xl">
                กลับสู่หน้าหลัก
            </button>
        </div>

        <!-- Not Found Screen -->
        <div id="screen-not-found" class="hidden bg-white rounded-2xl shadow-2xl p-8 w-full text-center animate-fade-in relative z-20 border-2 border-amber-100">
            <div class="w-20 h-20 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="user-x" class="text-amber-600 w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold text-amber-700 mb-2">ไม่พบข้อมูลในระบบ</h2>
            <p class="text-gray-600 mb-8 text-sm leading-relaxed">
                ไม่พบข้อมูลการลงทะเบียนของรหัสบัตรประชาชนหมายเลขนี้ <br>
                <b class="text-amber-800 text-base">กรุณาติดต่อเจ้าหน้าที่</b>
            </p>
            <button onclick="window.app.resetForm()" class="w-full bg-amber-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-amber-700 transition shadow-lg">
                ตกลง
            </button>
        </div>

        <!-- Lightbox / Modal for Confirmation -->
        <div id="modal-confirm" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 modal-backdrop animate-fade-in">
            <div class="bg-white rounded-3xl shadow-2xl max-w-sm w-full p-8 text-center animate-fade-in">
                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="help-circle" class="text-blue-600 w-8 h-8"></i>
                </div>
                <div id="modal-content" class="mb-8">
                    <p id="modal-user-name" class="text-xl font-bold text-gray-800 mb-1"></p>
                    <p class="text-gray-600 leading-relaxed">ขอยืนยันการรับบัตรเลือกตั้ง เรียบร้อยแล้ว</p>
                </div>
                <div class="flex flex-col gap-3">
                    <button id="btn-modal-submit" onclick="window.app.finalConfirmVoting()" class="w-full bg-blue-500 text-white py-3 rounded-xl font-bold hover:bg-blue-800 transition active:scale-95">
                        ยืนยันการรับบัตรเลือกตั้ง
                    </button>
                    <button onclick="window.app.closeModal()" class="w-full bg-red-500 text-white py-3 rounded-xl font-semibold hover:bg-red-800 transition">
                        ยกเลิกรายการ
                    </button>
                </div>
            </div>
        </div>

        <!-- Error Screen -->
        <div id="screen-error-device" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20 border-2 border-red-50">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="alert-circle" class="text-red-600 w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold text-red-700 mb-2">ไม่สามารถดำเนินการได้</h2>
            <p id="error-msg-text" class="text-gray-600 mb-6 text-sm">
                เกิดข้อผิดพลาดในการประมวลผล กรุณาลองใหม่อีกครั้ง
            </p>
            <button onclick="window.location.reload()" class="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition">
                ตกลง
            </button>
        </div>

        <!-- Footer -->
        <p class="text-center text-gray-400 text-xs mt-8">
            ระบบลงทะเบียนสมาชิกสหกรณ์ <br/>
            © 2026 สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด
        </p>
    </main>

    <!-- Firebase and Application Logic -->
    <script type="module">
const _0x90ddf9=_0x1bab;(function(_0x4393a2,_0x2c1926){const _0xb423e6=_0x1bab,_0x36c607=_0x4393a2();while(!![]){try{const _0xf27ba8=-parseInt(_0xb423e6(0xcc))/0x1*(parseInt(_0xb423e6(0x7f))/0x2)+parseInt(_0xb423e6(0x8c))/0x3*(parseInt(_0xb423e6(0xa9))/0x4)+parseInt(_0xb423e6(0x8f))/0x5*(parseInt(_0xb423e6(0xdf))/0x6)+parseInt(_0xb423e6(0x92))/0x7*(-parseInt(_0xb423e6(0x88))/0x8)+-parseInt(_0xb423e6(0xd6))/0x9+parseInt(_0xb423e6(0xe0))/0xa+parseInt(_0xb423e6(0xd8))/0xb;if(_0xf27ba8===_0x2c1926)break;else _0x36c607['push'](_0x36c607['shift']());}catch(_0x7aea0e){_0x36c607['push'](_0x36c607['shift']());}}}(_0x3f1c,0xb3fad));import{initializeApp}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js';import{getAuth,signInAnonymously,onAuthStateChanged,signInWithCustomToken}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js';import{getFirestore,collection,addDoc,updateDoc,doc,serverTimestamp,query,where,getDocs,increment}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js';function _0x3f1c(){const _0x5bf50d=['ตรวจสอบ\x20/\x20ลงทะเบียน','submit','903276huIELk','docs','add','remove','user','success-checkin-datetime','toLocaleTimeString','btn-text','screen-form','71976rlKUrM','1070273157855','btn-loader','join','4352793faXyhe','disabled','AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','5PGVDLX','screen-error-device','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','476vxwAfd','Submit\x20Error:','empty','parse','CheckIN','toString','checked-in','replace','padStart','icon-check-valid','1:1070273157855:web:5c8120e1df27e233d8676a','EmpName','screen-not-found','screen-success','border-gray-300','tmb_coop','bg-blue-50/30','lucide','text-gray-400','slice','btn-modal-submit','modal-confirm','btn-back-main','4CQIjxH','error','flow-first-time','getElementById','innerText','artifacts/','text-white','เกิดข้อผิดพลาด:\x20','length','border-blue-500','btn-confirm-voting','btn-submit','bg-blue-700','classList','forEach','Confirm\x20voting\x20error:','data','empName','toLocaleDateString','app','voting-box-content','TimeLogin','digest','กำลังตรวจสอบ...','target','load','subtle','encode','value','getItem','bg-gray-200','https://ttb-register-default-rtdb.asia-southeast1.firebasedate.app','undefined','from','currentDocId','3XllniM','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-lg\x20mt-1\x20font-semibold\x22>ขอยืนยันการรับบัตรเลือกตั้งแล้ว</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-sm\x20mt-2\x20opacity-90\x22>เมื่อ\x20','hidden','ลงทะเบียนเมื่อ:\x20','coop_device_identifier','addEventListener','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xl\x20font-bold\x22>','createIcons','error-msg-text','ttb-register.firebaseapp.com','3662469pvchCe','idCard','3337752AraEzg','รับบัตรเลือกตั้ง','login-count-text','ttb-register.firebasestorage.app','modal-user-name','th-TH','preventDefault','684438UswQQx','12424120QvOsyJ','map','innerHTML','registration-form','voting-warning','default-app-id','success-user-name','flow-returning'];_0x3f1c=function(){return _0x5bf50d;};return _0x3f1c();}const TARGET_COLLECTION_NAME=_0x90ddf9(0xa1),isSandboxEnv=typeof __firebase_config!==_0x90ddf9(0xc9);let firebaseConfig,finalCollectionPath;if(isSandboxEnv){firebaseConfig=JSON[_0x90ddf9(0x95)](__firebase_config);const appId=typeof __app_id!=='undefined'?__app_id:_0x90ddf9(0xe5);finalCollectionPath=_0x90ddf9(0xae)+appId+'/public/data/coop_registrations';}else firebaseConfig={'apiKey':_0x90ddf9(0x8e),'authDomain':_0x90ddf9(0xd5),'databaseURL':_0x90ddf9(0xc8),'projectId':'ttb-register','storageBucket':_0x90ddf9(0xdb),'messagingSenderId':_0x90ddf9(0x89),'appId':_0x90ddf9(0x9c),'measurementId':'G-9DJLWJ5LQ1'},finalCollectionPath=TARGET_COLLECTION_NAME;const state={'user':null,'idCard':'','currentDocId':null,'empName':''},app=initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app);async function sha256(_0x46c6d1){const _0x37a82b=_0x90ddf9,_0x34387d=new TextEncoder()[_0x37a82b(0xc4)](_0x46c6d1),_0x15bb58=await crypto[_0x37a82b(0xc3)][_0x37a82b(0xbf)]('SHA-256',_0x34387d),_0x340b8b=Array[_0x37a82b(0xca)](new Uint8Array(_0x15bb58)),_0x1f8f39=_0x340b8b[_0x37a82b(0xe1)](_0x14e91f=>_0x14e91f['toString'](0x10)[_0x37a82b(0x9a)](0x2,'0'))[_0x37a82b(0x8b)]('');return _0x1f8f39;}function getDeviceId(){const _0x189092=_0x90ddf9,_0x1ecb45=_0x189092(0xd0);let _0x5fba00=localStorage[_0x189092(0xc6)](_0x1ecb45);return!_0x5fba00&&(_0x5fba00='DEV-'+Date['now']()['toString'](0x24)+Math['random']()[_0x189092(0x97)](0x24)['substr'](0x2,0x9),localStorage['setItem'](_0x1ecb45,_0x5fba00)),_0x5fba00;}window[_0x90ddf9(0xbc)]={'resetForm':()=>{const _0x49c630=_0x90ddf9,_0x414431=[_0x49c630(0x9f),_0x49c630(0x90),_0x49c630(0xa7),_0x49c630(0x9e)];_0x414431[_0x49c630(0xb7)](_0x3f82e0=>document['getElementById'](_0x3f82e0)[_0x49c630(0xb6)][_0x49c630(0x81)](_0x49c630(0xce))),document[_0x49c630(0xac)]('screen-form')[_0x49c630(0xb6)][_0x49c630(0x82)](_0x49c630(0xce));const _0x2f8b04=document['getElementById'](_0x49c630(0xd7));_0x2f8b04['value']='',state['idCard']='',state[_0x49c630(0xcb)]=null,state['empName']='';const _0xefaa23=document[_0x49c630(0xac)](_0x49c630(0xb4));_0xefaa23['disabled']=!![],_0xefaa23[_0x49c630(0xb6)]['add'](_0x49c630(0xc7),_0x49c630(0xa4)),_0xefaa23[_0x49c630(0xb6)]['remove'](_0x49c630(0xb5),_0x49c630(0xaf)),document[_0x49c630(0xac)]('voting-box-content')[_0x49c630(0xe2)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-lg\x20font-bold\x22>ขอให้สมาชิกติดต่อเจ้าหน้าที่</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-sm\x20mt-2\x20leading-relaxed\x22>เพื่อขอบัตรเลือกตั้งกรรมการ\x20<br>สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย\x20จำกัด</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',document[_0x49c630(0xac)](_0x49c630(0xb3))[_0x49c630(0xb6)][_0x49c630(0x82)]('hidden'),document['getElementById']('voting-warning')[_0x49c630(0xb6)][_0x49c630(0x82)](_0x49c630(0xce)),document[_0x49c630(0xac)](_0x49c630(0x9b))[_0x49c630(0xb6)][_0x49c630(0x81)](_0x49c630(0xce)),_0x2f8b04[_0x49c630(0xb6)][_0x49c630(0x82)](_0x49c630(0xb2),_0x49c630(0xa2)),_0x2f8b04[_0x49c630(0xb6)]['add'](_0x49c630(0xa0),'bg-white'),_0x2f8b04['focus']();},'closeModal':()=>{const _0x3c15dc=_0x90ddf9;document[_0x3c15dc(0xac)](_0x3c15dc(0xa7))[_0x3c15dc(0xb6)][_0x3c15dc(0x81)](_0x3c15dc(0xce));},'confirmVotingCard':()=>{const _0x19aed9=_0x90ddf9;document[_0x19aed9(0xac)](_0x19aed9(0xdc))[_0x19aed9(0xad)]=state[_0x19aed9(0xba)],document[_0x19aed9(0xac)](_0x19aed9(0xa7))[_0x19aed9(0xb6)][_0x19aed9(0x82)](_0x19aed9(0xce));},'finalConfirmVoting':async()=>{const _0x55dcfa=_0x90ddf9;if(!state[_0x55dcfa(0xcb)])return;const _0x177335=document['getElementById'](_0x55dcfa(0xa6));_0x177335[_0x55dcfa(0x8d)]=!![];try{const _0x4fd6b9=new Date();await updateDoc(doc(db,finalCollectionPath,state[_0x55dcfa(0xcb)]),{'ConfirmVotingCard':serverTimestamp(),'CardPoll':_0x55dcfa(0xd9)}),window[_0x55dcfa(0xbc)]['closeModal'](),document[_0x55dcfa(0xac)](_0x55dcfa(0xbd))['innerHTML']=_0x55dcfa(0xd2)+state[_0x55dcfa(0xba)]+_0x55dcfa(0xcd)+_0x4fd6b9[_0x55dcfa(0xbb)](_0x55dcfa(0xdd))+'\x20'+_0x4fd6b9[_0x55dcfa(0x85)](_0x55dcfa(0xdd))+_0x55dcfa(0x91),document['getElementById'](_0x55dcfa(0xb3))['classList']['add'](_0x55dcfa(0xce)),document[_0x55dcfa(0xac)](_0x55dcfa(0xe4))['classList'][_0x55dcfa(0x81)](_0x55dcfa(0xce)),document[_0x55dcfa(0xac)](_0x55dcfa(0xa8))[_0x55dcfa(0xb6)][_0x55dcfa(0x82)](_0x55dcfa(0xce)),confetti({'particleCount':0xc8,'spread':0x50,'origin':{'y':0.6}});}catch(_0x12466b){console['error'](_0x55dcfa(0xb8),_0x12466b),_0x177335[_0x55dcfa(0x8d)]=![];}}};function showSuccess(_0x5f4b9d,_0x3208b6){const _0x2b2d07=_0x90ddf9;state['empName']=_0x5f4b9d[_0x2b2d07(0x9d)]||'สมาชิกสหกรณ์',document['getElementById'](_0x2b2d07(0xe6))[_0x2b2d07(0xad)]=state[_0x2b2d07(0xba)];const _0x212c3d=document[_0x2b2d07(0xac)](_0x2b2d07(0x84)),_0x234f5c=new Date();_0x212c3d['innerText']=_0x2b2d07(0xcf)+_0x234f5c[_0x2b2d07(0xbb)](_0x2b2d07(0xdd))+'\x20'+_0x234f5c[_0x2b2d07(0x85)]('th-TH');const _0x2a8ead=document[_0x2b2d07(0xac)](_0x2b2d07(0xab)),_0x226368=document[_0x2b2d07(0xac)](_0x2b2d07(0x7c)),_0x5340bd=document['getElementById']('btn-back-main');_0x3208b6?(_0x2a8ead['classList'][_0x2b2d07(0x82)](_0x2b2d07(0xce)),_0x226368[_0x2b2d07(0xb6)][_0x2b2d07(0x81)](_0x2b2d07(0xce)),_0x5340bd[_0x2b2d07(0xb6)][_0x2b2d07(0x81)]('hidden')):(_0x2a8ead[_0x2b2d07(0xb6)]['add'](_0x2b2d07(0xce)),_0x226368[_0x2b2d07(0xb6)][_0x2b2d07(0x82)](_0x2b2d07(0xce)),document['getElementById'](_0x2b2d07(0xda))[_0x2b2d07(0xad)]=_0x5f4b9d[_0x2b2d07(0xbe)],_0x5340bd[_0x2b2d07(0xb6)][_0x2b2d07(0x82)](_0x2b2d07(0xce)));document['getElementById'](_0x2b2d07(0x87))[_0x2b2d07(0xb6)]['add'](_0x2b2d07(0xce)),document[_0x2b2d07(0xac)](_0x2b2d07(0x9f))[_0x2b2d07(0xb6)][_0x2b2d07(0x82)](_0x2b2d07(0xce));if(window['lucide'])lucide[_0x2b2d07(0xd3)]();}function showNotFound(){const _0x14e453=_0x90ddf9;document[_0x14e453(0xac)](_0x14e453(0x87))[_0x14e453(0xb6)][_0x14e453(0x81)](_0x14e453(0xce)),document[_0x14e453(0xac)](_0x14e453(0x9e))[_0x14e453(0xb6)][_0x14e453(0x82)]('hidden');if(window['lucide'])lucide[_0x14e453(0xd3)]();}function _0x1bab(_0x2f78f2,_0x5be196){_0x2f78f2=_0x2f78f2-0x7c;const _0x3f1c4b=_0x3f1c();let _0x1bab00=_0x3f1c4b[_0x2f78f2];return _0x1bab00;}async function submitForm(_0x18c75b){const _0x4bbf20=_0x90ddf9;_0x18c75b[_0x4bbf20(0xde)]();if(!state[_0x4bbf20(0x83)])return;const _0x3019de=document['getElementById']('btn-submit'),_0x384833=document[_0x4bbf20(0xac)](_0x4bbf20(0x86)),_0xf073a8=document[_0x4bbf20(0xac)](_0x4bbf20(0x8a));_0x3019de['disabled']=!![],_0x384833[_0x4bbf20(0xad)]=_0x4bbf20(0xc0),_0xf073a8[_0x4bbf20(0xb6)]['remove']('hidden');try{const _0x3c847d=getDeviceId(),_0x2cf817=state['idCard']['replace'](/-/g,''),_0x571050=await sha256(_0x2cf817),_0x15fd86=query(collection(db,finalCollectionPath),where('citizenId','==',_0x571050)),_0x511f03=await getDocs(_0x15fd86);if(_0x511f03[_0x4bbf20(0x94)]){showNotFound();return;}const _0x45e40d=_0x511f03[_0x4bbf20(0x80)][0x0],_0x6edae=_0x45e40d[_0x4bbf20(0xb9)]();state[_0x4bbf20(0xcb)]=_0x45e40d['id'];const _0x5ab718=_0x6edae[_0x4bbf20(0xbe)]||0x0,_0x4ce7d8=_0x5ab718===0x0,_0x3b863b={'TimeLogin':increment(0x1),'deviceId':_0x3c847d};!_0x6edae['CheckIN']&&(_0x3b863b[_0x4bbf20(0x96)]=serverTimestamp(),_0x3b863b['status']=_0x4bbf20(0x98));await updateDoc(doc(db,finalCollectionPath,_0x45e40d['id']),_0x3b863b);const _0x4f9c30={..._0x6edae,'TimeLogin':_0x5ab718+0x1};showSuccess(_0x4f9c30,_0x4ce7d8);}catch(_0x4421c3){console[_0x4bbf20(0xaa)](_0x4bbf20(0x93),_0x4421c3),document[_0x4bbf20(0xac)](_0x4bbf20(0xd4))[_0x4bbf20(0xad)]=_0x4bbf20(0xb0)+_0x4421c3['message'],document[_0x4bbf20(0xac)](_0x4bbf20(0x87))[_0x4bbf20(0xb6)][_0x4bbf20(0x81)](_0x4bbf20(0xce)),document[_0x4bbf20(0xac)](_0x4bbf20(0x90))[_0x4bbf20(0xb6)][_0x4bbf20(0x82)](_0x4bbf20(0xce));}finally{_0x3019de['disabled']=![],_0x384833[_0x4bbf20(0xad)]=_0x4bbf20(0x7d),_0xf073a8['classList']['add']('hidden');}}function handleIdInput(_0x1bfa79){const _0x228dfb=_0x90ddf9;let _0x45fe8c=_0x1bfa79[_0x228dfb(0xc1)][_0x228dfb(0xc5)][_0x228dfb(0x99)](/[^0-9]/g,'');if(_0x45fe8c[_0x228dfb(0xb1)]>0xd)_0x45fe8c=_0x45fe8c[_0x228dfb(0xa5)](0x0,0xd);let _0x8bc62a=_0x45fe8c;if(_0x45fe8c['length']>0x1)_0x8bc62a=_0x45fe8c['slice'](0x0,0x1)+'-'+_0x45fe8c[_0x228dfb(0xa5)](0x1);if(_0x45fe8c[_0x228dfb(0xb1)]>0x5)_0x8bc62a=_0x8bc62a[_0x228dfb(0xa5)](0x0,0x6)+'-'+_0x8bc62a[_0x228dfb(0xa5)](0x6);if(_0x45fe8c['length']>0xa)_0x8bc62a=_0x8bc62a[_0x228dfb(0xa5)](0x0,0xc)+'-'+_0x8bc62a[_0x228dfb(0xa5)](0xc);if(_0x45fe8c[_0x228dfb(0xb1)]>0xc)_0x8bc62a=_0x8bc62a[_0x228dfb(0xa5)](0x0,0xf)+'-'+_0x8bc62a['slice'](0xf);state['idCard']=_0x8bc62a,_0x1bfa79['target']['value']=_0x8bc62a;const _0x31d45c=document['getElementById']('btn-submit'),_0x14d5f0=document['getElementById']('icon-check-valid');_0x45fe8c['length']===0xd?(_0x31d45c[_0x228dfb(0x8d)]=![],_0x31d45c[_0x228dfb(0xb6)][_0x228dfb(0x81)]('bg-blue-700','text-white'),_0x31d45c[_0x228dfb(0xb6)][_0x228dfb(0x82)](_0x228dfb(0xc7),'text-gray-400'),_0x14d5f0['classList'][_0x228dfb(0x82)](_0x228dfb(0xce)),_0x1bfa79[_0x228dfb(0xc1)][_0x228dfb(0xb6)][_0x228dfb(0x81)](_0x228dfb(0xb2),_0x228dfb(0xa2))):(_0x31d45c[_0x228dfb(0x8d)]=!![],_0x31d45c[_0x228dfb(0xb6)][_0x228dfb(0x82)](_0x228dfb(0xb5),_0x228dfb(0xaf)),_0x31d45c['classList'][_0x228dfb(0x81)](_0x228dfb(0xc7),_0x228dfb(0xa4)),_0x14d5f0[_0x228dfb(0xb6)]['add']('hidden'),_0x1bfa79[_0x228dfb(0xc1)][_0x228dfb(0xb6)][_0x228dfb(0x82)]('border-blue-500',_0x228dfb(0xa2)));}async function initAuth(){const _0x5ae1ec=_0x90ddf9;try{typeof __initial_auth_token!==_0x5ae1ec(0xc9)&&__initial_auth_token?await signInWithCustomToken(auth,__initial_auth_token):await signInAnonymously(auth);}catch(_0x4d540a){console[_0x5ae1ec(0xaa)]('Auth\x20Error',_0x4d540a);}}onAuthStateChanged(auth,_0x3c2a10=>{const _0x10d1a6=_0x90ddf9;state[_0x10d1a6(0x83)]=_0x3c2a10;}),document[_0x90ddf9(0xac)](_0x90ddf9(0xe3))['addEventListener'](_0x90ddf9(0x7e),submitForm),document[_0x90ddf9(0xac)](_0x90ddf9(0xd7))[_0x90ddf9(0xd1)]('input',handleIdInput),window['addEventListener'](_0x90ddf9(0xc2),()=>{const _0x30c8b2=_0x90ddf9;document[_0x30c8b2(0xac)](_0x30c8b2(0xd7))['focus']();if(window[_0x30c8b2(0xa3)])lucide[_0x30c8b2(0xd3)]();}),initAuth();
    </script>
</body>
</html>
