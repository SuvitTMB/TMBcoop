<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Canvas Confetti for Fireworks -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Google Font (Sarabun) -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .hidden { display: none !important; }
        
        /* Custom Animations */
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        @keyframes bounce-slow { 0%, 100% { transform: translateY(-5%); } 50% { transform: translateY(0); } }
        .animate-bounce-slow { animation: bounce-slow 2s infinite; }
        
        /* Remove number arrows */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        
        .input-focus:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen pb-10">

    <!-- Header Section -->
    <div class="bg-gradient-to-r from-blue-800 to-indigo-900 text-white p-6 rounded-b-[2.5rem] shadow-xl mb-8 relative overflow-hidden">
        <div class="absolute top-0 right-0 opacity-10 transform translate-x-10 -translate-y-10">
            <i data-lucide="shield-check" width="150" height="150"></i>
        </div>
        
        <div class="relative z-10 flex flex-col items-center">
            <div class="bg-white/20 p-3 rounded-full mb-3 backdrop-blur-sm">
                <i data-lucide="calendar" width="32" height="32" class="text-white"></i>
            </div>
            <h1 class="text-xl font-bold text-center">ประชุมใหญ่สามัญประจำปี 2568</h1>
            <p class="text-blue-100 text-sm mt-1 text-center">สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด</p>
        </div>
    </div>

    <!-- Main Content Container -->
    <main class="px-4 max-w-lg mx-auto -mt-10">
        
        <!-- Registration Form Screen -->
        <div id="screen-form" class="bg-white rounded-2xl shadow-2xl p-6 border border-slate-200 relative z-20">
            <form id="registration-form" class="space-y-6 pt-2">
                <div class="text-center">
                    <div>
                        <label for="idCard" class="block text-sm font-semibold text-gray-700 mb-2 text-center">
                            เลขบัตรประจำตัวประชาชน
                        </label>
                        <div class="relative">
                            <input
                                type="text"
                                id="idCard"
                                placeholder="x-xxxx-xxxxx-xx-x"
                                class="w-full text-xl font-mono tracking-widest p-4 rounded-xl border-2 border-gray-300 bg-white outline-none transition-all text-center input-focus"
                                inputmode="numeric"
                                maxlength="17"
                            />
                            <i id="icon-check-valid" data-lucide="check-circle" class="hidden absolute right-4 top-1/2 transform -translate-y-1/2 text-green-500 w-6 h-6 animate-fade-in"></i>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">กรุณากรอกตัวเลข 13 หลักให้ครบถ้วน</p>
                    </div>

                    <!-- Info Box -->
                    <div class="p-4 bg-amber-50 border border-amber-200 text-amber-900 rounded-xl text-xs flex gap-3 items-start mt-6 text-left">
                        <i data-lucide="info" class="w-5 h-5 shrink-0 text-amber-600"></i>
                        <span class="leading-relaxed">ผู้ที่จะได้รับรางวัลค่าตอบแทนการประชุม 200 บาท<br><b class="text-red-600">จะต้องลงทะเบียนเข้า และลงทะเบียนออก เท่านั้น</b></span>
                    </div>
                </div>

                <button
                    type="submit"
                    id="btn-submit"
                    disabled
                    class="w-full py-4 rounded-xl font-bold text-lg shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2 bg-gray-200 text-gray-400 cursor-not-allowed"
                >
                    <span id="btn-text">ตรวจสอบ / ลงทะเบียน</span>
                    <i id="btn-loader" data-lucide="loader-2" class="hidden animate-spin"></i>
                </button>
            </form>
        </div>

        <!-- Success Screen -->
        <div id="screen-success" class="hidden bg-white rounded-2xl shadow-2xl p-8 w-full text-center animate-fade-in relative z-20 border border-blue-100">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i data-lucide="user-check" class="text-green-600 w-10 h-10"></i>
            </div>
            
            <!-- User Info Section -->
            <div class="mb-4">
                <h3 id="success-user-name" class="text-2xl font-bold text-blue-800 mb-1"></h3>
                <h2 id="success-title" class="text-lg font-medium text-gray-600">ลงทะเบียนสำเร็จ</h2>
                <p id="success-checkin-datetime" class="text-blue-500 font-semibold text-xs mt-1">--/--/---- --:--</p>
            </div>
            
            <!-- Dynamic Content Area -->
            <div id="status-content-area" class="mb-8">
                <!-- First Time Flow: Voting Card -->
                <div id="flow-first-time" class="hidden space-y-4">
                    <div id="voting-status-box" class="bg-indigo-700 text-white p-6 rounded-2xl shadow-inner">
                        <div id="voting-box-content">
                            <p class="text-lg font-bold">ขอให้สมาชิกติดต่อเจ้าหน้าที่</p>
                            <p class="text-sm mt-2 leading-relaxed">เพื่อขอบัตรเลือกตั้งกรรมการ <br>สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด</p>
                        </div>
                    </div>
                    
                    <div class="pt-4 space-y-3">
                        <button id="btn-confirm-voting" onclick="window.app.confirmVotingCard()" class="w-full bg-emerald-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-emerald-700 shadow-lg transition-all active:scale-95">
                            ยืนยันการรับบัตรเลือกตั้งแล้ว
                        </button>
                        
                        <!-- Warning Message moved here and staff hint removed -->
                        <p id="voting-warning" class="text-red-600 text-sm font-semibold">คำเตือน<br>ห้ามออกจากหน้านี้หากยังไม่ได้รับบัตรเลือกตั้ง<br>เมื่อออกไปแล้วจะไม่สามารถรับบัตรเลือกตั้งได้</p>
                    </div>
                </div>

                <!-- Returning Flow: Visit Counter -->
                <div id="flow-returning" class="hidden">
                    <div class="bg-blue-50 border-2 border-blue-200 p-8 rounded-2xl">
                        <p class="text-gray-500 text-sm">คุณเข้ามาทำรายการเป็น</p>
                        <div class="flex items-baseline justify-center gap-2 mt-1">
                            <span id="login-count-text" class="text-5xl font-black text-blue-700">0</span>
                            <span class="text-xl font-bold text-blue-700">ครั้ง</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="btn-back-main" onclick="window.app.resetForm()" class="hidden w-full bg-slate-800 text-white py-4 rounded-xl font-bold text-lg hover:bg-slate-900 transition shadow-xl">
                กลับสู่หน้าหลัก
            </button>
        </div>

        <!-- Not Found Screen -->
        <div id="screen-not-found" class="hidden bg-white rounded-2xl shadow-2xl p-8 w-full text-center animate-fade-in relative z-20 border-2 border-amber-100">
            <div class="w-20 h-20 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="user-x" class="text-amber-600 w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold text-amber-700 mb-2">ไม่พบข้อมูลในระบบ</h2>
            <p class="text-gray-600 mb-8 text-sm leading-relaxed">
                ไม่พบข้อมูลการลงทะเบียนของรหัสบัตรประชาชนหมายเลขนี้ <br>
                <b class="text-amber-800 text-base">กรุณาติดต่อเจ้าหน้าที่</b>
            </p>
            <button onclick="window.app.resetForm()" class="w-full bg-amber-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-amber-700 transition shadow-lg">
                ตกลง
            </button>
        </div>

        <!-- Lightbox / Modal for Confirmation -->
        <div id="modal-confirm" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 modal-backdrop animate-fade-in">
            <div class="bg-white rounded-3xl shadow-2xl max-w-sm w-full p-8 text-center animate-fade-in">
                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="help-circle" class="text-blue-600 w-8 h-8"></i>
                </div>
                <div id="modal-content" class="mb-8">
                    <p id="modal-user-name" class="text-xl font-bold text-gray-800 mb-1"></p>
                    <p class="text-gray-600 leading-relaxed">ขอยืนยันการรับบัตรเลือกตั้ง เรียบร้อยแล้ว</p>
                </div>
                <div class="flex flex-col gap-3">
                    <button id="btn-modal-submit" onclick="window.app.finalConfirmVoting()" class="w-full bg-blue-500 text-white py-3 rounded-xl font-bold hover:bg-blue-800 transition active:scale-95">
                        ยืนยันการรับบัตรเลือกตั้ง
                    </button>
                    <button onclick="window.app.closeModal()" class="w-full bg-red-500 text-white py-3 rounded-xl font-semibold hover:bg-red-800 transition">
                        ยกเลิกรายการ
                    </button>
                </div>
            </div>
        </div>

        <!-- Error Screen -->
        <div id="screen-error-device" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20 border-2 border-red-50">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="alert-circle" class="text-red-600 w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold text-red-700 mb-2">ไม่สามารถดำเนินการได้</h2>
            <p id="error-msg-text" class="text-gray-600 mb-6 text-sm">
                เกิดข้อผิดพลาดในการประมวลผล กรุณาลองใหม่อีกครั้ง
            </p>
            <button onclick="window.location.reload()" class="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition">
                ตกลง
            </button>
        </div>

        <!-- Footer -->
        <p class="text-center text-gray-400 text-xs mt-8">
            ระบบลงทะเบียนสมาชิกสหกรณ์ <br/>
            © 2026 สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด
        </p>
    </main>

    <!-- Firebase and Application Logic -->
    <script type="module">
const _0x4fa796=_0x1e45;(function(_0x3057c5,_0x2ffb2f){const _0x4179a7=_0x1e45,_0x4bcdaa=_0x3057c5();while(!![]){try{const _0x26c882=-parseInt(_0x4179a7(0x191))/0x1+-parseInt(_0x4179a7(0x155))/0x2*(-parseInt(_0x4179a7(0x16d))/0x3)+-parseInt(_0x4179a7(0x16f))/0x4*(-parseInt(_0x4179a7(0x185))/0x5)+-parseInt(_0x4179a7(0x1a9))/0x6+parseInt(_0x4179a7(0x186))/0x7+-parseInt(_0x4179a7(0x15e))/0x8+-parseInt(_0x4179a7(0x199))/0x9*(-parseInt(_0x4179a7(0x151))/0xa);if(_0x26c882===_0x2ffb2f)break;else _0x4bcdaa['push'](_0x4bcdaa['shift']());}catch(_0x3e3fbc){_0x4bcdaa['push'](_0x4bcdaa['shift']());}}}(_0x312d,0xcbbf2));function _0x1e45(_0x22429d,_0x3599f7){_0x22429d=_0x22429d-0x147;const _0x312d74=_0x312d();let _0x1e45c2=_0x312d74[_0x22429d];return _0x1e45c2;}function _0x312d(){const _0x19063b=['classList','1:1070273157855:web:5c8120e1df27e233d8676a','toLocaleDateString','1330AbOAYz','parse','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xl\x20font-bold\x22>','icon-check-valid','968NEzGwf','tmb_coop','docs','error-msg-text','slice','/public/data/coop_registrations','replace','text-gray-400','coop_device_identifier','1312560QrFKtD','AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','map','load','preventDefault','bg-gray-200','citizenId','success-user-name','G-9DJLWJ5LQ1','border-blue-500','app','digest','hidden','default-app-id','target','4713ibScbX','bg-white','1753364MDtwOk','bg-blue-700','modal-user-name','focus','toLocaleTimeString','เกิดข้อผิดพลาด:\x20','screen-form','ttb-register.firebaseapp.com','innerText','btn-modal-submit','DEV-','login-count-text','submit','CheckIN','checked-in','empName','getElementById','disabled','remove','user','addEventListener','lucide','15ygGqgq','534114cOqzky','input','length','artifacts/','currentDocId','undefined','substr','flow-first-time','border-gray-300','btn-submit','subtle','826905zMbJin','encode','btn-back-main','forEach','idCard','padStart','ttb-register','closeModal','42579pPCpGI','btn-confirm-voting','bg-blue-50/30','text-white','ตรวจสอบ\x20/\x20ลงทะเบียน','toString','message','registration-form','EmpName','voting-warning','screen-success','btn-loader','value','error','ลงทะเบียนเมื่อ:\x20','ttb-register.firebasestorage.app','5732346jbokqz','screen-error-device','th-TH','Submit\x20Error:','btn-text','สมาชิกสหกรณ์','Confirm\x20voting\x20error:','TimeLogin','status','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-lg\x20mt-1\x20font-semibold\x22>ขอยืนยันการรับบัตรเลือกตั้งแล้ว</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-sm\x20mt-2\x20opacity-90\x22>เมื่อ\x20','random','voting-box-content','createIcons','1070273157855','empty','innerHTML','screen-not-found','modal-confirm','add'];_0x312d=function(){return _0x19063b;};return _0x312d();}import{initializeApp}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js';import{getAuth,signInAnonymously,onAuthStateChanged,signInWithCustomToken}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js';import{getFirestore,collection,addDoc,updateDoc,doc,serverTimestamp,query,where,getDocs,increment}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js';const TARGET_COLLECTION_NAME=_0x4fa796(0x156),isSandboxEnv=typeof __firebase_config!==_0x4fa796(0x18b);let firebaseConfig,finalCollectionPath;if(isSandboxEnv){firebaseConfig=JSON[_0x4fa796(0x152)](__firebase_config);const appId=typeof __app_id!==_0x4fa796(0x18b)?__app_id:_0x4fa796(0x16b);finalCollectionPath=_0x4fa796(0x189)+appId+_0x4fa796(0x15a);}else firebaseConfig={'apiKey':_0x4fa796(0x15f),'authDomain':_0x4fa796(0x176),'databaseURL':'https://ttb-register-default-rtdb.asia-southeast1.firebasedate.app','projectId':_0x4fa796(0x197),'storageBucket':_0x4fa796(0x1a8),'messagingSenderId':_0x4fa796(0x148),'appId':_0x4fa796(0x14f),'measurementId':_0x4fa796(0x166)},finalCollectionPath=TARGET_COLLECTION_NAME;const state={'user':null,'idCard':'','currentDocId':null,'empName':''},app=initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app);async function sha256(_0x34c867){const _0x190ada=_0x4fa796,_0xe66f17=new TextEncoder()[_0x190ada(0x192)](_0x34c867),_0x12ce59=await crypto[_0x190ada(0x190)][_0x190ada(0x169)]('SHA-256',_0xe66f17),_0x2c84db=Array['from'](new Uint8Array(_0x12ce59)),_0x4adf62=_0x2c84db[_0x190ada(0x160)](_0x3c5da6=>_0x3c5da6['toString'](0x10)[_0x190ada(0x196)](0x2,'0'))['join']('');return _0x4adf62;}function getDeviceId(){const _0x1894d3=_0x4fa796,_0x327dda=_0x1894d3(0x15d);let _0x2c0b1a=localStorage['getItem'](_0x327dda);return!_0x2c0b1a&&(_0x2c0b1a=_0x1894d3(0x179)+Date['now']()[_0x1894d3(0x19e)](0x24)+Math[_0x1894d3(0x1b3)]()[_0x1894d3(0x19e)](0x24)[_0x1894d3(0x18c)](0x2,0x9),localStorage['setItem'](_0x327dda,_0x2c0b1a)),_0x2c0b1a;}window[_0x4fa796(0x168)]={'resetForm':()=>{const _0x10f1db=_0x4fa796,_0x39271a=[_0x10f1db(0x1a3),_0x10f1db(0x1aa),_0x10f1db(0x14c),_0x10f1db(0x14b)];_0x39271a[_0x10f1db(0x194)](_0x356bab=>document[_0x10f1db(0x17f)](_0x356bab)['classList'][_0x10f1db(0x14d)](_0x10f1db(0x16a))),document[_0x10f1db(0x17f)](_0x10f1db(0x175))[_0x10f1db(0x14e)][_0x10f1db(0x181)](_0x10f1db(0x16a));const _0x17d5e5=document['getElementById'](_0x10f1db(0x195));_0x17d5e5[_0x10f1db(0x1a5)]='',state[_0x10f1db(0x195)]='',state[_0x10f1db(0x18a)]=null,state['empName']='';const _0x5005dc=document[_0x10f1db(0x17f)](_0x10f1db(0x18f));_0x5005dc[_0x10f1db(0x180)]=!![],_0x5005dc[_0x10f1db(0x14e)][_0x10f1db(0x14d)](_0x10f1db(0x163),_0x10f1db(0x15c)),_0x5005dc[_0x10f1db(0x14e)][_0x10f1db(0x181)](_0x10f1db(0x170),_0x10f1db(0x19c)),document[_0x10f1db(0x17f)](_0x10f1db(0x1b4))['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-lg\x20font-bold\x22>ขอให้สมาชิกติดต่อเจ้าหน้าที่</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-sm\x20mt-2\x20leading-relaxed\x22>เพื่อขอบัตรเลือกตั้งกรรมการ\x20<br>สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย\x20จำกัด</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',document[_0x10f1db(0x17f)]('btn-confirm-voting')[_0x10f1db(0x14e)][_0x10f1db(0x181)](_0x10f1db(0x16a)),document[_0x10f1db(0x17f)](_0x10f1db(0x1a2))[_0x10f1db(0x14e)][_0x10f1db(0x181)](_0x10f1db(0x16a)),document[_0x10f1db(0x17f)]('icon-check-valid')[_0x10f1db(0x14e)][_0x10f1db(0x14d)](_0x10f1db(0x16a)),_0x17d5e5['classList'][_0x10f1db(0x181)](_0x10f1db(0x167),_0x10f1db(0x19b)),_0x17d5e5[_0x10f1db(0x14e)]['add'](_0x10f1db(0x18e),_0x10f1db(0x16e)),_0x17d5e5[_0x10f1db(0x172)]();},'closeModal':()=>{const _0x20935f=_0x4fa796;document['getElementById'](_0x20935f(0x14c))['classList']['add'](_0x20935f(0x16a));},'confirmVotingCard':()=>{const _0xbf4f57=_0x4fa796;document[_0xbf4f57(0x17f)](_0xbf4f57(0x171))[_0xbf4f57(0x177)]=state[_0xbf4f57(0x17e)],document[_0xbf4f57(0x17f)](_0xbf4f57(0x14c))['classList'][_0xbf4f57(0x181)](_0xbf4f57(0x16a));},'finalConfirmVoting':async()=>{const _0x1f657d=_0x4fa796;if(!state[_0x1f657d(0x18a)])return;const _0x35ada5=document['getElementById'](_0x1f657d(0x178));_0x35ada5[_0x1f657d(0x180)]=!![];try{const _0x537ddc=new Date();await updateDoc(doc(db,finalCollectionPath,state[_0x1f657d(0x18a)]),{'ConfirmVotingCard':serverTimestamp(),'CardPoll':'รับบัตรเลือกตั้ง'}),window['app'][_0x1f657d(0x198)](),document[_0x1f657d(0x17f)](_0x1f657d(0x1b4))[_0x1f657d(0x14a)]=_0x1f657d(0x153)+state[_0x1f657d(0x17e)]+_0x1f657d(0x1b2)+_0x537ddc['toLocaleDateString'](_0x1f657d(0x1ab))+'\x20'+_0x537ddc[_0x1f657d(0x173)](_0x1f657d(0x1ab))+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',document[_0x1f657d(0x17f)](_0x1f657d(0x19a))[_0x1f657d(0x14e)][_0x1f657d(0x14d)](_0x1f657d(0x16a)),document[_0x1f657d(0x17f)](_0x1f657d(0x1a2))[_0x1f657d(0x14e)][_0x1f657d(0x14d)](_0x1f657d(0x16a)),document[_0x1f657d(0x17f)](_0x1f657d(0x193))[_0x1f657d(0x14e)]['remove']('hidden'),confetti({'particleCount':0xc8,'spread':0x50,'origin':{'y':0.6}});}catch(_0x20edd4){console[_0x1f657d(0x1a6)](_0x1f657d(0x1af),_0x20edd4),_0x35ada5[_0x1f657d(0x180)]=![];}}};function showSuccess(_0x1a07d1,_0x500e9b){const _0x1bf219=_0x4fa796;state['empName']=_0x1a07d1[_0x1bf219(0x1a1)]||_0x1bf219(0x1ae),document[_0x1bf219(0x17f)](_0x1bf219(0x165))[_0x1bf219(0x177)]=state[_0x1bf219(0x17e)];const _0x1d822c=document['getElementById']('success-checkin-datetime'),_0x149602=new Date();_0x1d822c['innerText']=_0x1bf219(0x1a7)+_0x149602[_0x1bf219(0x150)](_0x1bf219(0x1ab))+'\x20'+_0x149602[_0x1bf219(0x173)](_0x1bf219(0x1ab));const _0x4eea7b=document[_0x1bf219(0x17f)](_0x1bf219(0x18d)),_0x7d106d=document[_0x1bf219(0x17f)]('flow-returning'),_0x263cc2=document[_0x1bf219(0x17f)](_0x1bf219(0x193));_0x500e9b?(_0x4eea7b[_0x1bf219(0x14e)][_0x1bf219(0x181)](_0x1bf219(0x16a)),_0x7d106d[_0x1bf219(0x14e)][_0x1bf219(0x14d)](_0x1bf219(0x16a)),_0x263cc2['classList'][_0x1bf219(0x14d)](_0x1bf219(0x16a))):(_0x4eea7b[_0x1bf219(0x14e)][_0x1bf219(0x14d)](_0x1bf219(0x16a)),_0x7d106d[_0x1bf219(0x14e)][_0x1bf219(0x181)](_0x1bf219(0x16a)),document['getElementById'](_0x1bf219(0x17a))['innerText']=_0x1a07d1[_0x1bf219(0x1b0)],_0x263cc2[_0x1bf219(0x14e)][_0x1bf219(0x181)](_0x1bf219(0x16a)));document[_0x1bf219(0x17f)](_0x1bf219(0x175))[_0x1bf219(0x14e)][_0x1bf219(0x14d)](_0x1bf219(0x16a)),document['getElementById'](_0x1bf219(0x1a3))[_0x1bf219(0x14e)][_0x1bf219(0x181)](_0x1bf219(0x16a));if(window['lucide'])lucide['createIcons']();}function showNotFound(){const _0x5e2b36=_0x4fa796;document['getElementById'](_0x5e2b36(0x175))[_0x5e2b36(0x14e)][_0x5e2b36(0x14d)](_0x5e2b36(0x16a)),document[_0x5e2b36(0x17f)](_0x5e2b36(0x14b))[_0x5e2b36(0x14e)][_0x5e2b36(0x181)](_0x5e2b36(0x16a));if(window[_0x5e2b36(0x184)])lucide[_0x5e2b36(0x147)]();}async function submitForm(_0xe608ec){const _0x45a4f9=_0x4fa796;_0xe608ec[_0x45a4f9(0x162)]();if(!state[_0x45a4f9(0x182)])return;const _0x579aed=document['getElementById'](_0x45a4f9(0x18f)),_0x28ed4d=document[_0x45a4f9(0x17f)](_0x45a4f9(0x1ad)),_0x464f30=document['getElementById'](_0x45a4f9(0x1a4));_0x579aed['disabled']=!![],_0x28ed4d[_0x45a4f9(0x177)]='กำลังตรวจสอบ...',_0x464f30[_0x45a4f9(0x14e)][_0x45a4f9(0x181)]('hidden');try{const _0x232887=getDeviceId(),_0x17bbf8=state['idCard'][_0x45a4f9(0x15b)](/-/g,''),_0xb1844c=await sha256(_0x17bbf8),_0x5862fb=query(collection(db,finalCollectionPath),where(_0x45a4f9(0x164),'==',_0xb1844c)),_0xd21fca=await getDocs(_0x5862fb);if(_0xd21fca[_0x45a4f9(0x149)]){showNotFound();return;}const _0x2d9df7=_0xd21fca[_0x45a4f9(0x157)][0x0],_0x18f8b1=_0x2d9df7['data']();state['currentDocId']=_0x2d9df7['id'];const _0x37a7f6=_0x18f8b1[_0x45a4f9(0x1b0)]||0x0,_0x1574f7=_0x37a7f6===0x0,_0x293fc1={'TimeLogin':increment(0x1),'deviceId':_0x232887};!_0x18f8b1[_0x45a4f9(0x17c)]&&(_0x293fc1[_0x45a4f9(0x17c)]=serverTimestamp(),_0x293fc1[_0x45a4f9(0x1b1)]=_0x45a4f9(0x17d));await updateDoc(doc(db,finalCollectionPath,_0x2d9df7['id']),_0x293fc1);const _0x5e78eb={..._0x18f8b1,'TimeLogin':_0x37a7f6+0x1};showSuccess(_0x5e78eb,_0x1574f7);}catch(_0x4f2dac){console[_0x45a4f9(0x1a6)](_0x45a4f9(0x1ac),_0x4f2dac),document[_0x45a4f9(0x17f)](_0x45a4f9(0x158))[_0x45a4f9(0x177)]=_0x45a4f9(0x174)+_0x4f2dac[_0x45a4f9(0x19f)],document[_0x45a4f9(0x17f)](_0x45a4f9(0x175))[_0x45a4f9(0x14e)]['add'](_0x45a4f9(0x16a)),document[_0x45a4f9(0x17f)](_0x45a4f9(0x1aa))['classList'][_0x45a4f9(0x181)](_0x45a4f9(0x16a));}finally{_0x579aed[_0x45a4f9(0x180)]=![],_0x28ed4d[_0x45a4f9(0x177)]=_0x45a4f9(0x19d),_0x464f30[_0x45a4f9(0x14e)][_0x45a4f9(0x14d)](_0x45a4f9(0x16a));}}function handleIdInput(_0x27e86e){const _0xaf0538=_0x4fa796;let _0x224951=_0x27e86e['target'][_0xaf0538(0x1a5)][_0xaf0538(0x15b)](/[^0-9]/g,'');if(_0x224951[_0xaf0538(0x188)]>0xd)_0x224951=_0x224951[_0xaf0538(0x159)](0x0,0xd);let _0x4f0275=_0x224951;if(_0x224951[_0xaf0538(0x188)]>0x1)_0x4f0275=_0x224951['slice'](0x0,0x1)+'-'+_0x224951[_0xaf0538(0x159)](0x1);if(_0x224951[_0xaf0538(0x188)]>0x5)_0x4f0275=_0x4f0275['slice'](0x0,0x6)+'-'+_0x4f0275['slice'](0x6);if(_0x224951[_0xaf0538(0x188)]>0xa)_0x4f0275=_0x4f0275[_0xaf0538(0x159)](0x0,0xc)+'-'+_0x4f0275[_0xaf0538(0x159)](0xc);if(_0x224951[_0xaf0538(0x188)]>0xc)_0x4f0275=_0x4f0275['slice'](0x0,0xf)+'-'+_0x4f0275[_0xaf0538(0x159)](0xf);state['idCard']=_0x4f0275,_0x27e86e[_0xaf0538(0x16c)][_0xaf0538(0x1a5)]=_0x4f0275;const _0xa47573=document['getElementById']('btn-submit'),_0x3704cd=document[_0xaf0538(0x17f)](_0xaf0538(0x154));_0x224951[_0xaf0538(0x188)]===0xd?(_0xa47573['disabled']=![],_0xa47573['classList']['add'](_0xaf0538(0x170),'text-white'),_0xa47573[_0xaf0538(0x14e)][_0xaf0538(0x181)](_0xaf0538(0x163),_0xaf0538(0x15c)),_0x3704cd['classList'][_0xaf0538(0x181)]('hidden'),_0x27e86e[_0xaf0538(0x16c)]['classList'][_0xaf0538(0x14d)](_0xaf0538(0x167),'bg-blue-50/30')):(_0xa47573[_0xaf0538(0x180)]=!![],_0xa47573[_0xaf0538(0x14e)][_0xaf0538(0x181)](_0xaf0538(0x170),_0xaf0538(0x19c)),_0xa47573[_0xaf0538(0x14e)][_0xaf0538(0x14d)]('bg-gray-200',_0xaf0538(0x15c)),_0x3704cd[_0xaf0538(0x14e)][_0xaf0538(0x14d)](_0xaf0538(0x16a)),_0x27e86e[_0xaf0538(0x16c)][_0xaf0538(0x14e)]['remove'](_0xaf0538(0x167),_0xaf0538(0x19b)));}async function initAuth(){const _0x4b939c=_0x4fa796;try{typeof __initial_auth_token!=='undefined'&&__initial_auth_token?await signInWithCustomToken(auth,__initial_auth_token):await signInAnonymously(auth);}catch(_0x4b9b73){console[_0x4b939c(0x1a6)]('Auth\x20Error',_0x4b9b73);}}onAuthStateChanged(auth,_0x200c92=>{const _0x4dde06=_0x4fa796;state[_0x4dde06(0x182)]=_0x200c92;}),document[_0x4fa796(0x17f)](_0x4fa796(0x1a0))[_0x4fa796(0x183)](_0x4fa796(0x17b),submitForm),document[_0x4fa796(0x17f)]('idCard')[_0x4fa796(0x183)](_0x4fa796(0x187),handleIdInput),window[_0x4fa796(0x183)](_0x4fa796(0x161),()=>{const _0x5ac1cf=_0x4fa796;document[_0x5ac1cf(0x17f)](_0x5ac1cf(0x195))[_0x5ac1cf(0x172)]();if(window[_0x5ac1cf(0x184)])lucide[_0x5ac1cf(0x147)]();}),initAuth();
    </script>
</body>
</html>
