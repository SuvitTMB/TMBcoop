<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Font (Sarabun) -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .hidden { display: none !important; }
        /* Custom Animations */
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        /* Remove number arrows */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-10">

    <!-- Header Section -->
    <div class="bg-gradient-to-r from-blue-700 to-indigo-800 text-white p-6 rounded-b-[2.5rem] shadow-lg mb-8 relative overflow-hidden">
        <div class="absolute top-0 right-0 opacity-10 transform translate-x-10 -translate-y-10">
            <i data-lucide="shield-check" width="150" height="150"></i>
        </div>
        
        <div class="relative z-10 flex flex-col items-center">
            <div class="bg-white/20 p-3 rounded-full mb-3 backdrop-blur-sm">
                <i data-lucide="user" width="32" height="32" class="text-white"></i>
            </div>
            <h1 class="text-xl font-bold text-center">ลงทะเบียนสมาชิก</h1>
            <p class="text-blue-100 text-sm mt-1">สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด</p>
        </div>
    </div>

    <!-- Main Content Container -->
    <main class="px-2 sm:px-4 max-w-lg mx-auto -mt-10">
        
        <!-- Registration Form Screen -->
        <div id="screen-form" class="bg-white rounded-2xl shadow-xl p-6 border border-slate-100 relative z-20">
            
            <form id="registration-form" class="space-y-6 pt-2">
                <center>
                <!-- Single Input ID Card -->
                <div>
                    <label for="idCard" class="block text-sm font-semibold text-gray-700 mb-2">
                        เลขบัตรประจำตัวประชาชน
                    </label>
                    <div class="relative">
                        <input
                            type="text"
                            id="idCard"
                            placeholder="x-xxxx-xxxxx-xx-x"
                            class="w-full text-xl font-mono tracking-wide p-4 rounded-xl border-2 border-gray-200 bg-white focus:border-blue-400 focus:ring-4 focus:ring-blue-100 outline-none transition-all text-center"
                            inputmode="numeric"
                            maxlength="17"
                        />
                        <i id="icon-check-valid" data-lucide="check-circle" class="hidden absolute right-4 top-1/2 transform -translate-y-1/2 text-green-500 w-6 h-6 animate-fade-in"></i>
                    </div>
                    <p class="text-xs text-gray-400 mt-2 ml-1">กรุณากรอกตัวเลข 13 หลักให้ครบถ้วน</p>
                </div>

                <!-- Info Box -->
                <div class="p-3 bg-blue-50 text-blue-800 rounded-lg text-xs flex gap-2 items-start" style="margin-top:25px; text-align: left;">
                    <i data-lucide="info" class="w-4 h-4 shrink-0 mt-0.5"></i>
                    <span>จำกัดสิทธิ์ 1 เครื่องโทรศัพท์ต่อ 1 หมายเลขบัตรฯ เท่านั้น<br>ผู้ที่จะได้รับรางวัลค่าตอบแทนการประชุม 200 บาทจะต้องลงทะเบียนเข้า และลงทะเบียนออก เท่านั้น</span>
                </div>
                </center>

                <!-- Submit Button -->
                <button
                    type="submit"
                    id="btn-submit"
                    disabled
                    class="w-full py-3 rounded-lg font-semibold text-base shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2 bg-gray-200 text-gray-400 cursor-not-allowed shadow-none"
                >
                    <span id="btn-text">ตรวจสอบ / ลงทะเบียน</span>
                    <i id="btn-loader" data-lucide="loader-2" class="hidden animate-spin"></i>
                </button>
            </form>
        </div>

        <!-- Success Screen -->
        <!-- Removed 'max-w-sm' to match width with registration form -->
        <div id="screen-success" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i data-lucide="check-circle" class="text-green-600 w-10 h-10"></i>
            </div>
            
            <!-- Added Name Display -->
            <h3 id="success-user-name" class="text-lg font-bold text-blue-600 mb-2 hidden"></h3>

            <h2 id="success-title" class="text-xl font-bold text-gray-800 mb-1">ลงทะเบียนสำเร็จ</h2>
            <p id="success-checkin-datetime" class="text-blue-600 font-medium mb-6 text-xs">--/--/---- --:--</p>
            
            <!-- Agenda Box -->
            <div class="bg-blue-50 border border-blue-100 rounded-xl p-5 mb-6 text-left shadow-sm">
                <h3 class="font-bold text-blue-900 mb-3 text-lg flex items-center gap-2 border-b border-blue-200 pb-2">
                    <i data-lucide="calendar-days" width="20"></i> กำหนดการประชุมสมาชิกฯ
                </h3>
                <ol class="list-decimal pl-5 space-y-2 text-sm text-gray-700">
                    <li>เรื่องแจ้งสมาชิก</li>
                    <li>รายงานผลประกอบการ</li>
                    <li>ประกาศผลการเลือกตั้งประธานฯ</li>
                    <li>ประกาศผลการเลือกตั้งกรรมการฯ</li>
                    <li>ลุ้นรางวัลพิเศษ 50 รางว้ล</li>
                </ol>
            </div>
            
            <button onclick="window.app.resetForm()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-semibold hover:bg-blue-700 transition shadow-lg shadow-blue-200">
                กลับสู่หน้าหลัก
            </button>
        </div>

        <!-- Error Screen (Device Limit) -->
        <div id="screen-error-device" class="hidden bg-white rounded-2xl shadow-xl p-8 max-w-sm w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="alert-triangle" class="text-red-600 w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold text-red-700 mb-2">ไม่สามารถดำเนินการได้</h2>
            <p id="error-msg-text" class="text-gray-600 mb-6 text-sm">
                คุณไม่สามารถลงทะเบียนใหม่ได้อีก <br/>
                (เครื่องนี้ถูกใช้งานไปแล้ว)
            </p>
            
            <!-- NEW DEBUG/RESET BUTTON -->
            <button onclick="window.app.clearDeviceLocks()" class="w-full bg-red-100 text-red-700 py-3 rounded-xl font-semibold hover:bg-red-200 transition mb-3">
                <i data-lucide="wrench" class="inline w-4 h-4 mr-2"></i>
                รีเซ็ตข้อมูลเครื่องนี้ (สำหรับแก้ไขปัญหา)
            </button>
            
            <button onclick="window.location.reload()" class="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition">
                ปิด
            </button>
        </div>

        <!-- Not Found Screen -->
        <div id="screen-not-found" class="hidden bg-white rounded-2xl shadow-xl p-8 max-w-sm w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="user-x" class="text-amber-600 w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold text-amber-700 mb-2">ไม่มีข้อมูลในระบบ</h2>
            <p class="text-gray-600 mb-6 text-sm">
                ไม่พบเลขบัตรประชาชนนี้ในฐานข้อมูล <br/>
                กรุณาตรวจสอบความถูกต้อง
            </p>
            <button onclick="window.app.resetForm()" class="w-full bg-amber-500 text-white py-3 rounded-xl font-semibold hover:bg-amber-600 transition shadow-lg shadow-amber-200">
                ปิด
            </button>
        </div>

        <!-- Footer -->
        <p class="text-center text-gray-400 text-xs mt-8">
            ระบบลงทะเบียนสมาชิกสหกรณ์ <br/>
            © 2024 สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด
        </p>
    </main>

    <!-- Firebase and Application Logic -->
    <script type="module">
const _0x2e66f3=_0x197e;(function(_0x465628,_0x4d13d5){const _0xedbcce=_0x197e,_0x2b5872=_0x465628();while(!![]){try{const _0x19b9b8=-parseInt(_0xedbcce(0x1c2))/0x1+parseInt(_0xedbcce(0x150))/0x2*(parseInt(_0xedbcce(0x17f))/0x3)+-parseInt(_0xedbcce(0x1a5))/0x4+-parseInt(_0xedbcce(0x16c))/0x5+-parseInt(_0xedbcce(0x1bb))/0x6*(parseInt(_0xedbcce(0x1b0))/0x7)+parseInt(_0xedbcce(0x154))/0x8+parseInt(_0xedbcce(0x1bc))/0x9;if(_0x19b9b8===_0x4d13d5)break;else _0x2b5872['push'](_0x2b5872['shift']());}catch(_0x576217){_0x2b5872['push'](_0x2b5872['shift']());}}}(_0x1e09,0xcc7a4));import{initializeApp}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js';import{getAuth,signInAnonymously,onAuthStateChanged,signInWithCustomToken}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js';function _0x197e(_0x506679,_0x319fa2){_0x506679=_0x506679-0x14a;const _0x1e093e=_0x1e09();let _0x197e18=_0x1e093e[_0x506679];return _0x197e18;}import{getFirestore,collection,addDoc,updateDoc,doc,serverTimestamp,query,where,getDocs}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js';const TARGET_COLLECTION_NAME=_0x2e66f3(0x14b),isSandboxEnv=typeof __firebase_config!=='undefined';let firebaseConfig,finalCollectionPath;if(isSandboxEnv){firebaseConfig=JSON[_0x2e66f3(0x18d)](__firebase_config);const appId=typeof __app_id!==_0x2e66f3(0x179)?__app_id:_0x2e66f3(0x17e);finalCollectionPath=_0x2e66f3(0x17b)+appId+_0x2e66f3(0x17a);}else firebaseConfig={'apiKey':_0x2e66f3(0x169),'authDomain':_0x2e66f3(0x155),'databaseURL':_0x2e66f3(0x15a),'projectId':_0x2e66f3(0x152),'storageBucket':_0x2e66f3(0x199),'messagingSenderId':'1070273157855','appId':_0x2e66f3(0x1b2),'measurementId':_0x2e66f3(0x177)},finalCollectionPath=TARGET_COLLECTION_NAME;const state={'user':null,'idCard':''},app=initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app);async function sha256(_0x2e7ed1){const _0x13533a=_0x2e66f3,_0x438aec=new TextEncoder()[_0x13533a(0x16e)](_0x2e7ed1),_0x41c09a=await crypto['subtle'][_0x13533a(0x1ac)](_0x13533a(0x190),_0x438aec),_0x2b863a=Array[_0x13533a(0x1b4)](new Uint8Array(_0x41c09a)),_0x38d775=_0x2b863a[_0x13533a(0x14d)](_0x5d386a=>_0x5d386a[_0x13533a(0x1a4)](0x10)[_0x13533a(0x151)](0x2,'0'))[_0x13533a(0x1aa)]('');return _0x38d775;}function getDeviceId(){const _0x157bb3=_0x2e66f3,_0x3becf2=_0x157bb3(0x15f);let _0x286d0f=localStorage[_0x157bb3(0x173)](_0x3becf2);if(!_0x286d0f){const _0x43a74e=document['cookie'][_0x157bb3(0x1af)](new RegExp(_0x157bb3(0x184)+_0x3becf2+_0x157bb3(0x1a9)));_0x43a74e&&(_0x286d0f=_0x43a74e[0x2],localStorage[_0x157bb3(0x191)](_0x3becf2,_0x286d0f));}return!_0x286d0f?(_0x286d0f=_0x157bb3(0x1a7)+Date[_0x157bb3(0x1b1)]()['toString'](0x24)+Math[_0x157bb3(0x19e)]()[_0x157bb3(0x1a4)](0x24)[_0x157bb3(0x175)](0x2,0x9),localStorage[_0x157bb3(0x191)](_0x3becf2,_0x286d0f),document[_0x157bb3(0x161)]=_0x3becf2+'='+_0x286d0f+';\x20path=/;\x20max-age=31536000'):document[_0x157bb3(0x161)]=_0x3becf2+'='+_0x286d0f+_0x157bb3(0x181),_0x286d0f;}function setLocalRegistration(_0x542c2f){const _0x26ae5e=_0x2e66f3;localStorage[_0x26ae5e(0x191)](_0x26ae5e(0x1a0),_0x542c2f);}function _0x1e09(){const _0x4ba91f=['preventDefault','ttb-register.firebasestorage.app','CheckOUT','addEventListener','Checking\x20Device:','log','random','screen-form','coop_registered_citizen_id','removeItem','CheckIN','th-TH','toString','2853908UAzrYa','shadow-none','DEV-','deviceId','=([^;]+)','join','border-gray-200','digest','empty','error-msg-text','match','35VhSHWV','now','1:1070273157855:web:5c8120e1df27e233d8676a','text-gray-400','from','ตรวจสอบ\x20/\x20ลงทะเบียน','bg-blue-50/30','toDate','เครื่องนี้ถูกใช้งานลงทะเบียนบัตรประชาชนอื่นไปแล้ว\x20(จำกัด\x201\x20เครื่อง\x20/\x201\x20ท่าน)','border-blue-500','cursor-not-allowed','1614342hijHFO','30925161ltgFKV','innerText','citizenId','screen-error-device','เครื่องนี้ถูกผูกบัญชีอื่นแล้ว\x20(ไม่สามารถลงทะเบียนใหม่ได้)','screen-success','1671435zxQUTd','toLocaleTimeString','tmb_coop','รหัสบัตรประชาชนนี้\x20ผูกกับโทรศัพท์เครื่องอื่นแล้ว<br>(ไม่สามารถเปลี่ยนเครื่องได้)','map','ลงทะเบียนเมื่อ:\x20','btn-submit','1279052GkNCRn','padStart','ttb-register','success-user-name','6592216SYJSDW','ttb-register.firebaseapp.com','load','checked-in','lucide','innerHTML','https://ttb-register-default-rtdb.asia-southeast1.firebasedate.app','status','เกิดข้อผิดพลาดในการส่งข้อมูล:\x20','currentDocId','btn-loader','coop_device_identifier','forEach','cookie','data','user','add','hover:bg-blue-700','ลงทะเบียนสำเร็จ','toLocaleString','submit','AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','remove','bg-white','4857355hWaDpK','classList','encode','EmpName','reload','getElementById','reward','getItem','createIcons','substr','replace','G-9DJLWJ5LQ1','registration-form','undefined','/public/data/coop_registrations','artifacts/','value','slice','default-app-id','6CjExJN','focus',';\x20path=/;\x20max-age=31536000','length','btn-text','(^|\x20)','text-white','target','bg-blue-600','location','กำลังตรวจสอบ...','hidden','idCard','screen-not-found','parse','disabled','success-title','SHA-256','setItem','Auth\x20failed','toLocaleDateString','icon-check-valid','bg-gray-200','error','Checking\x20ID\x20Hash:'];_0x1e09=function(){return _0x4ba91f;};return _0x1e09();}function getLocalRegistration(){const _0x3b880e=_0x2e66f3;return localStorage['getItem'](_0x3b880e(0x1a0));}window['app']={'resetForm':()=>{const _0x435c79=_0x2e66f3,_0x428c92=[_0x435c79(0x1c1),_0x435c79(0x1bf),_0x435c79(0x18c)];_0x428c92[_0x435c79(0x160)](_0x1c5b03=>document[_0x435c79(0x171)](_0x1c5b03)[_0x435c79(0x16d)][_0x435c79(0x164)]('hidden')),document[_0x435c79(0x171)](_0x435c79(0x19f))['classList'][_0x435c79(0x16a)](_0x435c79(0x18a)),document['getElementById'](_0x435c79(0x153))[_0x435c79(0x16d)][_0x435c79(0x164)](_0x435c79(0x18a));const _0x2fa37d=document[_0x435c79(0x171)](_0x435c79(0x18b));_0x2fa37d['value']='',state[_0x435c79(0x18b)]='';const _0xf8ef8a=document[_0x435c79(0x171)](_0x435c79(0x14f)),_0x53b6e2=document[_0x435c79(0x171)](_0x435c79(0x183)),_0x594204=document[_0x435c79(0x171)](_0x435c79(0x15e));_0x53b6e2[_0x435c79(0x1bd)]=_0x435c79(0x1b5),_0x594204[_0x435c79(0x16d)][_0x435c79(0x164)](_0x435c79(0x18a)),_0xf8ef8a[_0x435c79(0x18e)]=!![],_0xf8ef8a['classList'][_0x435c79(0x164)]('bg-gray-200',_0x435c79(0x1b3),_0x435c79(0x1ba),_0x435c79(0x1a6)),_0xf8ef8a[_0x435c79(0x16d)]['remove'](_0x435c79(0x187),_0x435c79(0x185),'hover:bg-blue-700','shadow-blue-200');const _0x318466=document[_0x435c79(0x171)](_0x435c79(0x194));_0x318466[_0x435c79(0x16d)][_0x435c79(0x164)](_0x435c79(0x18a)),_0x2fa37d[_0x435c79(0x16d)]['remove'](_0x435c79(0x1b9),_0x435c79(0x1b6)),_0x2fa37d[_0x435c79(0x16d)]['add'](_0x435c79(0x1ab),'bg-white'),_0x2fa37d[_0x435c79(0x180)]();},'clearDeviceLocks':()=>{const _0x1a4d8b=_0x2e66f3,_0x2a53a9=_0x1a4d8b(0x15f),_0x24bc70=_0x1a4d8b(0x1a0);localStorage[_0x1a4d8b(0x1a1)](_0x2a53a9),localStorage[_0x1a4d8b(0x1a1)](_0x24bc70),document['cookie']=_0x2a53a9+'=;\x20path=/;\x20max-age=0',window[_0x1a4d8b(0x188)][_0x1a4d8b(0x170)]();}};function updateSuccessUI(_0x2df2df,_0x32d98d,_0x4ce63c,_0x7e308c,_0x43d358,_0x4c68f0){const _0x4b4e5c=_0x2e66f3;document[_0x4b4e5c(0x171)](_0x4b4e5c(0x18f))[_0x4b4e5c(0x1bd)]=_0x43d358?_0x4b4e5c(0x166):'ท่านได้ลงทะเบียนไปแล้ว',document[_0x4b4e5c(0x171)]('success-checkin-datetime')[_0x4b4e5c(0x1bd)]=_0x4b4e5c(0x14e)+_0x2df2df;const _0x5bfb8b=document['getElementById'](_0x4b4e5c(0x153));_0x4c68f0?(_0x5bfb8b[_0x4b4e5c(0x1bd)]=_0x4c68f0,_0x5bfb8b[_0x4b4e5c(0x16d)]['remove'](_0x4b4e5c(0x18a))):_0x5bfb8b[_0x4b4e5c(0x16d)]['add'](_0x4b4e5c(0x18a)),document['getElementById'](_0x4b4e5c(0x19f))[_0x4b4e5c(0x16d)][_0x4b4e5c(0x164)](_0x4b4e5c(0x18a)),document['getElementById'](_0x4b4e5c(0x1c1))[_0x4b4e5c(0x16d)][_0x4b4e5c(0x16a)](_0x4b4e5c(0x18a));}async function initAuth(){const _0x1e8d5f=_0x2e66f3;try{typeof __initial_auth_token!==_0x1e8d5f(0x179)&&__initial_auth_token?await signInWithCustomToken(auth,__initial_auth_token):await signInAnonymously(auth);}catch(_0x3b58c5){console['error'](_0x1e8d5f(0x192),_0x3b58c5);}}onAuthStateChanged(auth,_0x589f63=>{const _0x1a6b58=_0x2e66f3;state[_0x1a6b58(0x163)]=_0x589f63;});function handleIdInput(_0x3577ba){const _0x3a6bd1=_0x2e66f3;let _0x1e81e4=_0x3577ba[_0x3a6bd1(0x186)][_0x3a6bd1(0x17c)][_0x3a6bd1(0x176)](/[^0-9]/g,'');if(_0x1e81e4[_0x3a6bd1(0x182)]>0xd)_0x1e81e4=_0x1e81e4['slice'](0x0,0xd);let _0x587ca=_0x1e81e4;if(_0x1e81e4[_0x3a6bd1(0x182)]>0x1)_0x587ca=_0x1e81e4[_0x3a6bd1(0x17d)](0x0,0x1)+'-'+_0x1e81e4[_0x3a6bd1(0x17d)](0x1);if(_0x1e81e4[_0x3a6bd1(0x182)]>0x5)_0x587ca=_0x587ca[_0x3a6bd1(0x17d)](0x0,0x6)+'-'+_0x587ca[_0x3a6bd1(0x17d)](0x6);if(_0x1e81e4[_0x3a6bd1(0x182)]>0xa)_0x587ca=_0x587ca[_0x3a6bd1(0x17d)](0x0,0xc)+'-'+_0x587ca[_0x3a6bd1(0x17d)](0xc);if(_0x1e81e4[_0x3a6bd1(0x182)]>0xc)_0x587ca=_0x587ca[_0x3a6bd1(0x17d)](0x0,0xf)+'-'+_0x587ca[_0x3a6bd1(0x17d)](0xf);state[_0x3a6bd1(0x18b)]=_0x587ca,document[_0x3a6bd1(0x171)](_0x3a6bd1(0x18b))['value']=_0x587ca;const _0x1ad9c2=document[_0x3a6bd1(0x171)](_0x3a6bd1(0x194)),_0x55dfd8=document[_0x3a6bd1(0x171)](_0x3a6bd1(0x18b));_0x1e81e4[_0x3a6bd1(0x182)]===0xd?(_0x55dfd8['classList'][_0x3a6bd1(0x164)](_0x3a6bd1(0x1b9),'bg-blue-50/30'),_0x55dfd8[_0x3a6bd1(0x16d)][_0x3a6bd1(0x16a)](_0x3a6bd1(0x1ab),_0x3a6bd1(0x16b)),_0x1ad9c2[_0x3a6bd1(0x16d)][_0x3a6bd1(0x16a)](_0x3a6bd1(0x18a))):(_0x55dfd8[_0x3a6bd1(0x16d)][_0x3a6bd1(0x16a)](_0x3a6bd1(0x1b9),_0x3a6bd1(0x1b6)),_0x55dfd8[_0x3a6bd1(0x16d)][_0x3a6bd1(0x164)](_0x3a6bd1(0x1ab),'bg-white'),_0x1ad9c2[_0x3a6bd1(0x16d)][_0x3a6bd1(0x164)](_0x3a6bd1(0x18a))),validateForm();}function validateForm(){const _0x1957ab=_0x2e66f3,_0x5f53ae=state['idCard'][_0x1957ab(0x176)](/-/g,''),_0x478bea=_0x5f53ae[_0x1957ab(0x182)]===0xd,_0x3d43b6=document[_0x1957ab(0x171)](_0x1957ab(0x14f));_0x478bea?(_0x3d43b6['disabled']=![],_0x3d43b6[_0x1957ab(0x16d)][_0x1957ab(0x16a)](_0x1957ab(0x195),_0x1957ab(0x1b3),_0x1957ab(0x1ba),'shadow-none'),_0x3d43b6[_0x1957ab(0x16d)]['add'](_0x1957ab(0x187),'text-white',_0x1957ab(0x165),'shadow-blue-200')):(_0x3d43b6['disabled']=!![],_0x3d43b6[_0x1957ab(0x16d)][_0x1957ab(0x164)](_0x1957ab(0x195),_0x1957ab(0x1b3),_0x1957ab(0x1ba),_0x1957ab(0x1a6)),_0x3d43b6['classList'][_0x1957ab(0x16a)]('bg-blue-600',_0x1957ab(0x185),_0x1957ab(0x165),'shadow-blue-200'));}async function submitForm(_0x444e31){const _0x390170=_0x2e66f3;_0x444e31[_0x390170(0x198)]();if(!state['user'])return;const _0x54bf83=document[_0x390170(0x171)]('btn-submit'),_0x154909=document[_0x390170(0x171)]('btn-text'),_0x5afd6c=document[_0x390170(0x171)](_0x390170(0x15e));_0x54bf83[_0x390170(0x18e)]=!![],_0x154909[_0x390170(0x1bd)]=_0x390170(0x189),_0x5afd6c[_0x390170(0x16d)]['remove'](_0x390170(0x18a));try{const _0x10e6b6=getDeviceId(),_0x329efc=state[_0x390170(0x18b)][_0x390170(0x176)](/-/g,''),_0x4edbee=await sha256(_0x329efc);console[_0x390170(0x19d)](_0x390170(0x19c),_0x10e6b6),console['log'](_0x390170(0x197),_0x4edbee);const _0x3b8c35=getLocalRegistration();if(_0x3b8c35&&_0x3b8c35!==_0x4edbee){document[_0x390170(0x171)](_0x390170(0x1ae))[_0x390170(0x1bd)]=_0x390170(0x1b8),document[_0x390170(0x171)](_0x390170(0x19f))[_0x390170(0x16d)]['add']('hidden'),document[_0x390170(0x171)](_0x390170(0x1bf))[_0x390170(0x16d)][_0x390170(0x16a)](_0x390170(0x18a));return;}const _0x47c2d7=query(collection(db,finalCollectionPath),where(_0x390170(0x1be),'==',_0x4edbee)),_0x31dd0c=await getDocs(_0x47c2d7);if(!_0x31dd0c[_0x390170(0x1ad)]){const _0x3a9f09=_0x31dd0c['docs'][0x0],_0x141813=_0x3a9f09[_0x390170(0x162)]();if(_0x141813[_0x390170(0x1a8)]&&_0x141813[_0x390170(0x1a8)]!==_0x10e6b6){document[_0x390170(0x171)](_0x390170(0x1ae))['innerHTML']=_0x390170(0x14c),document['getElementById']('screen-form')[_0x390170(0x16d)][_0x390170(0x164)](_0x390170(0x18a)),document[_0x390170(0x171)](_0x390170(0x1bf))['classList'][_0x390170(0x16a)](_0x390170(0x18a));return;}state['currentDocId']=_0x3a9f09['id'];let _0x5a2202='-';if(_0x141813['CheckIN']){const _0x9919b9=_0x141813['CheckIN'][_0x390170(0x1b7)]?_0x141813[_0x390170(0x1a2)][_0x390170(0x1b7)]():new Date(_0x141813[_0x390170(0x1a2)]);_0x5a2202=_0x9919b9[_0x390170(0x167)](_0x390170(0x1a3));}let _0x42c5f3='';const _0x3a322b=new Date();_0x42c5f3=_0x3a322b[_0x390170(0x167)](_0x390170(0x1a3));const _0x5589c5={};let _0x4d8795=![];!_0x141813[_0x390170(0x1a8)]&&(_0x5589c5[_0x390170(0x1a8)]=_0x10e6b6,_0x4d8795=!![]);let _0x27400f='',_0x387574=![];const _0x58f839=!_0x141813['CheckIN'];if(_0x58f839){_0x5589c5[_0x390170(0x1a2)]=serverTimestamp(),_0x387574=!![],_0x4d8795=!![];const _0x22792a=new Date();_0x27400f=_0x22792a['toLocaleDateString']('th-TH')+'\x20'+_0x22792a[_0x390170(0x14a)](_0x390170(0x1a3));}else{const _0x3f5306=_0x141813[_0x390170(0x1a2)][_0x390170(0x1b7)]?_0x141813['CheckIN'][_0x390170(0x1b7)]():new Date(_0x141813[_0x390170(0x1a2)]);_0x27400f=_0x3f5306[_0x390170(0x193)](_0x390170(0x1a3))+'\x20'+_0x3f5306[_0x390170(0x14a)](_0x390170(0x1a3));}const _0x421de9=!_0x58f839||_0x5589c5[_0x390170(0x1a2)],_0x296516=_0x141813[_0x390170(0x19a)];if(_0x421de9&&_0x296516)_0x141813[_0x390170(0x15b)]!=='ลงทะเบียนสำเร็จ'&&(_0x5589c5[_0x390170(0x15b)]=_0x390170(0x166),_0x4d8795=!![]);else _0x421de9&&!_0x296516&&(_0x58f839&&(_0x5589c5[_0x390170(0x15b)]=_0x390170(0x157),_0x4d8795=!![]));_0x4d8795&&await updateDoc(doc(db,finalCollectionPath,_0x3a9f09['id']),_0x5589c5),setLocalRegistration(_0x4edbee),updateSuccessUI(_0x27400f,_0x42c5f3,_0x141813[_0x390170(0x172)],_0x141813['rewardClaimTime'],_0x387574,_0x141813[_0x390170(0x16f)]);}else{const _0x26a2a2=query(collection(db,finalCollectionPath),where(_0x390170(0x1a8),'==',_0x10e6b6)),_0x3837d9=await getDocs(_0x26a2a2);if(!_0x3837d9[_0x390170(0x1ad)])document[_0x390170(0x171)](_0x390170(0x1ae))[_0x390170(0x1bd)]=_0x390170(0x1c0),document[_0x390170(0x171)]('screen-form')['classList']['add']('hidden'),document['getElementById'](_0x390170(0x1bf))['classList'][_0x390170(0x16a)](_0x390170(0x18a));else{await addDoc(collection(db,finalCollectionPath),{'citizenId':_0x4edbee,'deviceId':_0x10e6b6,'CheckIN':serverTimestamp(),'status':'checked-in'}),state[_0x390170(0x15d)]=null,setLocalRegistration(_0x4edbee);const _0x370b7e=new Date(),_0x1b1924=_0x370b7e['toLocaleDateString'](_0x390170(0x1a3))+'\x20'+_0x370b7e[_0x390170(0x14a)](_0x390170(0x1a3));updateSuccessUI(_0x1b1924,'-',null,null,!![],null);}}}catch(_0x67a6fb){console[_0x390170(0x196)]('Submit\x20Error:',_0x67a6fb),document[_0x390170(0x171)](_0x390170(0x1ae))[_0x390170(0x159)]=_0x390170(0x15c)+_0x67a6fb['message'],document[_0x390170(0x171)](_0x390170(0x19f))[_0x390170(0x16d)]['add'](_0x390170(0x18a)),document['getElementById'](_0x390170(0x1bf))[_0x390170(0x16d)][_0x390170(0x16a)](_0x390170(0x18a));}finally{_0x54bf83[_0x390170(0x18e)]=![],_0x154909[_0x390170(0x1bd)]=_0x390170(0x1b5),_0x5afd6c[_0x390170(0x16d)][_0x390170(0x164)](_0x390170(0x18a)),validateForm();}}document['getElementById'](_0x2e66f3(0x178))[_0x2e66f3(0x19b)](_0x2e66f3(0x168),submitForm),document[_0x2e66f3(0x171)](_0x2e66f3(0x18b))[_0x2e66f3(0x19b)]('input',handleIdInput),window['addEventListener'](_0x2e66f3(0x156),()=>{const _0x6dba92=_0x2e66f3;document[_0x6dba92(0x171)]('idCard')['focus']();}),initAuth();if(window[_0x2e66f3(0x158)])lucide[_0x2e66f3(0x174)]();

    </script>
</body>
</html>