<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Font (Sarabun) -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .hidden { display: none !important; }
        /* Custom Animations */
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        /* Remove number arrows */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-10">

    <!-- Header Section -->
    <div class="bg-gradient-to-r from-blue-700 to-indigo-800 text-white p-6 rounded-b-[2.5rem] shadow-lg mb-8 relative overflow-hidden">
        <div class="absolute top-0 right-0 opacity-10 transform translate-x-10 -translate-y-10">
            <i data-lucide="shield-check" width="150" height="150"></i>
        </div>
        
        <div class="relative z-10 flex flex-col items-center">
            <div class="bg-white/20 p-3 rounded-full mb-3 backdrop-blur-sm">
                <i data-lucide="user" width="32" height="32" class="text-white"></i>
            </div>
            <h1 class="text-xl font-bold text-center">ลงทะเบียนสมาชิก</h1>
            <p class="text-blue-100 text-sm mt-1">สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด</p>
        </div>
    </div>

    <!-- Main Content Container -->
    <main class="px-2 sm:px-4 max-w-lg mx-auto -mt-10">
        
        <!-- Registration Form Screen -->
        <div id="screen-form" class="bg-white rounded-2xl shadow-xl p-6 border border-slate-100 relative z-20">
            
            <form id="registration-form" class="space-y-6 pt-2">
                <center>
                <!-- Single Input ID Card -->
                <div>
                    <label for="idCard" class="block text-sm font-semibold text-gray-700 mb-2">
                        เลขบัตรประจำตัวประชาชน
                    </label>
                    <div class="relative">
                        <input
                            type="text"
                            id="idCard"
                            placeholder="x-xxxx-xxxxx-xx-x"
                            class="w-full text-xl font-mono tracking-wide p-4 rounded-xl border-2 border-gray-200 bg-white focus:border-blue-400 focus:ring-4 focus:ring-blue-100 outline-none transition-all text-center"
                            inputmode="numeric"
                            maxlength="17"
                        />
                        <i id="icon-check-valid" data-lucide="check-circle" class="hidden absolute right-4 top-1/2 transform -translate-y-1/2 text-green-500 w-6 h-6 animate-fade-in"></i>
                    </div>
                    <p class="text-xs text-gray-400 mt-2 ml-1">กรุณากรอกตัวเลข 13 หลักให้ครบถ้วน</p>
                </div>

                <!-- Info Box -->
                <div class="p-3 bg-blue-50 text-blue-800 rounded-lg text-xs flex gap-2 items-start" style="margin-top:25px; text-align: left;">
                    <i data-lucide="info" class="w-4 h-4 shrink-0 mt-0.5"></i>
                    <span>จำกัดสิทธิ์ 1 เครื่องโทรศัพท์ต่อ 1 หมายเลขบัตรฯ เท่านั้น<br>ผู้ที่จะได้รับรางวัลค่าตอบแทนการประชุม 200 บาทจะต้องลงทะเบียนเข้า และลงทะเบียนออก เท่านั้น</span>
                </div>
                </center>

                <!-- Submit Button -->
                <button
                    type="submit"
                    id="btn-submit"
                    disabled
                    class="w-full py-3 rounded-lg font-semibold text-base shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2 bg-gray-200 text-gray-400 cursor-not-allowed shadow-none"
                >
                    <span id="btn-text">ตรวจสอบ / ลงทะเบียน</span>
                    <i id="btn-loader" data-lucide="loader-2" class="hidden animate-spin"></i>
                </button>
            </form>
        </div>

        <!-- Success Screen -->
        <!-- Removed 'max-w-sm' to match width with registration form -->
        <div id="screen-success" class="hidden bg-white rounded-2xl shadow-xl p-8 w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i data-lucide="check-circle" class="text-green-600 w-10 h-10"></i>
            </div>
            
            <!-- Added Name Display -->
            <h3 id="success-user-name" class="text-lg font-bold text-blue-600 mb-2 hidden"></h3>

            <h2 id="success-title" class="text-xl font-bold text-gray-800 mb-1">ลงทะเบียนสำเร็จ</h2>
            <p id="success-checkin-datetime" class="text-blue-600 font-medium mb-6 text-xs">--/--/---- --:--</p>
            
            <!-- Agenda Box -->
            <div class="bg-blue-50 border border-blue-100 rounded-xl p-5 mb-6 text-left shadow-sm">
                <h3 class="font-bold text-blue-900 mb-3 text-lg flex items-center gap-2 border-b border-blue-200 pb-2">
                    <i data-lucide="calendar-days" width="20"></i> กำหนดการประชุมสมาชิกฯ
                </h3>
                <ol class="list-decimal pl-5 space-y-2 text-sm text-gray-700">
                    <li>เรื่องแจ้งสมาชิก</li>
                    <li>รายงานผลประกอบการ</li>
                    <li>ประกาศผลการเลือกตั้งประธานฯ</li>
                    <li>ประกาศผลการเลือกตั้งกรรมการฯ</li>
                    <li>ลุ้นรางวัลพิเศษ 50 รางว้ล</li>
                </ol>
            </div>
            
            <button onclick="window.app.resetForm()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-semibold hover:bg-blue-700 transition shadow-lg shadow-blue-200">
                กลับสู่หน้าหลัก
            </button>
        </div>

        <!-- Error Screen (Device Limit) -->
        <div id="screen-error-device" class="hidden bg-white rounded-2xl shadow-xl p-8 max-w-sm w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="alert-triangle" class="text-red-600 w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold text-red-700 mb-2">ไม่สามารถดำเนินการได้</h2>
            <p id="error-msg-text" class="text-gray-600 mb-6 text-sm">
                คุณไม่สามารถลงทะเบียนใหม่ได้อีก <br/>
                (เครื่องนี้ถูกใช้งานไปแล้ว)
            </p>
            <button onclick="window.location.reload()" class="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition">
                ปิด
            </button>
        </div>

        <!-- Not Found Screen -->
        <div id="screen-not-found" class="hidden bg-white rounded-2xl shadow-xl p-8 max-w-sm w-full text-center animate-fade-in relative z-20">
            <div class="w-20 h-20 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="user-x" class="text-amber-600 w-10 h-10"></i>
            </div>
            <h2 class="text-xl font-bold text-amber-700 mb-2">ไม่มีข้อมูลในระบบ</h2>
            <p class="text-gray-600 mb-6 text-sm">
                ไม่พบเลขบัตรประชาชนนี้ในฐานข้อมูล <br/>
                กรุณาตรวจสอบความถูกต้อง
            </p>
            <button onclick="window.app.resetForm()" class="w-full bg-amber-500 text-white py-3 rounded-xl font-semibold hover:bg-amber-600 transition shadow-lg shadow-amber-200">
                ปิด
            </button>
        </div>

        <!-- Footer -->
        <p class="text-center text-gray-400 text-xs mt-8">
            ระบบลงทะเบียนสมาชิกสหกรณ์ <br/>
            © 2024 สหกรณ์ออมทรัพย์พนักงานธนาคารทหารไทย จำกัด
        </p>
    </main>

    <!-- Firebase and Application Logic -->
    <script type="module">
const _0x48ed4f=_0x5493;(function(_0x5ceb5f,_0x544462){const _0x568a21=_0x5493,_0x3a1d3d=_0x5ceb5f();while(!![]){try{const _0x464536=-parseInt(_0x568a21(0x105))/0x1+parseInt(_0x568a21(0x11a))/0x2+-parseInt(_0x568a21(0xcc))/0x3+parseInt(_0x568a21(0x113))/0x4*(-parseInt(_0x568a21(0x125))/0x5)+parseInt(_0x568a21(0x127))/0x6+-parseInt(_0x568a21(0x12f))/0x7+parseInt(_0x568a21(0x107))/0x8;if(_0x464536===_0x544462)break;else _0x3a1d3d['push'](_0x3a1d3d['shift']());}catch(_0x3fee7a){_0x3a1d3d['push'](_0x3a1d3d['shift']());}}}(_0x5be3,0x2d8d0));function _0x5493(_0x1d45dc,_0x32c2af){_0x1d45dc=_0x1d45dc-0xcc;const _0x5be3eb=_0x5be3();let _0x549352=_0x5be3eb[_0x1d45dc];return _0x549352;}import{initializeApp}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js';import{getAuth,signInAnonymously,onAuthStateChanged,signInWithCustomToken}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js';import{getFirestore,collection,addDoc,updateDoc,doc,serverTimestamp,query,where,getDocs}from'https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js';const TARGET_COLLECTION_NAME=_0x48ed4f(0x139),isSandboxEnv=typeof __firebase_config!==_0x48ed4f(0xfc);let firebaseConfig,finalCollectionPath;if(isSandboxEnv){firebaseConfig=JSON['parse'](__firebase_config);const appId=typeof __app_id!==_0x48ed4f(0xfc)?__app_id:'default-app-id';finalCollectionPath=_0x48ed4f(0xde)+appId+_0x48ed4f(0xe6);}else firebaseConfig={'apiKey':'AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','authDomain':_0x48ed4f(0xcd),'databaseURL':_0x48ed4f(0x10c),'projectId':_0x48ed4f(0x11d),'storageBucket':_0x48ed4f(0xf4),'messagingSenderId':_0x48ed4f(0xff),'appId':_0x48ed4f(0x132),'measurementId':_0x48ed4f(0xf2)},finalCollectionPath=TARGET_COLLECTION_NAME;function _0x5be3(){const _0x46367c=['slice','cookie','454345KxYBXX','disabled','2187264yZObUJ','Submit\x20Error:','SHA-256','ท่านได้ลงทะเบียนไปแล้ว','message','idCard','substr','toLocaleString','1450757xRBbiY','กำลังตรวจสอบ...','match','1:1070273157855:web:5c8120e1df27e233d8676a','hover:bg-blue-700','bg-blue-600','toString','status','ลงทะเบียนสำเร็จ','add','tmb_coop','shadow-blue-200','toDate','checked-in','innerText','DEV-','registration-form','994149nkULbo','ttb-register.firebaseapp.com','EmpName','bg-gray-200','length','icon-check-valid','data','addEventListener','hidden','getElementById','reward','user','focus','th-TH','screen-error-device','rewardClaimTime','error','innerHTML','artifacts/','CheckOUT','รหัสบัตรประชาชนนี้\x20ผูกกับโทรศัพท์เครื่องอื่นแล้ว<br>(ไม่สามารถเปลี่ยนเครื่องได้)','text-white','=([^;]+)','getItem','border-gray-200','CheckIN','/public/data/coop_registrations','input','toLocaleDateString','Checking\x20ID\x20Hash:','btn-submit','digest','shadow-none','toLocaleTimeString','padStart','error-msg-text','forEach','bg-blue-50/30','G-9DJLWJ5LQ1','เครื่องนี้ถูกผูกบัญชีอื่นแล้ว\x20(ไม่สามารถลงทะเบียนใหม่ได้)','ttb-register.firebasestorage.app','lucide','map','citizenId','success-user-name','docs','replace','empty','undefined','success-title','setItem','1070273157855','btn-loader','ตรวจสอบ\x20/\x20ลงทะเบียน',';\x20path=/;\x20max-age=31536000','app','preventDefault','305718XIbgqk','currentDocId','5194744IBJzLY','log','remove','coop_registered_citizen_id','screen-success','https://ttb-register-default-rtdb.asia-southeast1.firebasedate.app','random','text-gray-400','ลงทะเบียนเมื่อ:\x20','subtle','Auth\x20failed','screen-form','12YpxPOb','createIcons','join','border-blue-500','deviceId','classList','value','579296BtjLKi','(^|\x20)','from','ttb-register','cursor-not-allowed','bg-white','success-checkin-datetime','Checking\x20Device:','เครื่องนี้ถูกใช้งานลงทะเบียนบัตรประชาชนอื่นไปแล้ว\x20(จำกัด\x201\x20เครื่อง\x20/\x201\x20ท่าน)'];_0x5be3=function(){return _0x46367c;};return _0x5be3();}const state={'user':null,'idCard':''},app=initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app);async function sha256(_0x46b6fd){const _0x649041=_0x48ed4f,_0x15b24b=new TextEncoder()['encode'](_0x46b6fd),_0x1e2fc1=await crypto[_0x649041(0x110)][_0x649041(0xeb)](_0x649041(0x129),_0x15b24b),_0x469f66=Array[_0x649041(0x11c)](new Uint8Array(_0x1e2fc1)),_0x367414=_0x469f66[_0x649041(0xf6)](_0x1e26c9=>_0x1e26c9['toString'](0x10)[_0x649041(0xee)](0x2,'0'))[_0x649041(0x115)]('');return _0x367414;}function getDeviceId(){const _0x13b9ba=_0x48ed4f,_0x1057eb='coop_device_identifier';let _0x12a2f6=localStorage[_0x13b9ba(0xe3)](_0x1057eb);if(!_0x12a2f6){const _0x354742=document[_0x13b9ba(0x124)][_0x13b9ba(0x131)](new RegExp(_0x13b9ba(0x11b)+_0x1057eb+_0x13b9ba(0xe2)));_0x354742&&(_0x12a2f6=_0x354742[0x2],localStorage[_0x13b9ba(0xfe)](_0x1057eb,_0x12a2f6));}return!_0x12a2f6?(_0x12a2f6=_0x13b9ba(0x13e)+Date['now']()[_0x13b9ba(0x135)](0x24)+Math[_0x13b9ba(0x10d)]()[_0x13b9ba(0x135)](0x24)[_0x13b9ba(0x12d)](0x2,0x9),localStorage['setItem'](_0x1057eb,_0x12a2f6),document[_0x13b9ba(0x124)]=_0x1057eb+'='+_0x12a2f6+';\x20path=/;\x20max-age=31536000'):document[_0x13b9ba(0x124)]=_0x1057eb+'='+_0x12a2f6+_0x13b9ba(0x102),_0x12a2f6;}function setLocalRegistration(_0x20a42e){const _0x17f49a=_0x48ed4f;localStorage[_0x17f49a(0xfe)](_0x17f49a(0x10a),_0x20a42e);}function getLocalRegistration(){const _0x55a523=_0x48ed4f;return localStorage[_0x55a523(0xe3)](_0x55a523(0x10a));}window[_0x48ed4f(0x103)]={'resetForm':()=>{const _0x48b802=_0x48ed4f,_0x5594c4=[_0x48b802(0x10b),_0x48b802(0xda),'screen-not-found'];_0x5594c4[_0x48b802(0xf0)](_0x49fd04=>document['getElementById'](_0x49fd04)[_0x48b802(0x118)][_0x48b802(0x138)](_0x48b802(0xd4))),document[_0x48b802(0xd5)](_0x48b802(0x112))['classList'][_0x48b802(0x109)]('hidden'),document[_0x48b802(0xd5)](_0x48b802(0xf8))['classList']['add']('hidden');const _0x506d89=document[_0x48b802(0xd5)]('idCard');_0x506d89[_0x48b802(0x119)]='',state[_0x48b802(0x12c)]='';const _0x547bfc=document[_0x48b802(0xd5)](_0x48b802(0xea)),_0x5de969=document[_0x48b802(0xd5)]('btn-text'),_0x481b99=document['getElementById']('btn-loader');_0x5de969[_0x48b802(0x13d)]=_0x48b802(0x101),_0x481b99[_0x48b802(0x118)][_0x48b802(0x138)](_0x48b802(0xd4)),_0x547bfc[_0x48b802(0x126)]=!![],_0x547bfc['classList'][_0x48b802(0x138)](_0x48b802(0xcf),'text-gray-400',_0x48b802(0x11e),_0x48b802(0xec)),_0x547bfc[_0x48b802(0x118)][_0x48b802(0x109)]('bg-blue-600','text-white',_0x48b802(0x133),_0x48b802(0x13a));const _0x2b0748=document[_0x48b802(0xd5)](_0x48b802(0xd1));_0x2b0748[_0x48b802(0x118)][_0x48b802(0x138)](_0x48b802(0xd4)),_0x506d89['classList']['remove'](_0x48b802(0x116),_0x48b802(0xf1)),_0x506d89[_0x48b802(0x118)][_0x48b802(0x138)](_0x48b802(0xe4),_0x48b802(0x11f)),_0x506d89[_0x48b802(0xd8)]();}};function updateSuccessUI(_0x3c0484,_0x3c903f,_0x2e8a2f,_0x49fca7,_0x3a35e1,_0xa05a98){const _0x20bd34=_0x48ed4f;document[_0x20bd34(0xd5)](_0x20bd34(0xfd))['innerText']=_0x3a35e1?_0x20bd34(0x137):_0x20bd34(0x12a),document[_0x20bd34(0xd5)](_0x20bd34(0x120))[_0x20bd34(0x13d)]=_0x20bd34(0x10f)+_0x3c0484;const _0x441122=document[_0x20bd34(0xd5)](_0x20bd34(0xf8));_0xa05a98?(_0x441122['innerText']=_0xa05a98,_0x441122[_0x20bd34(0x118)][_0x20bd34(0x109)](_0x20bd34(0xd4))):_0x441122[_0x20bd34(0x118)][_0x20bd34(0x138)](_0x20bd34(0xd4)),document[_0x20bd34(0xd5)](_0x20bd34(0x112))[_0x20bd34(0x118)]['add'](_0x20bd34(0xd4)),document['getElementById'](_0x20bd34(0x10b))['classList'][_0x20bd34(0x109)]('hidden');}async function initAuth(){const _0x611d08=_0x48ed4f;try{typeof __initial_auth_token!=='undefined'&&__initial_auth_token?await signInWithCustomToken(auth,__initial_auth_token):await signInAnonymously(auth);}catch(_0x4d042f){console[_0x611d08(0xdc)](_0x611d08(0x111),_0x4d042f);}}onAuthStateChanged(auth,_0x5b160d=>{const _0x3823ce=_0x48ed4f;state[_0x3823ce(0xd7)]=_0x5b160d;});function handleIdInput(_0x3825b6){const _0x36e8fb=_0x48ed4f;let _0x3f6ac0=_0x3825b6['target'][_0x36e8fb(0x119)][_0x36e8fb(0xfa)](/[^0-9]/g,'');if(_0x3f6ac0['length']>0xd)_0x3f6ac0=_0x3f6ac0[_0x36e8fb(0x123)](0x0,0xd);let _0xdcf4ac=_0x3f6ac0;if(_0x3f6ac0['length']>0x1)_0xdcf4ac=_0x3f6ac0[_0x36e8fb(0x123)](0x0,0x1)+'-'+_0x3f6ac0['slice'](0x1);if(_0x3f6ac0[_0x36e8fb(0xd0)]>0x5)_0xdcf4ac=_0xdcf4ac[_0x36e8fb(0x123)](0x0,0x6)+'-'+_0xdcf4ac['slice'](0x6);if(_0x3f6ac0[_0x36e8fb(0xd0)]>0xa)_0xdcf4ac=_0xdcf4ac[_0x36e8fb(0x123)](0x0,0xc)+'-'+_0xdcf4ac[_0x36e8fb(0x123)](0xc);if(_0x3f6ac0[_0x36e8fb(0xd0)]>0xc)_0xdcf4ac=_0xdcf4ac[_0x36e8fb(0x123)](0x0,0xf)+'-'+_0xdcf4ac['slice'](0xf);state[_0x36e8fb(0x12c)]=_0xdcf4ac,document['getElementById'](_0x36e8fb(0x12c))['value']=_0xdcf4ac;const _0x246711=document['getElementById'](_0x36e8fb(0xd1)),_0x187339=document[_0x36e8fb(0xd5)]('idCard');_0x3f6ac0[_0x36e8fb(0xd0)]===0xd?(_0x187339['classList'][_0x36e8fb(0x138)](_0x36e8fb(0x116),_0x36e8fb(0xf1)),_0x187339[_0x36e8fb(0x118)][_0x36e8fb(0x109)]('border-gray-200',_0x36e8fb(0x11f)),_0x246711[_0x36e8fb(0x118)]['remove'](_0x36e8fb(0xd4))):(_0x187339[_0x36e8fb(0x118)][_0x36e8fb(0x109)]('border-blue-500','bg-blue-50/30'),_0x187339['classList'][_0x36e8fb(0x138)](_0x36e8fb(0xe4),_0x36e8fb(0x11f)),_0x246711['classList'][_0x36e8fb(0x138)]('hidden')),validateForm();}function validateForm(){const _0x5121c1=_0x48ed4f,_0x163105=state['idCard'][_0x5121c1(0xfa)](/-/g,''),_0x2a929b=_0x163105['length']===0xd,_0x3bb1b4=document[_0x5121c1(0xd5)]('btn-submit');_0x2a929b?(_0x3bb1b4[_0x5121c1(0x126)]=![],_0x3bb1b4[_0x5121c1(0x118)][_0x5121c1(0x109)](_0x5121c1(0xcf),_0x5121c1(0x10e),_0x5121c1(0x11e),_0x5121c1(0xec)),_0x3bb1b4[_0x5121c1(0x118)][_0x5121c1(0x138)](_0x5121c1(0x134),_0x5121c1(0xe1),_0x5121c1(0x133),_0x5121c1(0x13a))):(_0x3bb1b4['disabled']=!![],_0x3bb1b4[_0x5121c1(0x118)][_0x5121c1(0x138)]('bg-gray-200','text-gray-400',_0x5121c1(0x11e),'shadow-none'),_0x3bb1b4[_0x5121c1(0x118)][_0x5121c1(0x109)](_0x5121c1(0x134),'text-white',_0x5121c1(0x133),_0x5121c1(0x13a)));}async function submitForm(_0x261e26){const _0x29015f=_0x48ed4f;_0x261e26[_0x29015f(0x104)]();if(!state[_0x29015f(0xd7)])return;const _0x17875f=document[_0x29015f(0xd5)]('btn-submit'),_0x40326f=document[_0x29015f(0xd5)]('btn-text'),_0x1e35cd=document[_0x29015f(0xd5)](_0x29015f(0x100));_0x17875f['disabled']=!![],_0x40326f[_0x29015f(0x13d)]=_0x29015f(0x130),_0x1e35cd[_0x29015f(0x118)][_0x29015f(0x109)]('hidden');try{const _0x3454ff=getDeviceId(),_0x1d6799=state[_0x29015f(0x12c)][_0x29015f(0xfa)](/-/g,''),_0x4fb988=await sha256(_0x1d6799);console[_0x29015f(0x108)](_0x29015f(0x121),_0x3454ff),console[_0x29015f(0x108)](_0x29015f(0xe9),_0x4fb988);const _0x39760a=getLocalRegistration();if(_0x39760a&&_0x39760a!==_0x4fb988){document['getElementById']('error-msg-text')[_0x29015f(0x13d)]=_0x29015f(0x122),document[_0x29015f(0xd5)](_0x29015f(0x112))['classList'][_0x29015f(0x138)](_0x29015f(0xd4)),document[_0x29015f(0xd5)](_0x29015f(0xda))[_0x29015f(0x118)][_0x29015f(0x109)](_0x29015f(0xd4));return;}const _0x2b42e9=query(collection(db,finalCollectionPath),where(_0x29015f(0xf7),'==',_0x4fb988)),_0x593d66=await getDocs(_0x2b42e9);if(!_0x593d66['empty']){const _0x18fa49=_0x593d66[_0x29015f(0xf9)][0x0],_0x478d7=_0x18fa49[_0x29015f(0xd2)]();if(_0x478d7['deviceId']&&_0x478d7[_0x29015f(0x117)]!==_0x3454ff){document[_0x29015f(0xd5)](_0x29015f(0xef))[_0x29015f(0xdd)]=_0x29015f(0xe0),document['getElementById'](_0x29015f(0x112))[_0x29015f(0x118)][_0x29015f(0x138)](_0x29015f(0xd4)),document[_0x29015f(0xd5)](_0x29015f(0xda))[_0x29015f(0x118)][_0x29015f(0x109)](_0x29015f(0xd4));return;}state[_0x29015f(0x106)]=_0x18fa49['id'];let _0x560c5f='-';if(_0x478d7['CheckIN']){const _0x5002dc=_0x478d7['CheckIN'][_0x29015f(0x13b)]?_0x478d7['CheckIN']['toDate']():new Date(_0x478d7[_0x29015f(0xe5)]);_0x560c5f=_0x5002dc['toLocaleString'](_0x29015f(0xd9));}let _0x5935af='';const _0x411139=new Date();_0x5935af=_0x411139[_0x29015f(0x12e)]('th-TH');const _0x59d4e8={};let _0x136094=![];!_0x478d7[_0x29015f(0x117)]&&(_0x59d4e8['deviceId']=_0x3454ff,_0x136094=!![]);let _0xa2179a='',_0x5ac8a5=![];const _0x351089=!_0x478d7[_0x29015f(0xe5)];if(_0x351089){_0x59d4e8['CheckIN']=serverTimestamp(),_0x5ac8a5=!![],_0x136094=!![];const _0x3b48b8=new Date();_0xa2179a=_0x3b48b8[_0x29015f(0xe8)](_0x29015f(0xd9))+'\x20'+_0x3b48b8[_0x29015f(0xed)](_0x29015f(0xd9));}else{const _0x551e49=_0x478d7[_0x29015f(0xe5)][_0x29015f(0x13b)]?_0x478d7[_0x29015f(0xe5)][_0x29015f(0x13b)]():new Date(_0x478d7['CheckIN']);_0xa2179a=_0x551e49[_0x29015f(0xe8)](_0x29015f(0xd9))+'\x20'+_0x551e49['toLocaleTimeString']('th-TH');}const _0x253289=!_0x351089||_0x59d4e8[_0x29015f(0xe5)],_0x369f52=_0x478d7[_0x29015f(0xdf)];if(_0x253289&&_0x369f52)_0x478d7[_0x29015f(0x136)]!==_0x29015f(0x137)&&(_0x59d4e8['status']=_0x29015f(0x137),_0x136094=!![]);else _0x253289&&!_0x369f52&&(_0x351089&&(_0x59d4e8[_0x29015f(0x136)]=_0x29015f(0x13c),_0x136094=!![]));_0x136094&&await updateDoc(doc(db,finalCollectionPath,_0x18fa49['id']),_0x59d4e8),setLocalRegistration(_0x4fb988),updateSuccessUI(_0xa2179a,_0x5935af,_0x478d7[_0x29015f(0xd6)],_0x478d7[_0x29015f(0xdb)],_0x5ac8a5,_0x478d7[_0x29015f(0xce)]);}else{const _0x34cb80=query(collection(db,finalCollectionPath),where(_0x29015f(0x117),'==',_0x3454ff)),_0x50d1d8=await getDocs(_0x34cb80);if(!_0x50d1d8[_0x29015f(0xfb)])document[_0x29015f(0xd5)](_0x29015f(0xef))[_0x29015f(0x13d)]=_0x29015f(0xf3),document[_0x29015f(0xd5)]('screen-form')[_0x29015f(0x118)][_0x29015f(0x138)](_0x29015f(0xd4)),document[_0x29015f(0xd5)]('screen-error-device')['classList'][_0x29015f(0x109)](_0x29015f(0xd4));else{await addDoc(collection(db,finalCollectionPath),{'citizenId':_0x4fb988,'deviceId':_0x3454ff,'CheckIN':serverTimestamp(),'status':_0x29015f(0x13c)}),state['currentDocId']=null,setLocalRegistration(_0x4fb988);const _0xdc9ecb=new Date(),_0x2e6b43=_0xdc9ecb[_0x29015f(0xe8)]('th-TH')+'\x20'+_0xdc9ecb[_0x29015f(0xed)](_0x29015f(0xd9));updateSuccessUI(_0x2e6b43,'-',null,null,!![],null);}}}catch(_0x1a07b6){console[_0x29015f(0xdc)](_0x29015f(0x128),_0x1a07b6),alert('เกิดข้อผิดพลาด:\x20'+_0x1a07b6[_0x29015f(0x12b)]);}finally{_0x17875f[_0x29015f(0x126)]=![],_0x40326f[_0x29015f(0x13d)]=_0x29015f(0x101),_0x1e35cd['classList'][_0x29015f(0x138)](_0x29015f(0xd4)),validateForm();}}document[_0x48ed4f(0xd5)](_0x48ed4f(0x13f))[_0x48ed4f(0xd3)]('submit',submitForm),document[_0x48ed4f(0xd5)](_0x48ed4f(0x12c))[_0x48ed4f(0xd3)](_0x48ed4f(0xe7),handleIdInput),window[_0x48ed4f(0xd3)]('load',()=>{const _0x1d55c4=_0x48ed4f;document['getElementById'](_0x1d55c4(0x12c))[_0x1d55c4(0xd8)]();}),initAuth();if(window[_0x48ed4f(0xf5)])lucide[_0x48ed4f(0x114)]();

    </script>
</body>
</html>